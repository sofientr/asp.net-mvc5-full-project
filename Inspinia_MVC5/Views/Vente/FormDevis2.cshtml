@*<head>
        <meta http-equiv="content-type" content="text/html; charset=ISO-8859-1">
    </head>*@
@*@Html.Raw(Model.ToHtmlString())*@

<link href="~/Content/bootstrap-datepicker3.min.css" rel="stylesheet" type="text/css" />
<link href="~/Content/select2.min.css" rel="stylesheet" type="text/css" />
<style type="text/css">
    input[type=number]::-webkit-inner-spin-button, input[type=number]::-webkit-outer-spin-button {
        -webkit-appearance: none;
        margin: 0;
    }

    #Tableau {
       
        width: 2000px;
    }

    .divScroll {
        overflow: auto;
        
    }

    .multi {
        width: 200px;
    }

    .selectBox {
        position: relative;
    }

        .selectBox select {
            width: 100%;
            font-weight: bold;
        }

    .overSelect {
        position: absolute;
        left: 0;
        right: 0;
        top: 0;
        bottom: 0;
    }

    #checkboxes {
        display: none;
        border: 1px #dadada solid;
    }

        #checkboxes label {
            display: block;
        }

            #checkboxes label:hover {
                background-color: #1e90ff;
            }

    .modal-dialog {
        width: 1200px; /* New width for default modal */
    }

    .modal-sm {
        width: 350px; /* New width for small modal */
    }

    .modal-lg {
        width: 950px; /* New width for large modal */
    }
</style>

<div class="row wrapper border-bottom white-bg page-heading">
    <div class="col-lg-10">
        <h2>
            DEVIS CLIENTS
        </h2>
        <ol class="breadcrumb">
            <li><a>Vente</a> </li>
            <li class="active">

                @if (ViewBag.Mode == "Edit")
                {
                    <strong>Modifier Devis client</strong>
                }
                @if (ViewBag.Mode == "Create")
                {
                    <strong>Nouvelle Devis client</strong>
                }
                @if (ViewBag.Mode == "Aff")
                {
                    <strong>Afficher Devis client</strong>
                }
            </li>

        </ol>
    </div>
    <div class="col-lg-2">
    </div>
</div>
<div class="wrapper wrapper-content animated fadeInRight">
    @using (Html.BeginForm("SendDevis", "Vente", new { Mode = ViewBag.Mode, Code = ViewBag.Code }, FormMethod.Post, new { @class = "form-horizontal", role = "form" }))
    {
        <div class="row" style="margin-bottom: 20px; margin-right: 0px;">
            <button class="btn btn-primary pull-right" type="submit">
                <span class="bold">Enregistrer</span>
            </button>
            <button class="btn btn-warning pull-right" type="button" style="margin-right: 5px;"
                    id="DeleteBtn" onclick="Delete();">
                <span class="bold">Supprimer</span>
            </button>
            <button class="btn btn-success pull-right" type="button" style="margin-right: 5px;" @if (ViewBag.Mode == "Create") { @: disabled
                    }
                    id="PrintBTN" onclick="imp();">
                <span class="bold">Imprimer</span>
            </button>
            <div class="btn-group pull-right" style="margin-right: 5px;">
                <button data-toggle="dropdown" class="btn btn-default dropdown-toggle" @if (ViewBag.Mode == "Create") { @: disabled
                        }>
                    Transformer <span class="caret"></span>
                </button>
                <ul class="dropdown-menu">
                    <li id="VersCommande" onclick="VersCommande();"><a href="#">Commande client</a></li>
                    @*<li id="VersFacture"><a href="#">Facture client</a></li>*@
                </ul>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-6">
                <div class="form-group">
                    <label class="col-lg-2 control-label" style="text-align: initial;">
                        NUMERO
                    </label>
                    <div class="col-lg-10">
                        @if (ViewBag.numeroo != null)
                        {
                            <input type="text" class="form-control" readonly="true" name="numero" id="numero" value="@ViewBag.numeroo" required>
                        }
                        else
                        {
                            <input type="text" class="form-control" readonly="true" name="numero" id="numero" value="@ViewBag.Numero" required>

                        }
                    </div>
                </div>
            </div>
            <div class="col-lg-6">
                <div class="form-group">
                    <label class="col-lg-2 control-label" style="text-align: initial;">
                        DATE
                    </label>
                    <div class="col-lg-10">
                        <div class="input-group date">
                            <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                            <input type="text" class="form-control" name="date" id="date" value="@ViewBag.Date" required>
                        </div>
                    </div>
                </div>
            </div>


            <div class="col-lg-6">
                <div class="form-group">
                    <label class="col-lg-2 control-label" style="padding-left: 0px; text-align: initial;">
                        DESIGNATION
                    </label>
                    <div class="col-lg-10">
                        <input type="text" class="form-control" name="designation" id="designation" value="">
                    </div>
                </div>
            </div>
            <div class="col-lg-6">
                <div class="form-group">
                    <label class="col-lg-2 control-label" style="text-align: initial;">
                        PAIEMENT
                    </label>
                    <div class="col-lg-10">
                        <select class="form-control" name="modePaiement" id="modePaiement" required>
                            @if (ViewBag.modePaiement != null)
                            {
                                <option value="@ViewBag.modePaiement">@ViewBag.modePaiement</option>
                            }
                            else
                            {
                                <option value=""></option>

                            }
                            <option value="Chèque">Chèque</option>
                            <option value="Espèce">Espèce</option>
                            <option value="Virement bancaire">Virement bancaire</option>
                            <option value="Carte bancaire">Carte bancaire</option>
                            <option value="A terme">A terme</option>
                        </select>
                    </div>
                </div>


            </div>
        </div>
        <div class="row">

            <div class="col-lg-6">
                <div class="form-group">
                    <label class="col-lg-2 control-label" style="padding-left: 0px; text-align: initial;">
                        CLIENT
                    </label>
                    <div class="col-lg-10" style="padding-left: 0px;">
                        <div class="col-lg-11">
                            <select class="form-control" name="client" id="client" required><option>@ViewBag.client</option></select>
                        </div>
                        <div class="col-lg-1" style="padding-left: 0px;padding-right: 0px;">
                            <a href="javascript:void(0);" class="CLIENT"><button class="btn btn-outline btn-primary dim" type="button"><i class="fa fa-plus"></i></button></a>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-lg-6">
                <div class="form-group">
                    <label class="col-lg-2 control-label" style="padding-left: 0px; text-align: initial;">
                        CODE
                    </label>
                    <div class="col-lg-10">
                        <input type="text" class="form-control" readonly="true" name="codeClient" id="codeClient" value="@ViewBag.codeClient"
                               required>
                    </div>
                </div>
            </div>
            @*<div class="col-lg-6">
                    <div class="form-group">
                        <label class="col-lg-2 control-label" style="padding-left: 0px; text-align: initial;">
                            SOCIETE
                        </label>
                        <div class="col-lg-10">
                            <select class="form-control" name="Societes" id="Societes"></select>
                        </div>
                    </div>
                </div>*@
            <div class="col-lg-6">
                <div class="form-group">
                    <label class="col-lg-2 control-label" style="padding-left: 0px; text-align: initial;">
                        TIERS
                    </label>
                    <div class="col-lg-10">
                        <select class="form-control" id="Tiers" name="Tiers"><option>@ViewBag.Tiers</option></select>
                    </div>
                </div>
            </div>
            <div class="col-lg-6">
                <div class="form-group">
                    <label class="col-lg-2 control-label" style="padding-left: 0px; text-align: initial;">
                        REMISE %
                    </label>
                    <div class="col-lg-10">
                        @if (ViewBag.remise != null)
                        {
                            <input type="text" class="form-control" name="remise" id="remise" value="@ViewBag.remise" min="0" required>
                        }
                        else
                        {
                            <input type="text" class="form-control" name="remise" id="remise" value="0" min="0" required>

                        }
                    </div>
                </div>
            </div>
            @*<div class="col-lg-6">
                    <div class="form-group">
                        <label class="col-lg-2 control-label" style="padding-left: 0px; text-align: initial;">
                            CODE_Societe
                        </label>
                        <div class="col-lg-10">
                            <input type="text" class="form-control" readonly="true" name="codeSoc" id="codeSoc"
                                   required>
                        </div>
                    </div>
                </div>*@
        </div>
        <div class="row">

        </div>
        <div class="hr-line-dashed">
        </div>
        <div class="row">
            <div class="col-lg-10">
                <strong>Totaux</strong>
            </div>
            <div class="col-lg-2">
            </div>
        </div>
        <div class="form-group">
            <label class="col-lg-2 control-label">
                TOTAL HT
            </label>
            <div class="col-lg-4">
                <input type="text" class="form-control" readonly="true" name="totalHT" id="totalHT" required>
            </div>
            <label class="col-lg-2 control-label">
                NET HT
            </label>
            <div class="col-lg-4">
                <input type="text" class="form-control" readonly="true" name="NetHT" id="NetHT" required>
            </div>
        </div>
        <div class="form-group">
            <label class="col-lg-2 control-label">
                TOTAL TVA
            </label>
            <div class="col-lg-4">
                <input type="text" class="form-control" readonly="true" name="totalTVA" id="totalTVA" required>
            </div>
            <label class="col-lg-2 control-label">
                TOTAL TTC
            </label>
            <div class="col-lg-4">
                <input type="text" class="form-control" readonly="true" name="TotalTTC" id="TotalTTC" required>
            </div>
        </div>
        <div class="form-group">
            <label class="col-lg-2 control-label">
            </label>
            <div class="col-lg-4">
            </div>
            <label class="col-lg-2 control-label">
                NET A PAYE
            </label>
            <div class="col-lg-4">
                <input type="text" class="form-control" readonly="true" name="netAPaye" id="netAPaye"
                       style="font-size: x-large;" required>
            </div>
        </div>
        <input type="hidden" name="WithPrint" id="WithPrint" required />
        <div id='myModal' class='modal'>
            <div class="modal-dialog">
                <div class="modal-content">
                    <div id='myModalContent'>

                    </div>
                </div>
            </div>

        </div>
        <div class="hr-line-dashed">
        </div>
        <div class="row">
            <div class="col-lg-10">
                <strong>Lignes</strong>
            </div>
            <div class="col-lg-2">
            </div>
        </div>
        <div class="divScroll">
            <table class="table table-striped table-bordered table-hover dataTables-example" id="Tableau">
                <thead>
                    <tr>
                        <th style="width:150px;">
                            ARTICLE
                        </th>
                        <th>
                            N° Devis FRS
                        </th>
                        <th>
                            DESCRIPTION
                        </th>

                        <th style="width:150px;">
                            MARQUE
                        </th>
                        <th style="width:150px;">
                            UNITE
                        </th>
                        <th style="width:150px;">
                            DEVISE
                        </th>
                        <th style="width:150px;">
                            CATEGORIE
                        </th>
                        <th style="width:150px;">
                            SOUS_CATEGORIE
                        </th>

                        @*<th>
                                STOCK
                            </th>*@

                        <th style="width:90px;">
                            QTE
                        </th>
                        <th>
                            PUHTAchat
                        </th>
                        <th>
                            Marge
                        </th>
                        <th>
                            PUHTVente
                        </th>
                        <th>
                            REMISE
                        </th>
                        <th>
                            PTHT
                        </th>
                        <th style="width:90px;">
                            TVA
                        </th>

                        <th>
                            TTC
                        </th>
                        <th>
                        </th>
                    </tr>
                </thead>
                <tbody></tbody>
                <tfoot>
                    <tr>
                        <td>
                            <select class="form-control" id="articles"><option>@ViewBag.lib</option></select>
                        </td>
                        @*<td>
                                <input type="text" class="form-control" id="descriptionProduit" required />
                            </td>*@
                        <td>
                            <input type="text" class="form-control" id="NumDevis" readonly="true" />
                        </td>
                        <td>
                            @*<textarea id="descriptionProduit">
                                </textarea>*@
                            <select class="form-control" id="descriptionProduit" style="width:180px; height:40px;"><option>@ViewBag.des</option></select>

                        </td>
                        <td>
                            <select class="form-control" name="marque" id="marque"><option>@ViewBag.ma</option></select>
                        </td>
                        <td>
                            <select class="form-control" name="unite" id="unite"><option>@ViewBag.un</option></select>
                        </td>
                        <td>
                            <select class="form-control" id="devise"><option>@ViewBag.dv</option></select>
                        </td>
                        <td>
                            <select class="form-control" id="categorie"><option>@ViewBag.ca</option> </select>
                        </td>
                        <td>
                            <select id="Sous_Categorie" name="Sous_Categorie" style="width:140px; height:35px;"><option>@ViewBag.sca</option></select>
                        </td>

                        @*<td>
                                <input type="text" class="form-control" id="StockProduit" readonly="true"required />
                            </td>*@
                        <td>
                            <input type="number" class="form-control" id="QuantiteProduit" value="1" min="1" />
                        </td>
                        <td>
                            <input type="number" class="form-control" id="PUHTProduit" value="0" min="0" />
                        </td>
                        <td>
                            <input type="number" class="form-control" id="marge" value="0" min="0" />
                        </td>
                        <td>
                            <input type="number" class="form-control" id="PUHTProduit2" value="0" min="0" />
                        </td>
                        <td>
                            <input type="number" class="form-control" id="RemiseProduit" value="0" min="0" />
                        </td>
                        <td>
                            <input type="number" class="form-control" id="PTHTProduit" value="0" readonly="true" />
                        </td>
                        @*<td>
                            <input type="number" class="form-control" id="TVAProduit" min="0"required />
                            </td>*@
                        <td>
                            <select class="form-control" id="TVAProduit"><option>@ViewBag.tv</option></select>
                        </td>
                        <td>
                            <input type="number" class="form-control" id="TTCProduit"  value="@ViewBag.ttc" readonly="true" />
                        </td>
                        <td style="display: flex; border-bottom-width: 0px; border-left-width: 0px; border-right-width: 0px;
                        border-top-width: 0px;" required>
                            <button class="btn btn-info btn-circle" type="button" onclick="AddRow()" id="FirstBTN">
                                <i class="fa fa-check"></i>
                            </button>
                            <button class="btn btn-warning btn-circle" type="button" disabled>
                                <i class="fa fa-times"></i>
                            </button>
                        </td>
                    </tr>
                </tfoot>
            </table>
        </div>
    }
</div>
@*@section Styles {
        @Styles.Render("~/Content/plugins/dataTables/dataTablesStyles")
    }*@
@section Scripts {
    <script src="~/js/bootstrap-datepicker.min.js" type="text/javascript"></script>
    <script src="~/js/select2.min.js" type="text/javascript"></script>
    @*<script src="~/Scripts/jquery-1.10.2.min.js"></script>*@
    <script src="https://code.jquery.com/jquery-1.10.2.js"></script>
    <script src="~/Scripts/bootstrap.js"></script>
    <script src="~/Scripts/bootstrap.min.js"></script>
    @Scripts.Render("~/plugins/select2")
    @Scripts.Render("~/plugins/dataPicker")
    @Scripts.Render("~/plugins/dataTables")
   <script>

        var PartielView1 = '/Vente/Client';
        $(function () {            $(".CLIENT").click(function () {
                var $buttonClicked = $(this);
                var options = { "backdrop": "static", keyboard: true };
                $.ajax({
                    type: "GET",
                    url: PartielView1,
                    contentType: "application/json; charset=utf-8",
                    data: "",
                    datatype: "json",
                    success: function (data) {
                        $('#myModalContent').html(data);
                        $('#myModal').modal(options);
                        $('#myModal').modal('show');

                    },
                    error: function () {
                        alert("Dynamic content load failed.");
                    }
                });
            });

            $("#closbtn").click(function () {
                $('#myModal').modal('hide');
            });

        });
    </script>
    <script type="text/javascript">
       //         $('#Tableau').dataTable({
       //             "bPaginate": false,
       //             "bInfo": false,
       //             "bFilter": false,
       //             "bAutoWidth": false,
       // "aoColumns": [
       //  { sWidth: '50px' },
       //  { sWidth: '100px' },
       //  { sWidth: '120px' },
       //  { sWidth: '30px' }
       //             ]
       //});

        $("#Li-Vente").attr("class", "active");
        $("#ul-Vente").attr("class", "nav nav-second-level collapse in");
        $("#ul-Vente").attr("aria-expanded", "true");
        RemplirListe();
        RemplirListe2();
        RemplirListe3();
        RemplirListe4();
        RemplirListe5();
        RemplirListe6();
        RemplirListe7();

        $("#date").datepicker({
            format: 'dd/mm/yyyy'
        });

        $("#client").select2();
            $("#marque").select2();
            $("#descriptionProduit").select2();
            $("#articles").select2();


        //$("#articles").select2();
        $("#TVAProduit").select2();
        $("#unite").select2();
        $("#devise").select2();
        $("#categorie").select2();
        $("#Sous_Categorie").select2();

        $("#societe").select2();
        var Mode = "@ViewBag.Mode";
        var client = "@Model.CLIENT";
        var dess = decodeHtml("@ViewBag.designation");
        $("#designation").val(dess);

      //var Societes = "@Model.Societes";
    //******************************************************************
        $('#client').append($('<option>', {
            value: "",
            text: ""
        }));

        $.ajax({
            type: 'POST',
            url: "/Vente/GetAllClient",
            success: function (response) {

                $.each(response, function (i, item) {
                    $('#client').append($('<option>', {
                        value: item.ID,
                        text: item.NOM

                    }));


                    if (Mode == "Edit") {
                        $("#client").val(client).trigger("change");
                    }
                    if (Mode == "Aff") {
                        $("#client").val(client).trigger("change");
                    }
                });
            }
        });
        //*********************************************************************************



        //$('#Societes').append($('<option>', {
        //    value: "",
        //    text: ""
        //}));

        //$.ajax({
        //    type: 'POST',
        //    url: "/Vente/GetAllSocietes",
        //    success: function (response) {

        //        $.each(response, function (i, item) {
        //            $('#Societes').append($('<option>', {
        //                value: item.SociID,
        //                text: item.NOM

        //            }));

        //            if (Mode == "Edit") {
        //                $("#Societes").val(Societes).trigger("change");
        //            }
        //        });
        //    }
        //});
        //*********************************************************************************
        //*****************************************************************************************************
        $(document).on("change", "#categorie", function (e) {
        //$("#categorie").change(function () {

            var selectedItemValue = $(this).val();

            var ddlProducts = $("#Sous_Categorie");
            $.ajax({
                cache: false,
                type: "GET",
                url: '@Url.Action("GetsousByCategoryId", "Vente")',
                data: { "id": selectedItemValue },
                success: function (data) {
                ddlProducts.html('');
                $.each(data, function (id, option) {
                    ddlProducts.append($('<option style="width:100px; height:50px;"></option>').val(option.id).html(option.name));
                });
                },
                error: function (xhr, ajaxOptions, thrownError) {
                alert('Found error to load sous categorie!!.');
                }
                });
                });
        //*****************************************************************************************************
         //--------------------------------------------------------------------------
        // $(document).on("change", "#Societes", function (e) {
        //        //$('#Societes').on('change', function () {
        //    $("#codeSoc").val("");
        //    if (this.value != "") {
        //        $.ajax({
        //            type: 'POST',
        //            url: "/Vente/GetSocByID?ID=" + this.value,
        //            success: function (response) {
        //                $("#codeSoc").val(response.CODE_ACCES);
        //            }
        //        });
        //    }
        //});
         //*****************************************************************************************************
        $("#client").change(function () {

            var selectedItemValue = $(this).val();

            var ddlProducts = $("#Tiers");
            $.ajax({
                cache: false,
                type: "GET",
                url: '@Url.Action("GetTiersBySocietesId", "Vente")',
                data: { "id": selectedItemValue },
                success: function (data) {
                ddlProducts.html('');
                $.each(data, function (id, option) {
                ddlProducts.append($('<option></option>').val(option.id).html(option.name));
                });
                },
                //error: function (xhr, ajaxOptions, thrownError) {
                //alert('Found error to load product!!.');
                //}
                });
                });
        //--------------------------------------------------------------------------
        function remplirChamps() {
            //$('#descriptionProduit').val("");
            debugger;
            //$('#devise').val("");
            //$('#categorie').val("");
            //$('#Sous_Categorie').val("");
            //$('#PUHTProduit').val("");
            //$('#TVAProduit').val("");
            //$('#PTHTProduit').val("");
            //$('#TTCProduit').val("");
            var lib = "@ViewBag.lib";
            var id = "@ViewBag.id";
            var des = decodeHtml("@ViewBag.des");
            var numd = "@ViewBag.NumD";
            var ma = decodeHtml("@ViewBag.ma");

            var un = "@ViewBag.un";
            var dv = "@ViewBag.dv";
            var ca = decodeHtml("@ViewBag.ca");
            var sca = decodeHtml("@ViewBag.sca");
            var pu = ("@ViewBag.pu").replace(",",".");
            var qt = "@ViewBag.qt";
            var tv = "@ViewBag.tv";
            var pth = ("@ViewBag.pth").replace(",", ".");
            var ttc = ("@ViewBag.ttc").replace(",", ".");

            id = parseInt(id);
            pu = parseFloat(pu).toFixed(3);
            pth = parseFloat(pth).toFixed(3);
            ttc = parseFloat(ttc).toFixed(3);
            qt = parseFloat(qt);
            $("#descriptionProduit option").text(des);
            $("#NumDevis").val(numd);

            $("#marque option").text(ma);
            //alert($("#marque").val());

            //alert($("#marque").val());
            //$('#marque option').text(ma);
            //$('#marque').find("select option:contains('"+ma+"')").filter(":selected");
            //$("#marque option").each(function (i, item) {
            //  if ($(this).attr("value") == ma) {
            //       $(this).attr("selected", true);
            //       $(this).attr("value") = ma;
            //  }
            //});
            //$("#marque option").filter(function () {
            //    return $(this).val() == ma;
            //}).prop("selected", true);
            //$('#marque option').prop('selected', true);
            //$("#marque option").select = ma;
            //$('#marque option[value=' + ma + ']').prop('selected', true);
            //alert($('#marque option').val());
            //$('#marque').select('val', ma);
            //$('marque').val(ma).trigger('change');

            //alert($('#marque').val());
            //$("#marque").val(ma).trigger("change");
            //if (m != "")
            //{
                //$("#marque").text(ma);
            //}
            //$('#marque').val(ma);
            //$("#unite").val(un).trigger("change");
            //$('#marque option[value=' + ma + ']').attr("selected", "selected");
            //$('#devise option[value=' + dv + ']').attr("selected", "selected");
            $("#unite option").text(un);
            $("#devise option").text(dv);
            $("#categorie option").text(ca);
            $("#Sous_Categorie option").text(sca);
            //$("#QuantiteProduit").val(qt);
            $("#TVAProduit option").text(tv);
            $("#PTHTProduit").val(pth);

            $("#TTCProduit").val(ttc);
            $("#PUHTProduit").val(pu);
            $("#PUHTProduit2").val(pu);

            $('#articles').val(id);
            $("#articles option").text(lib);

        }
        function decodeHtml(html) {
            var txt = document.createElement("textarea");
            txt.innerHTML = html;
            return txt.value;
        }
        if (Mode == "Create") {
            $("#DeleteBtn").attr("disabled", true);
            var liste = "@ViewBag.ListeDesPoduits";

            if (liste != "") {
                RemplirTableau();
            }
            else {
                remplirChamps();
            }

            //$("#articles option:selected").text(lib);


        }
        if (Mode == "Edit") {

            var designation = decodeHtml("@Model.Designation");
            $("#designation").val(designation);
            var remise = "@Model.REMISE";
            $("#remise").val(parseInt(remise));
            RemplirTableau();
            var codeFournisseur = "@ViewBag.CODE_FOURNISSEUR";
            var date = "@Model.DATE";
            date = date.replace(" 00:00:00", "");
            var modePaiement = "@Model.MODE_PAIEMENT";
            modePaiement = modePaiement.replace("&#232;", "è");
            modePaiement = modePaiement.replace("&#233;", "é");
            $("#date").val(date);
            //
            var totalHT = "@Model.THT";
            var NetHT = "@Model.NHT";
            var totalTVA = "@Model.TTVA";
            var TotalTTC = "@Model.TTC";
            var netAPaye = "@Model.TNET";

            totalHT = parseFloat(totalHT);
            NetHT = parseFloat(NetHT);
            totalTVA = parseFloat(totalTVA);
            TotalTTC = parseFloat(TotalTTC);
            netAPaye = parseFloat(netAPaye);

            $("#totalHT").val(totalHT.toFixed(3));
            $("#NetHT").val(NetHT.toFixed(3));
            $("#totalTVA").val(totalTVA.toFixed(3));
            $("#TotalTTC").val(TotalTTC.toFixed(3));
            $("#netAPaye").val(netAPaye.toFixed(3));
            $("#client").val(client).trigger("change");
            $("#codeClient").val(codeClient);
            //$("#Societes").val(Societes).trigger("change");
            //$("#codeSoc").val(codeSoc);
            $("#modePaiement option").each(function (i, item) {
                if ($(this).attr("value") == modePaiement) {
                    $(this).attr("selected", true);
                }
            });
            //

        }
        if (Mode == "Aff") {

            document.getElementById('date').disabled = true;
            document.getElementById('client').disabled = true;
            document.getElementById('Tiers').disabled = true;
            document.getElementById('modePaiement').disabled = true;
            document.getElementById('designation').disabled = true;
            document.getElementById('remise').disabled = true;

            var remise = "@Model.REMISE";
            var designation = decodeHtml("@Model.Designation");
            $("#designation").val(designation);
            $("#remise").val(parseInt(remise));
            RemplirTableau2();
            var codeFournisseur = "@ViewBag.CODE_FOURNISSEUR";
            var date = "@Model.DATE";
            date = date.replace(" 00:00:00", "");
            var modePaiement = "@Model.MODE_PAIEMENT";
            modePaiement = modePaiement.replace("&#232;", "è");
            modePaiement = modePaiement.replace("&#233;", "é");
            $("#date").val(date);

            var totalHT = "@Model.THT";
            var NetHT = "@Model.NHT";
            var totalTVA = "@Model.TTVA";
            var TotalTTC = "@Model.TTC";
            var netAPaye = "@Model.TNET";

            totalHT = parseFloat(totalHT);
            NetHT = parseFloat(NetHT);
            totalTVA = parseFloat(totalTVA);
            TotalTTC = parseFloat(TotalTTC);
            netAPaye = parseFloat(netAPaye);

            $("#totalHT").val(totalHT.toFixed(3));
            $("#NetHT").val(NetHT.toFixed(3));
            $("#totalTVA").val(totalTVA.toFixed(3));
            $("#TotalTTC").val(TotalTTC.toFixed(3));
            $("#netAPaye").val(netAPaye.toFixed(3));
            $("#client").val(client).trigger("change");
            $("#codeClient").val(codeClient);
            $("#modePaiement option").each(function (i, item) {
                if ($(this).attr("value") == modePaiement) {
                    $(this).attr("selected", true);
                }
            });


        }
        //******************************************************************
        //******************************************************************
            $(document).on("keydown", "input[type=number][data-modif!=edited]", function (e) {
            var Qte = $("#QuantiteProduit").val();
            //var marque = $('#marque').val();
            //var unite = $('#unite').val();
            //var devise = $('#devise').val();
            //var categorie = $('#categorie').val();
            Qte = parseFloat(Qte);
            var PRIX_VENTE_HT = parseFloat($('#PUHTProduit').val());
            var PrixTotHTSansRemise = Qte * PRIX_VENTE_HT;
            var Remise = $("#RemiseProduit").val();
            Remise = parseFloat(Remise);
            var MontantRemise = (PrixTotHTSansRemise * Remise) / 100;
            var PTHTProduit = PrixTotHTSansRemise - MontantRemise;
            $('#PTHTProduit').val(PTHTProduit.toFixed(3));
            var TVA = $('#TVAProduit').val();
            TVA = parseFloat(TVA);

            var MontantTVA = (PTHTProduit * TVA) / 100;

            var TTCProduit = PTHTProduit + MontantTVA;

            $('#TTCProduit').val(TTCProduit.toFixed(3));
        });
        $(document).on("keyup", "input[type=number][data-modif!=edited]", function (e) {
            var Qte = $("#QuantiteProduit").val();
            var marge = $("#marge").val();
            marge = parseFloat(marge);


            //var marque = $('#marque').val();
            //var unite = $('#unite').val();
            //var devise = $('#devise').val();
            //var categorie = $('#categorie').val();
            Qte = parseFloat(Qte);
            var PRIX_VENTE_HT = parseFloat($('#PUHTProduit').val());
            var PUHTProduit2 = PRIX_VENTE_HT + (marge * PRIX_VENTE_HT)/100;

            var PrixTotHTSansRemise = Qte * PUHTProduit2;
            $('#PUHTProduit2').val(PUHTProduit2.toFixed(3));

            var Remise = $("#RemiseProduit").val();
            Remise = parseFloat(Remise);
            var MontantRemise = (PrixTotHTSansRemise * Remise) / 100;
            var PTHTProduit = PrixTotHTSansRemise - MontantRemise;
            $('#PTHTProduit').val(PTHTProduit.toFixed(3));
            var TVA = $('#TVAProduit').val();
            TVA = parseFloat(TVA);
            var MontantTVA = (PTHTProduit * TVA) / 100;
            var TTCProduit = PTHTProduit + MontantTVA;
            $('#TTCProduit').val(TTCProduit.toFixed(3));
        });
                //**************************** CHANGE TVA******************

        $(document).on("change", "#TVAProduit", function (e) {

            var Qte = $("#QuantiteProduit").val();
            Qte = parseFloat(Qte);
            var PRIX_VENTE_HT = parseFloat($('#PUHTProduit').val());
            var PrixTotHTSansRemise = Qte * PRIX_VENTE_HT;
            var Remise = $("#RemiseProduit").val();
            Remise = parseFloat(Remise);
            var MontantRemise = (PrixTotHTSansRemise * Remise) / 100;
            var PTHTProduit = PrixTotHTSansRemise - MontantRemise;

            $('#PTHTProduit').val(PTHTProduit.toFixed(3));
             var TVA = $(this).val();
            TVA = parseFloat(TVA);
            var MontantTVA = (PTHTProduit * TVA) / 100;
            var TTCProduit = PTHTProduit + MontantTVA;

            $('#TTCProduit').val(TTCProduit.toFixed(3));

            });
            //**************************** CHANGE TVA******************

            $(document).on("change", "#NEW_TVA", function (e) {
                debugger;
                var Qte1 = $('#NEW_QTE').val();
                Qte1 = parseFloat(Qte1);
                var PRIX_VENTE_HT = parseFloat($('#NEW_PUHT').val());
                var PrixTotHTSansRemise = Qte1 * PRIX_VENTE_HT;
                var Remise = $('#NEW_REMISE').val();
                Remise = parseFloat(Remise);
                var MontantRemise = (PrixTotHTSansRemise * Remise) / 100;
                var PTHTProduit = PrixTotHTSansRemise - MontantRemise;
                $('#NEW_PTHT').val(PTHTProduit.toFixed(3));
                var TVA = $(this).val();
                TVA = parseFloat(TVA);
                var MontantTVA = (PTHTProduit * TVA) / 100;
                var TTCProduit = PTHTProduit + MontantTVA;
                $('#NEW_PTCT').text(TTCProduit.toFixed(3));

            });
        //*****************************Fournisseur*************************************
            $(document).on("keydown", "input[data-modif=edited]", function (e) {
            var Qte = $("#NEW_QTE").val();
            //var marque = $('#NEW_MARQUE').val();
            //var unite = $('#NEW_UNITE').val();
            //var devise = $('#NEW_DEVISE').val();
            //var categorie = $('#NEW_CATEGORIE').val();
            Qte = parseFloat(Qte);
            var PRIX_VENTE_HT = parseFloat($('#NEW_PUHT').val());
            var PrixTotHTSansRemise = Qte * PRIX_VENTE_HT;
            var Remise = $("#NEW_REMISE").val();
            Remise = parseFloat(Remise);
            var MontantRemise = (PrixTotHTSansRemise * Remise) / 100;
            var PTHTProduit = PrixTotHTSansRemise - MontantRemise;
            $('#NEW_PTHT').text(PTHTProduit.toFixed(3));
            var TVA = $("#NEW_TVA option").text();

            //var TVA = $('#NEW_TVA').val();
            TVA = parseFloat(TVA);
            var MontantTVA = (PTHTProduit * TVA) / 100;
            var TTCProduit = PTHTProduit + MontantTVA;
            $('#NEW_PTCT').text(TTCProduit.toFixed(3));
        });
            $(document).on("keyup", "input[data-modif=edited]", function (e) {
                debugger;
            var Qte = $("#NEW_QTE").val();
            //var marque = $('#NEW_MARQUE').val();
            //var unite = $('#NEW_UNITE').val();
            //var devise = $('#NEW_DEVISE').val();
            //var categorie = $('#NEW_CATEGORIE').val();
            Qte = parseFloat(Qte);
            var PRIX_VENTE_HT = parseFloat($('#NEW_PUHT').val());
            var PrixTotHTSansRemise = Qte * PRIX_VENTE_HT;
            var Remise = $("#NEW_REMISE").val();
            Remise = parseFloat(Remise);
            var MontantRemise = (PrixTotHTSansRemise * Remise) / 100;
            var PTHTProduit = PrixTotHTSansRemise - MontantRemise;
            $('#NEW_PTHT').text(PTHTProduit.toFixed(3));
            var TVA = $("#NEW_TVA option").text();
            TVA = parseFloat(TVA);
            var MontantTVA = (PTHTProduit * TVA) / 100;
            var TTCProduit = PTHTProduit + MontantTVA;
            $('#NEW_PTCT').text(TTCProduit.toFixed(3));
        });
        //******************************************************************
        $(document).on("click", "#Tableau tbody tr td", function (e) {
            var index = this.cellIndex;
            var html = this.innerText;
            var Parent = this.parentNode.id;
            var locked = $("#" + Parent).attr("data-locked");


                var CELL_QTE = $("#Tableau tbody tr[id=" + Parent + "] td")[8];
                var CELL_PUHT = $("#Tableau tbody tr[id=" + Parent + "] td")[10];
                var CELL_REMISE = $("#Tableau tbody tr[id=" + Parent + "] td")[12];
                var CELL_PTHT = $("#Tableau tbody tr[id=" + Parent + "] td")[13];
                var CELL_TVA = $("#Tableau tbody tr[id=" + Parent + "] td")[14];
                var CELL_PTTC = $("#Tableau tbody tr[id=" + Parent + "] td")[15];

                var TXT_QTE = $(CELL_QTE).html();
                var TXT_PUHT = $(CELL_PUHT).html();
                var TXT_REMISE = $(CELL_REMISE).html();
                var TXT_PTHT = $(CELL_PTHT).html();
                var TXT_TVA = $(CELL_TVA).html();
                var TXT_PTCT = $(CELL_PTTC).html();

                if (index ==8 && $(this).html().indexOf("number") < 0 && locked != "true") {
                    $(this).html("");
                    $(this).append("<input type='number' class='form-control' id='NEW_QTE' value='" + html + "' data-modif='edited'>");
                    //-----------------------------------------------------------------
                    $(CELL_PTHT).html("");
                    $(CELL_PTHT).append("<strong id='NEW_PTHT'>" + TXT_PTHT + "</strong>");
                    $(CELL_PTTC).html("");
                    $(CELL_PTTC).append("<strong id='NEW_PTCT'>" + TXT_PTCT + "</strong>");
                    //-----------------------------------------------------------------

                    $(CELL_PUHT).html("");
                    $(CELL_PUHT).append("<input type='number' class='form-control' id='NEW_PUHT' value='" + TXT_PUHT + "' data-modif='edited'>");

                    $(CELL_REMISE).html("");
                    $(CELL_REMISE).append("<input type='number' class='form-control' id='NEW_REMISE' value='" + TXT_REMISE + "' data-modif='edited'>");

                    $(CELL_TVA).html("");
                    $(CELL_TVA).append("<select type='number' class='form-control' id='NEW_TVA' value='" + TXT_TVA + "' data-modif='edited'><option>" + TXT_TVA + "</option></select>");
                    //-----------------------------------------------------------------

                    $("#BtnRow_" + Parent).attr("disabled", false);
                    LockRow(Parent);
                    RemplirListeNewTva();

                }
                if (index == 10 && $(this).html().indexOf("number") < 0 && locked != "true") {
                    $(this).html("");
                    $(this).append("<input type='number' class='form-control' id='NEW_PUHT' value='" + html + "' data-modif='edited'>");
                    $(CELL_PTHT).html("");
                    $(CELL_PTHT).append("<strong id='NEW_PTHT'>" + TXT_PTHT + "</strong>");
                    $(CELL_PTTC).html("");
                    $(CELL_PTTC).append("<strong id='NEW_PTCT'>" + TXT_PTCT + "</strong>");
                    //-----------------------------------------------------------------
                    $(CELL_QTE).html("");
                    $(CELL_QTE).append("<input type='number' class='form-control' id='NEW_QTE' value='" + TXT_QTE + "' data-modif='edited'>");


                    $(CELL_REMISE).html("");
                    $(CELL_REMISE).append("<input type='number' class='form-control' id='NEW_REMISE' value='" + TXT_REMISE + "' data-modif='edited'>");

                    $(CELL_TVA).html("");
                    $(CELL_TVA).append("<select type='number' class='form-control' id='NEW_TVA' value='" + TXT_TVA + "' data-modif='edited'><option>" + TXT_TVA + "</option></select>");
                    //-----------------------------------------------------------------
                    $("#BtnRow_" + Parent).attr("disabled", false);
                    LockRow(Parent);
                    RemplirListeNewTva();

                }
                if (index == 12 && $(this).html().indexOf("number") < 0 && locked != "true") {
                    $(this).html("");
                    $(this).append("<input type='number' class='form-control' id='NEW_REMISE' value='" + html + "' data-modif='edited'>");
                    $(CELL_PTHT).html("");
                    $(CELL_PTHT).append("<strong id='NEW_PTHT'>" + TXT_PTHT + "</strong>");
                    $(CELL_PTTC).html("");
                    $(CELL_PTTC).append("<strong id='NEW_PTCT'>" + TXT_PTCT + "</strong>");
                    //-----------------------------------------------------------------
                    $(CELL_QTE).html("");
                    $(CELL_QTE).append("<input type='number' class='form-control' id='NEW_QTE' value='" + TXT_QTE + "' data-modif='edited'>");


                    $(CELL_PUHT).html("");
                    $(CELL_PUHT).append("<input type='number' class='form-control' id='NEW_PUHT' value='" + TXT_PUHT + "' data-modif='edited'>");

                    $(CELL_TVA).html("");
                    $(CELL_TVA).append("<select type='number' class='form-control' id='NEW_TVA' value='" + TXT_TVA + "' data-modif='edited'><option>" + TXT_TVA + "</option></select>");
                    //-----------------------------------------------------------------
                    $("#BtnRow_" + Parent).attr("disabled", false);
                    LockRow(Parent);
                    RemplirListeNewTva();

                }
                if (index == 14 && $(this).html().indexOf("number") < 0 && locked != "true") {
                    $(this).html("");
                    $(this).append("<select type='number' class='form-control' id='NEW_TVA' value='" + html + "' data-modif='edited'><option>" + html +"</option></select>");
                    $(CELL_PTHT).html("");
                    $(CELL_PTHT).append("<strong id='NEW_PTHT'>" + TXT_PTHT + "</strong>");
                    $(CELL_PTTC).html("");
                    $(CELL_PTTC).append("<strong id='NEW_PTCT'>" + TXT_PTCT + "</strong>");
                    //-----------------------------------------------------------------
                    $(CELL_QTE).html("");
                    $(CELL_QTE).append("<input type='number' class='form-control' id='NEW_QTE' value='" + TXT_QTE + "' data-modif='edited'>");


                    $(CELL_PUHT).html("");
                    $(CELL_PUHT).append("<input type='number' class='form-control' id='NEW_PUHT' value='" + TXT_PUHT + "' data-modif='edited'>");

                    $(CELL_REMISE).html("");
                    $(CELL_REMISE).append("<input type='number' class='form-control' id='NEW_REMISE' value='" + TXT_REMISE + "' data-modif='edited'>");
                    //-----------------------------------------------------------------
                    $("#BtnRow_" + Parent).attr("disabled", false);
                    LockRow(Parent);
                    RemplirListeNewTva();

                }
        });
    $(document).ready(function () {

    });
    //--------------------------------------------------------------------------
    function LockRow(parampassed) {
        $("#Tableau tbody tr").each(function (i, item) {
            if ($(this).attr("id") != parampassed) {
                $(this).attr("data-locked", true);
            }
        });
    }
    //--------------------------------------------------------------------------
    function RemplirListe() {
        $('#articles').append($('<option>', {
            value: "",
            text: ""
        }));


        $.ajax({
            type: 'POST',
            url: "/Vente/GetAllProduct",
            success: function (response) {
                $.each(response, function (i, item) {
                    $('#articles').append($('<option>', {
                        value: item.ID,
                        text: item.Libelle_Prd
                    }));
                });
            }
        });
        }
        //--------------------------------------------------------------------------
                function RemplirListe2() {

                    $('#TVAProduit').append($('<option>', {
                        value: "",
                        text: ""
                    }));


                    $.ajax({
                        type: 'POST',
                        url: "/Vente/GetAllTVA",
                        success: function (response) {
                            $.each(response, function (i, item) {
                                $('#TVAProduit').append($('<option>', {
                                    value: item.Valeur_TVA,
                                    text: item.Valeur_TVA
                                }));
                            });
                        }
                    });
                }
        //--------------------------------------------------------------------------
        function RemplirListe3() {
            //$('#marque').find('option').remove();
                    $('#marque').append($('<option>', {
                        value: "",
                        text: ""
                    }));

                    $.ajax({
                        type: 'POST',
                        url: "/Vente/GetAllMarque",
                        success: function (response) {
                            $.each(response, function (i, item) {
                                $('#marque').append($('<option>', {
                                    value: item.Nom_marque,
                                    text: item.Nom_marque
                                }));
                            });
                        }
                    });
                }
        //------------------------------------------------------------------------------------------
                function RemplirListe4() {
                    $('#unite').append($('<option>', {
                        value: "",
                        text: ""
                    }));

                    $.ajax({
                        type: 'POST',
                        url: "/Vente/GetAllUnite",
                        success: function (response) {

                            $.each(response, function (i, item) {
                                $('#unite').append($('<option>', {
                                    value: item.Valeur_Unite,
                                    text: item.Valeur_Unite

                                }));

                            });
                        }
                    });
                }
        //-----------------------------------------------------------------------------------------
                function RemplirListe5() {
                    $('#devise').append($('<option>', {
                        value: "",
                        text: ""
                    }));

                    $.ajax({
                        type: 'POST',
                        url: "/Vente/GetAllDevise",
                        success: function (response) {

                            $.each(response, function (i, item) {
                                $('#devise').append($('<option>', {
                                    value: item.Nom_Devise,
                                    text: item.Nom_Devise

                                }));

                            });
                        }
                    });
                }
                //--------------------------------------------------------------------------------------

                function RemplirListe6() {
                    $('#categorie').append($('<option>', {
                        value: "",
                        text: ""
                    }));

                    $.ajax({
                        type: 'POST',
                        url: "/Vente/GetAllCategorie",
                        success: function (response) {

                            $.each(response, function (i, item) {
                                $('#categorie').append($('<option>', {
                                    value: item.CentreID,
                                    text: item.Libelle

                                }));

                            });
                        }
                    });
        }
        //--------------------------------------------------------------------------------------
        function RemplirListe7() {
            $('#descriptionProduit').append($('<option>', {
                value: "",
                text: ""
            }));

            $.ajax({
                type: 'POST',
                url: "/Vente/GetAllDescription",
                success: function (response) {
                    $.each(response, function (i, item) {
                        $('#descriptionProduit').append($('<option>', {
                            value: item,
                            text: item

                        }));

                    });
                }
            });
        }
                //--------------------------------------------------------------------------
                function RemplirListeNewTva() {

                    $('#NEW_TVA').append($('<option>', {
                        value: "",
                        text: ""
                    }));


                    $.ajax({
                        type: 'POST',
                        url: "/Vente/GetAllTVA",
                        success: function (response) {
                            $.each(response, function (i, item) {
                                $('#NEW_TVA').append($('<option>', {
                                    value: item.Valeur_TVA,
                                    text: item.Valeur_TVA
                                }));
                            });
                        }
                    });
        }
        //--------------------------------------------------------------------------
        $(document).on("change", "#date", function (e) {
            //$('#Societes').on('change', function () {
            //$("#codeSoc").val("");
            var code = "@ViewBag.Mode";
            var num = $("#numero").val();
            if (this.value != "") {
                //$("#numero").val("zzzzz");
                $.ajax({
                    type: 'POST',
                    url: "/Vente/GetNumeroDevis?DATE=" + this.value + "&Mode=" + code + "&Num=" + num,
                    success: function (response) {
                        $("#numero").val(response);
                    }
                });
            }
        });
         //--------------------------------------------------------------------------
        $(document).on("change", "#categorie", function (e) {
             $('#descriptionProduit').val("");
            $('#marque').val("");
            $('#unite').val("");
            $('#devise').val("");
            $('#Sous_Categorie').val("");
            $('#PUHTProduit').val("");
            $('#TVAProduit').val("");
            $('#PTHTProduit').val("");
            $('#TTCProduit').val("");
            var mode = "@ViewBag.Mode";
            var code = "@ViewBag.Code";
            //var num = ;
            var date = $("#date").val();
            var numero = $("#numero").val();
            var designation = $("#designation").val();
            var modePaiement = $("#modePaiement option:selected").text();
            var client = $("#client option:selected").text();
            var codeClient = $("#codeClient").val();
            var Tiers = $("#Tiers option:selected").text();
            var remise = $("#remise").val();

            @*var num = ;
            var date = "@ViewBag.Code";
            var paiement = "@ViewBag.Code";*@
            @*var client = "@ViewBag.Code";
            var t = "@ViewBag.Code";
            var code = "@ViewBag.Code";*@

            //var PartielView = '/Vente/Articlesdevis';
            var options = { "backdrop": "static", keyboard: true };
            $.ajax({
                type: "GET",
                url: "/Vente/ArticlesdevisCategorie?id=" + this.value + "&Mode=" + mode + "&Code=" + code + "&Date=" + date + "&Date=" + date + "&numero=" + numero + "&designation=" + designation + "&modePaiement=" + modePaiement + "&client=" + client + "&codeClient=" + codeClient + "&Tiers=" + Tiers + "&remise=" + remise,
                contentType: "application/json; charset=utf-8",
                data: "",
                datatype: "json",
                success: function (response) {
                    $('#myModalContent').html(response);
                    $('#myModal').modal(options);
                    $('#myModal').modal('show');
                },
                error: function () {
                    alert("Dynamic content load failed.");
                }
            });
            $("#closbtn").click(function () {
                $('#myModal').modal('hide');
            });
        });
         //--------------------------------------------------------------------------
        $(document).on("change", "#marque", function (e) {
            var selectedItemValue = $(this).val();
            $('#descriptionProduit').val("");
            $('#unite').val("");
            $('#devise').val("");
            $('#categorie').val("");
            $('#Sous_Categorie').val("");
            $('#PUHTProduit').val("");
            $('#TVAProduit').val("");
            $('#PTHTProduit').val("");
            $('#TTCProduit').val("");
            var mode = "@ViewBag.Mode";
            var code = "@ViewBag.Code";
            //var num = ;
            var date = $("#date").val();
            var numero = $("#numero").val();
            var designation = $("#designation").val();
            var modePaiement = $("#modePaiement option:selected").text();
            var client = $("#client option:selected").text();
            var codeClient = $("#codeClient").val();
            var Tiers = $("#Tiers option:selected").text();
            var remise = $("#remise").val();
            @*var num = ;
            var date = "@ViewBag.Code";
            var paiement = "@ViewBag.Code";*@
            @*var client = "@ViewBag.Code";
            var t = "@ViewBag.Code";
            var code = "@ViewBag.Code";*@

            //var PartielView = '/Vente/Articlesdevis';
            var options = { "backdrop": "static", keyboard: true };
            $.ajax({
                type: "GET",
                url: "/Vente/ArticlesdevisMarque?id=" + selectedItemValue + "&Mode=" + mode + "&Code=" + code + "&Date=" + date + "&Date=" + date + "&numero=" + numero + "&designation=" + designation + "&modePaiement=" + modePaiement + "&client=" + client + "&codeClient=" + codeClient + "&Tiers=" + Tiers + "&remise=" + remise,
                contentType: "application/json; charset=utf-8",
                data: "",
                datatype: "json",
                success: function (response) {
                    $('#myModalContent').html(response);
                    $('#myModal').modal(options);
                    $('#myModal').modal('show');
                },
                error: function () {
                    alert("Dynamic content load failed.");
                }
            });
            $("#closbtn").click(function () {
                $('#myModal').modal('hide');
            });
        });
         //--------------------------------------------------------------------------
        $(document).on("change", "#descriptionProduit", function (e) {
            $('#marque').val("");
            $('#unite').val("");
            $('#devise').val("");
            $('#categorie').val("");
            $('#Sous_Categorie').val("");
            $('#PUHTProduit').val("");
            $('#TVAProduit').val("");
            $('#PTHTProduit').val("");
            $('#TTCProduit').val("");
            var mode = "@ViewBag.Mode";
            var code = "@ViewBag.Code";
            //var num = ;
            var date = $("#date").val();
            var numero = $("#numero").val();
            var designation = $("#designation").val();
            var modePaiement = $("#modePaiement option:selected").text();
            var client = $("#client option:selected").text();
            var codeClient = $("#codeClient").val();
            var Tiers = $("#Tiers option:selected").text();
            var remise = $("#remise").val();


            //var PartielView = '/Vente/Articlesdevis';
            var options = { "backdrop": "static", keyboard: true };
            $.ajax({
                type: "GET",
                url: "/Vente/ArticlesdevisDes?id=" + this.value + "&Mode=" + mode + "&Code=" + code + "&Date=" + date + "&Date=" + date + "&numero=" + numero + "&designation=" + designation + "&modePaiement=" + modePaiement + "&client=" + client + "&codeClient=" + codeClient + "&Tiers=" + Tiers + "&remise=" + remise,
                contentType: "application/json; charset=utf-8",
                data: "",
                datatype: "json",
                success: function (response) {
                    $('#myModalContent').html(response);
                    $('#myModal').modal(options);
                    $('#myModal').modal('show');
                },
                error: function () {
                    alert("Dynamic content load failed.");
                }
            });
            $("#closbtn").click(function () {
                $('#myModal').modal('hide');
            });
        });
    //--------------------------------------------------------------------------
        $(document).on("change", "#articles", function (e) {
            $('#descriptionProduit').val("");
            $('#marque').val("");
            $('#unite').val("");
            $('#devise').val("");
            $('#categorie').val("");
            $('#Sous_Categorie').val("");
            $('#PUHTProduit').val("");
            $('#TVAProduit').val("");
            $('#PTHTProduit').val("");
            $('#TTCProduit').val("");
            var mode = "@ViewBag.Mode";
            var code = "@ViewBag.Code";
            var date = $("#date").val();
            var numero = $("#numero").val();
            var designation = $("#designation").val();
            var modePaiement = $("#modePaiement option:selected").text();

            var client = $("#client option:selected").text();
            var codeClient = $("#codeClient").val();
            var Tiers = $("#Tiers option:selected").text();
            var remise = $("#remise").val();

            @*var paiement = "@ViewBag.Code";*@
            @*var client = "@ViewBag.Code";
            var t = "@ViewBag.Code";
            var code = "@ViewBag.Code";*@

            //var PartielView = '/Vente/Articlesdevis';
            var options = { "backdrop": "static", keyboard: true };
            $.ajax({
                type: "GET",
                url: "/Vente/Articlesdevis?id=" + this.value + "&Mode=" + mode + "&Code=" + code + "&Date=" + date + "&Date=" + date + "&numero=" + numero + "&designation=" + designation + "&modePaiement=" + modePaiement + "&client=" + client + "&codeClient=" + codeClient + "&Tiers=" + Tiers + "&remise=" + remise,
                contentType: "application/json; charset=utf-8",
                data: "",
                datatype: "json",
                success: function (response) {
                    $('#myModalContent').html(response);
                    $('#myModal').modal(options);
                    $('#myModal').modal('show');
                },
                error: function () {
                    alert("Dynamic content load failed.");
                }
            });
            $("#closbtn").click(function () {
                $('#myModal').modal('hide');
            });
            @*$('#NumDevis').val("");
            $('#descriptionProduit').val("");
            $('#marque').val("");
            $('#unite').val("");
            $('#devise').val("");
            $('#categorie').val("");
            $('#Sous_Categorie').val("");
            $('#TVAProduit').val("");
            $('#PTHTProduit').val("");
            $('#TTCProduit').val("");
            $('#StockProduit').val("");
            $('#PUHTProduit').val("");
            $.ajax({
                type: 'POST',
                url: "/Vente/GetProductByID?ID=" + this.value,
                success: function (response) {
                    $('#NumDevis').val(response.DEVIS_FRS);
                    $('#descriptionProduit').val(response.Designation);
                    $('#marque').val(response.Marque);
                    // $('#marque').select() == response.Marque;
                    //$('#marque').selectable.val(response.Marque);
                    //$("#marque option:selected") = response.Marque;
                    $('#unite').val(response.Unite);
                    $('#devise').val(response.Devise);
                    $('#categorie').val(response.Categorie);
                   // $('#Sous_Categorie').val(response.Sous_CATEGORIE);
                    var selectedItemValue = $('#categorie').val();

            var ddlProducts = $("#Sous_Categorie");
            $.ajax({
                cache: false,
                type: "GET",
                url: '@Url.Action("GetsousByCategoryId", "Vente")',
                data: { "id": selectedItemValue },
                success: function (data) {
                ddlProducts.html('');
                $.each(data, function (id, option) {
                ddlProducts.append($('<option></option>').val(option.id).html(option.name));
                });
                },
                error: function (xhr, ajaxOptions, thrownError) {
                alert('Found error to load sous categorie!!.');
                }
            });


                    $('#StockProduit').val(response.Stock);
                    $('#PUHTProduit').val(response.PU_HT_Sans_Remise);
                    $('#TVAProduit').val(response.Valeur_TVA);
                    //var Qte = $("#QuantiteProduit").val();
                    //Qte = parseFloat(Qte);
                    //var PRIX_VENTE_HT = parseFloat(response.PRIX_VENTE_HT);
                    //var PrixTotHTSansRemise = Qte * PRIX_VENTE_HT;
                    //var Remise = $("#RemiseProduit").val();
                    //Remise = parseFloat(Remise);
                    //var MontantRemise = (PrixTotHTSansRemise * Remise) / 100;
                    //var PTHTProduit = PrixTotHTSansRemise - MontantRemise;
                    $('#PTHTProduit').val(response.PU_HT_Avec_Remise);
                    //var TVA = $('#TVAProduit').val();
                    //TVA = parseFloat(TVA);
                    //var MontantTVA = (PTHTProduit * TVA) / 100;
                    //var TTCProduit = PTHTProduit + MontantTVA;
                    //$('#TTCProduit').val(TTCProduit);
                    $('#TTCProduit').val(response.PU_TTC);
                    var MaxQuantite = $("#StockProduit").val();
                    MaxQuantite = parseInt(MaxQuantite);
                    if (MaxQuantite > 0) {
                        $("#QuantiteProduit").attr("max", MaxQuantite);
                    }
                }
            });
            $('#FirstBTN').attr("disabled", false);*@
        });
    //--------------------------------------------------------------------------
    $(document).on("change", "#client", function (e) {
        $("#codeClient").val("");
        if (this.value != "") {
            $.ajax({
                type: 'POST',
                url: "/Vente/GetClientByID?ID=" + this.value,
                success: function (response) {
                    $("#codeClient").val(response.CODE);
                }
            });
        }
        });
        //--------------------------------------------------------------------------
        //$(document).on("change", "#Societes", function (e) {
        // $("#codeSoc").val("");
        //    if (this.value != "") {
        //        $.ajax({
        //            type: 'POST',
        //            url: "/Vente/GetSocByID?ID=" + this.value,
        //            success: function (response) {
        //                $("#codeSoc").val(response.CODE_ACCES);
        //            }
        //        });
        //    }
        //});
    //--------------------------------------------------------------------------
        $(document).on("keyup", "#remise", function (e) {

        var remise = $("#remise").val();

        var totalHT = $("#totalHT").val();
        var totalTVA = window.totalTVA;
        totalHT = parseFloat(totalHT);

        totalTVA = parseFloat(totalTVA);
        var NewTotalTva = totalTVA - ((totalTVA * remise) / 100);
        NewTotalTva = parseFloat(NewTotalTva);
        $("#totalTVA").val(NewTotalTva.toFixed(3));
        var NetHT = totalHT - ((totalHT * remise) / 100);

        NetHT = parseFloat(NetHT);
        $("#NetHT").val(NetHT.toFixed(3));
        var TotalTTC = NetHT + NewTotalTva;
        $("#TotalTTC").val(TotalTTC.toFixed(3));
        $("#netAPaye").val(TotalTTC.toFixed(3));
    });
    //--------------------------------------------------------------------------
          @*function AddRow() {

            var NumDevis = $('#NumDevis').val();
            //var ID_Produit = $('#articles').val();
            var ID_Produit = "@ViewBag.id";
            var LIB_Produi = $("#articles option:selected").text();
            var Description_Produit = $('#descriptionProduit').val();
            var marque = $("#marque option:selected").text();
            var unite = $("#unite option:selected").text();
            var devise = $("#devise option:selected").text();
            var categorie = $("#categorie option:selected").text();
            var sous_categorie = $("#Sous_Categorie option:selected").text();
            //var StockProduit = $("#StockProduit").val();
            var Quantite_Produit = $('#QuantiteProduit').val();
            var PUHT_Produit = $('#PUHTProduit').val();
            var Remise_Produit = $('#RemiseProduit').val();
            var PTHT_Produit = $('#PTHTProduit').val();
            var TVA_Produit = $("#TVAProduit option:selected").text();
            var TTC_Produit = $('#TTCProduit').val();

            var data = {
                ID_Produit: ID_Produit,
                NumDevis: NumDevis,
                LIB_Produi: LIB_Produi,
                Description_Produit: Description_Produit,
                marque: marque,
                unite: unite,
                devise: devise,
                categorie: categorie,
                sous_categorie: sous_categorie,
                //StockProduit: StockProduit,
                Quantite_Produit: Quantite_Produit,
                PUHT_Produit: PUHT_Produit,
                Remise_Produit: Remise_Produit,
                PTHT_Produit: PTHT_Produit,
                TVA_Produit: TVA_Produit,
                TTC_Produit: TTC_Produit
            };


            $.ajax({
                type: 'POST',
                url: "/Vente/AddLineDevis",
                data: data,
                success: function (response) {
                    RemplirTableau11();



                }
            });
        }*@
        function AddRow() {
            debugger;
            var NumDevis = $('#NumDevis').val();
            //var ID_Produit = $('#articles').val();
            var ID_Produit = "@ViewBag.id";
            var LIB_Produi = $("#articles option:selected").text();
            var Description_Produit = $('#descriptionProduit').val();
            var index11 = Description_Produit.indexOf('&');
            if (index11 != -1) {
                var index22 = Description_Produit.indexOf(';');
                index11 = parseInt(index11);
                index22 = parseInt(index22);
                var des1 = Description_Produit.substring(index11, index22 + 1);
                var Description_Produit2 = Description_Produit.replace(des1, "");
                var index33 = Description_Produit.indexOf('#');
                var des2 = Description_Produit.substring(index33+1, index22);
            }
            else {
                var Description_Produit2 = Description_Produit;
            }
            var marque = $("#marque option:selected").text();
            var unite = $("#unite option:selected").text();
            var devise = $("#devise option:selected").text();
            var categorie = $("#categorie option:selected").text();
            var sous_categorie = $("#Sous_Categorie option:selected").text();
            var index = sous_categorie.indexOf('&');
            if (index != -1) {
                var index2 = sous_categorie.indexOf(';');
                //var length = sous_categorie.length;
                index = parseInt(index);
                index2 = parseInt(index2);
                var sscat2 = sous_categorie.substring(index, index2 + 1);
                var sous_categorie2 = sous_categorie.replace(sscat2, "");
                var index22 = sous_categorie.indexOf('#');
                var sscat3 = sous_categorie.substring(index22+1, index2);

            }
            else {
                var sous_categorie2 = sous_categorie;
            }

            //var StockProduit = $("#StockProduit").val();
            var Quantite_Produit = $('#QuantiteProduit').val();
            var PUHT_Produit = $('#PUHTProduit').val();
            var PUHT_Produit2 = $('#PUHTProduit2').val();
            var Marge = $('#marge').val();
            var Remise_Produit = $('#RemiseProduit').val();
            var PTHT_Produit = $('#PTHTProduit').val();
            var TVA_Produit = $("#TVAProduit option:selected").text();
            var TTC_Produit = $('#TTCProduit').val();

            var data = {
                ID_Produit: ID_Produit,
                NumDevis: NumDevis,
                LIB_Produi: LIB_Produi,
                Description_Produit: Description_Produit2,
                marque: marque,
                unite: unite,
                devise: devise,
                categorie: categorie,
                sous_categorie: sous_categorie2,
                //StockProduit: StockProduit,
                Quantite_Produit: Quantite_Produit,
                PUHT_Produit: PUHT_Produit,
                PUHT_Produit2: PUHT_Produit2,
                Marge: Marge,
                Remise_Produit: Remise_Produit,
                PTHT_Produit: PTHT_Produit,
                TVA_Produit: TVA_Produit,
                TTC_Produit: TTC_Produit,
                des1: des2,
                sscat2: sscat3,
                index11: index11,
                index22: index22

            };


            $.ajax({
                type: 'POST',
                url: "/Vente/AddLineDevis",
                data: data,
                success: function (response) {
                    RemplirTableau11();



                }
            });
        }
    //}
    //--------------------------------------------------------------------------
        function RemplirTableau() {
            $("#Tableau tbody").empty();

        $.ajax({
            type: 'POST',
            url: "/Vente/GetAllLineDevis",
            success: function (response) {
                $.each(response, function (i, item) {

                    var line = "<tr id='" + item.ID + "'><td>" + item.LIBELLE + "</td><td>" + item.NumDevis + "</td><td>" + item.DESIGNATION + "</td><td>" + item.MARQUE + "</td><td>" + item.UNITE + "</td><td>" + item.DEVISE + "</td><td>" + item.CATEGORIE + "</td><td>" + item.Sous_CATEGORIE + "</td><td>" + item.QUANTITE + "</td><td>" + item.PRIX_VENTE_HT + "</td><td>" + item.MARGE + "</td><td>" + item.PRIX_VENTE_HT2 + "</td><td>" + item.REMISE + "</td><td>" + item.PTHT + "</td><td>" + item.TVA + "</td><td>" + item.TTC + "</td><td style='display: flex; border-bottom-width: 0px; border-left-width: 0px; border-right-width: 0px; border-top-width: 0px;'> <button class='btn btn-info btn-circle' type='button' onclick='EditRow(\"" + item.ID + "\")' disabled id='BtnRow_" + item.ID + "'> <i class='fa fa-check'></i> </button> <button class='btn btn-warning btn-circle' type='button' onclick='DeleteRow(\"" + item.ID + "\")'> <i class='fa fa-times'></i> </button> </td></tr>";
                    $("#Tableau tbody").append(line);
                });
                $("#Tableau tfoot").replaceWith("<tfoot> <tr> <td>  <select class='form-control' id='articles'><option>@ViewBag.lib</option></select></td> <td> <input type='text' class='form-control' id='NumDevis' readonly='true' /> </td> <td><select class='form-control'  name='descriptionProduit' id='descriptionProduit'><option>@ViewBag.des</option> </select> </td><td> <select class='form-control' id='marque'><option>@ViewBag.ma</option></select> </td><td> <select class='form-control' id='unite'><option>@ViewBag.un</option></select></td><td> <select class='form-control' id='devise'><option>@ViewBag.dv</option></select> </td><td> <select class='form-control' id='categorie'><option>@ViewBag.ca</option> </select> </td><td> <select class='form-control' name='Sous_Categorie' id='Sous_Categorie'><option>@ViewBag.sca</option></select></td> <td> <input type='number' class='form-control' id='QuantiteProduit' value='1' min='1'/> </td> <td> <input type='number' class='form-control' id='PUHTProduit' min='0'/> </td> <td> <input type='number' class='form-control' id='marge' value='0' min='0'/> </td> <td> <input type='number' class='form-control' id='PUHTProduit2' min='0'/> </td> <td> <input type='number' class='form-control' id='RemiseProduit' value='0' min='0' /> </td> <td> <input type='number' class='form-control' id='PTHTProduit' readonly='true' /> </td> <td> <select class='form-control' id='TVAProduit'><option>@ViewBag.tv</option></select> </td> <td> <input type='number' class='form-control' id='TTCProduit' readonly='true' /> </td> <td style='display: flex; border-bottom-width: 0px; border-left-width: 0px; border-right-width: 0px; border-top-width: 0px;'> <button class='btn btn-info btn-circle' type='button' onclick='AddRow()'  id='FirstBTN'> <i class='fa fa-check'></i> </button> <button class='btn btn-warning btn-circle' type='button' disabled> <i class='fa fa-times'></i> </button> </td> </tr> </tfoot>");
                $("#marque").select2();
                $("#descriptionProduit").select2();
                $("#articles").select2();
                $("#TVAProduit").select2();
                $("#unite").select2();
                $("#devise").select2();
                $("#categorie").select2();
                $("#Sous_Categorie").select2();
                remplirChamps();
                RemplirListe();
                RemplirListe2();
                RemplirListe3();
                RemplirListe4();
                RemplirListe5();
                RemplirListe6();
                RemplirListe7();




            }
        });



        UpdatePrice();

        }
        //--------------------------------------------------------------------------
        function RemplirTableau11() {
            $("#Tableau tbody").empty();

            $.ajax({
                type: 'POST',
                url: "/Vente/GetAllLineDevis",
                success: function (response) {
                    $.each(response, function (i, item) {
                        var line = "<tr id='" + item.ID + "'><td>" + item.LIBELLE + "</td><td>" + item.NumDevis + "</td><td>" + item.DESIGNATION + "</td><td>" + item.MARQUE + "</td><td>" + item.UNITE + "</td><td>" + item.DEVISE + "</td><td>" + item.CATEGORIE + "</td><td>" + item.Sous_CATEGORIE + "</td><td>" + item.QUANTITE + "</td><td>" + item.PRIX_VENTE_HT + "</td><td>" + item.MARGE + "</td><td>" + (item.PRIX_VENTE_HT2).toFixed(3) + "</td><td>" + item.REMISE + "</td><td>" + item.PTHT + "</td><td>" + item.TVA + "</td><td>" + item.TTC + "</td><td style='display: flex; border-bottom-width: 0px; border-left-width: 0px; border-right-width: 0px; border-top-width: 0px;'> <button class='btn btn-info btn-circle' type='button' onclick='EditRow(\"" + item.ID + "\")' disabled id='BtnRow_" + item.ID + "'> <i class='fa fa-check'></i> </button> <button class='btn btn-warning btn-circle' type='button' onclick='DeleteRow(\"" + item.ID + "\")'> <i class='fa fa-times'></i> </button> </td></tr>";
                        $("#Tableau tbody").append(line);
                    });
                    $("#Tableau tfoot").replaceWith("<tfoot><tr> <td><select class='form-control' id='articles'><option></option></select></td> <td> <input type='text' class='form-control' id='NumDevis' readonly='true' /> </td> <td><select class='form-control' name='descriptionProduit' id='descriptionProduit'><option></option> </select> </td><td> <select class='form-control' id='marque'><option></option></select> </td><td> <select class='form-control' id='unite'></select> </td><td> <select class='form-control' id='devise'><option></option></select> </td><td> <select class='form-control' id='categorie'><option></option> </select> </td><td> <select class='form-control' name='Sous_Categorie' id='Sous_Categorie'><option></option>  </select></td> <td> <input type='number' class='form-control' id='QuantiteProduit' value='1' min='1'/> </td> <td> <input type='number' class='form-control' id='PUHTProduit' min='0'/> </td> <td> <input type='number' class='form-control' id='marge' min='0'/> </td> <td> <input type='number' class='form-control' id='PUHTProduit2' min='0'/> </td> <td> <input type='number' class='form-control' id='RemiseProduit' value='0' min='0' /> </td> <td> <input type='number' class='form-control' id='PTHTProduit' readonly='true' /> </td> <td> <select class='form-control' id='TVAProduit'><option></option> </select> </td> <td> <input type='number' class='form-control' id='TTCProduit' readonly='true' /> </td> <td style='display: flex; border-bottom-width: 0px; border-left-width: 0px; border-right-width: 0px; border-top-width: 0px;'> <button class='btn btn-info btn-circle' type='button' onclick='AddRow()'  id='FirstBTN'> <i class='fa fa-check'></i> </button> <button class='btn btn-warning btn-circle' type='button' disabled> <i class='fa fa-times'></i> </button> </td> </tr> </tfoot>");
                    $("#marque").select2();
                    $("#descriptionProduit").select2();
                    $("#articles").select2();
                    $("#TVAProduit").select2();
                    $("#unite").select2();
                    $("#devise").select2();
                    $("#categorie").select2();
                    $("#Sous_Categorie").select2();
                    RemplirListe();
                    RemplirListe2();
                    RemplirListe3();
                    RemplirListe4();
                    RemplirListe5();
                    RemplirListe6();
                    RemplirListe7();




                }
            });



            UpdatePrice();

        }
        //---------------------------------------------------------------------------

    //--------------------------------------------------------------------------
    function RemplirTableau2() {

        $("#Tableau tbody").empty();

        $.ajax({
            type: 'POST',
            url: "/Vente/GetAllLineDevis",
            success: function (response) {
                $.each(response, function (i, item) {

                    var line = "<tr id='" + item.ID + "'><td>" + item.LIBELLE + "</td><td>" + item.NumDevis + "</td><td>" + item.DESIGNATION + "</td><td>" + item.MARQUE + "</td><td>" + item.UNITE + "</td><td>" + item.DEVISE + "</td><td>" + item.CATEGORIE + "</td><td>" + item.Sous_CATEGORIE + "</td><td>" + item.QUANTITE + "</td><td>" /*+ item.QUANTITELiv + "</td><td>" + item.QUANTITERES + "</td><td>" */ + item.PRIX_VENTE_HT + "</td><td>" + item.MARGE + "</td><td>" + item.PRIX_VENTE_HT2 + "</td><td>" + item.REMISE + "</td><td>" + item.PTHT + "</td><td>" + item.TVA + "</td><td>" + item.TTC + "</td><td style='display: flex; border-bottom-width: 0px; border-left-width: 0px; border-right-width: 0px; border-top-width: 0px;'> <button class='btn btn-info btn-circle' type='button' onclick='EditRow(\"" + item.ID + "\")' disabled id='BtnRow_" + item.ID + "'> <i class='fa fa-check'></i> </button> <button class='btn btn-warning btn-circle' type='button' onclick='DeleteRow(\"" + item.ID + "\")'> <i class='fa fa-times'></i> </button> </td></tr>";
                    $("#Tableau tbody").append(line);
                });
                $("#Tableau tfoot").empty();

                RemplirListe();
                RemplirListe2();
                RemplirListe3();
                RemplirListe4();
                RemplirListe5();
                RemplirListe6();
                RemplirListe7();

            }
        });
        }
        //--------------------------------------------------------------------------
        function RemplirTableau3() {
            $.ajax({
                type: 'POST',
                url: "/Vente/GetAllLineDevis2",
                success: function (response) {
                    $("#Tableau tfoot").replaceWith("<tfoot> <tr id='" + response.ID + "'> <td> <select class='form-control' name='articles'  id='articles'><option value='" + response.ID + "'>" + response.LIBELLE + "</option></select> </td> <td> <input type='text' class='form-control' id='NumDevis'value='" + response.NumDevis + "' readonly='true'/></td> <td><textarea name='descriptionProduit' id='descriptionProduit'>" + response.DESIGNATION + " </textarea ></td><td> <select class='form-control' id='marque'><option> " + response.MARQUE + "</option></select> </td><td> <select class='form-control' id='unite'><option>" + response.UNITE + "</option></select> </td><td> <select class='form-control' id='devise'><option>" + response.DEVISE + "</option> </select> </td><td> <select class='form-control' id='categorie'><option>" + response.CATEGORIE + "</option> </select> </td><td> <select class='form-control' name='Sous_Categorie' id='Sous_Categorie'><option> " + response.Sous_CATEGORIE + " </option> </select> </td><td> <input type='number' class='form-control' id='QuantiteProduit' value='" + response.QUANTITE + "' min='1'/> </td> <td> <input type='number' class='form-control' id='PUHTProduit' value='" + response.PRIX_VENTE_HT + "' min='0'/> </td> <td> <input type='number' class='form-control' id='RemiseProduit' value='" + response.REMISE + "' min='0' /> </td> <td> <input type='number' class='form-control' id='PTHTProduit' value='" + response.PTHT + "' readonly='true' /> </td> <td> <select class='form-control' id='TVAProduit' ><option> " + response.TVA + "</option> </select> </td> <td> <input type='number' class='form-control' id='TTCProduit' readonly='true' value='" + response.TTC + "'/> </td> <td style='display: flex; border-bottom-width: 0px; border-left-width: 0px; border-right-width: 0px; border-top-width: 0px;'> <button class='btn btn-info btn-circle' type='button' onclick='AddRow()'> <i class='fa fa-check'></i> </button> <button class='btn btn-warning btn-circle' type='button' disabled> <i class='fa fa-times'></i> </button> </td> </tr> </tfoot>");

                    RemplirListe();
                    RemplirListe2();
                    RemplirListe3();
                    RemplirListe4();
                    RemplirListe5();
                    RemplirListe6();
                    RemplirListe7();

                }
            });



            UpdatePrice2();

        }

    //---------------------------------------------------------------------------

    function EditRow(parampassed) {
        var ID_Produit = parampassed;
        var Quantite_Produit = $('#NEW_QTE').val();
        var PUHT_Produit = $('#NEW_PUHT').val();
        var Remise_Produit = $('#NEW_REMISE').val();
        var PTHT_Produit = $('#NEW_PTHT').text();
        var TVA_Produit = $('#NEW_TVA').val();
        var TTC_Produit = $('#NEW_PTCT').text();
        var data = {
            ID_Produit: ID_Produit,
            Quantite_Produit: Quantite_Produit,
            PUHT_Produit: PUHT_Produit,
            Remise_Produit: Remise_Produit,
            PTHT_Produit: PTHT_Produit,
            TVA_Produit: TVA_Produit,
            TTC_Produit: TTC_Produit
        };
        $.ajax({
            type: 'POST',
            data: data,
            url: "/Vente/EditLineDevis",
            success: function (response) {
                RemplirTableau();
            }
        });
    }
    //---------------------------------------------------------------------------
    function DeleteRow(parampassed) {
        $.ajax({
            type: 'POST',
            url: "/Vente/DeleteLineDevis?parampassed=" + parampassed,
            success: function (response) {
                RemplirTableau();
            }
        });
    }
    //---------------------------------------------------------------------------

        function UpdatePrice() {

        var remise = $("#remise").val();
        $.ajax({
            type: 'POST',
            url: "/Vente/UpdatePriceDevis?remise=" + remise,
            success: function (response) {

                var totalHT = response.totalHT;

                var totalTVA = response.totalTVA;

                window.totalTVA = totalTVA;
                totalHT = parseFloat(totalHT);
                totalTVA = parseFloat(totalTVA);
                $("#totalHT").val(totalHT.toFixed(3));
                var NewTotalTva = totalTVA - ((totalTVA * remise) / 100);
                NewTotalTva = parseFloat(NewTotalTva);
                $("#totalTVA").val(NewTotalTva.toFixed(3));
                var NetHT = totalHT - ((totalHT * remise) / 100);
                NetHT = parseFloat(NetHT);
                $("#NetHT").val(NetHT);
                var TotalTTC = NetHT + NewTotalTva;
                $("#TotalTTC").val(TotalTTC.toFixed(3));
                $("#netAPaye").val(TotalTTC.toFixed(3));
            }
        });
        }
        //---------------------------------------------------------------------------

        function UpdatePrice2() {

            var remise = $("#remise").val();
            $.ajax({
                type: 'POST',
                url: "/Vente/UpdatePriceDevis2?remise=" + remise,
                success: function (response) {

                    var totalHT = response.totalHT;

                    var totalTVA = response.totalTVA;

                    window.totalTVA = totalTVA;
                    totalHT = parseFloat(totalHT);
                    totalTVA = parseFloat(totalTVA);
                    $("#totalHT").val(totalHT.toFixed(3));
                    var NewTotalTva = totalTVA - ((totalTVA * remise) / 100);
                    NewTotalTva = parseFloat(NewTotalTva);
                    $("#totalTVA").val(NewTotalTva.toFixed(3));
                    var NetHT = totalHT - ((totalHT * remise) / 100);
                    NetHT = parseFloat(NetHT);
                    $("#NetHT").val(NetHT);
                    var TotalTTC = NetHT + NewTotalTva;
                    $("#TotalTTC").val(TotalTTC.toFixed(3));
                    $("#netAPaye").val(TotalTTC.toFixed(3));
                }
            });
        }
        //-------------------------------------------------------

        //-------------------------------------------------------

        function UpdateTva() {

            var Qte = $("#QuantiteProduit").val();
            Qte = parseFloat(Qte);
            var PRIX_VENTE_HT = parseFloat($('#PUHTProduit').val());
            var PrixTotHTSansRemise = Qte * PRIX_VENTE_HT;
            var Remise = $("#RemiseProduit").val();
            Remise = parseFloat(Remise);
            var MontantRemise = (PrixTotHTSansRemise * Remise) / 100;
            var PTHTProduit = PrixTotHTSansRemise - MontantRemise;

            $('#PTHTProduit').val(PTHTProduit.toFixed(3));
            var TVA = $('#TVAProduit').val();
            TVA = parseFloat(TVA);
            var MontantTVA = (PTHTProduit * TVA) / 100;
            var TTCProduit = PTHTProduit + MontantTVA;

            $('#TTCProduit').val(TTCProduit.toFixed(3));

        }
        //---------------------------------------------------------------------------
        function imp() {
            $("#WithPrint").val("true");
        $("form").attr("target", "_blank");
        $("form").submit();
        $("#WithPrint").val("false");
        $("form").attr("target", "_self");
        }
    //    $("#PrintBTN").click(function () {
    //        debugger;
    //    $("#WithPrint").val("true");
    //    $("form").attr("target", "_blank");
    //    $("form").submit();
    //    $("#WithPrint").val("false");
    //    $("form").attr("target", "_self");
    //});
    //---------------------------------------------------------------------------
    $("#DeleteBtn").click(function () {
        Delete();
    });
    function Delete() {
        var parampassed = "@ViewBag.Code";
        var Conf = confirm("Voulez vous Supprimer cet elément ?");
        if (Conf == true) {
            $.ajax({
                type: 'POST',
                url: "/Vente/DeleteDevis?parampassed=" + parampassed,
                success: function (response) {
                    window.location = "/Vente/Devis";
                }
            });
        }
        var preloader = $('<div>', { 'class': 'preloader' }).appendTo('body');
        $(this)
               .ajaxStart(function () {
                   preloader.fadeIn();
               })
               .ajaxStop(function () {
                   preloader.delay(800).fadeOut();
               });
    }
    //---------------------------------------------------------------------------
    $('form').validate({
        rules: {
            client: {
                required: true
            }
        }
    });
        //---------------------------------------------------------------------------

    $("#VersCommande").click(function () {
        VersCommande();
    });
    function VersCommande() {

        var parampassed = "@ViewBag.Code";

        var Conf = confirm("Voulez vous transformer ce devis en commande client ?");
        if (Conf == true) {
            $.ajax({
                type: 'POST',
                url: "/Vente/DevisVersCommande?parampassed=" + parampassed,
                success: function (response) {
                    window.location.href = "/Vente/FormCommande?Mode=Edit&Code=" + response;
                }
            });
        }
        var preloader = $('<div>', { 'class': 'preloader' }).appendTo('body');
        $(this)
               .ajaxStart(function () {
                   preloader.fadeIn();
               })
               .ajaxStop(function () {
                   preloader.delay(800).fadeOut();
               });
    }
    //--------------------------------------------------------------------------------
    $("#VersFacture").click(function () {
        VersFacture();
    });
    function VersFacture() {
        var parampassed = "@ViewBag.Code";
        var Conf = confirm("Voulez vous transformer ce devis en facture ?");
        if (Conf == true) {
            $.ajax({
                type: 'POST',
                url: "/Vente/DevisVersfacture?parampassed=" + parampassed,
                success: function (response) {
                    window.location.href = "/Vente/FormFacture?Mode=Edit&Code=" + response;
                }
            });
        }
        var preloader = $('<div>', { 'class': 'preloader' }).appendTo('body');
        $(this)
               .ajaxStart(function () {
                   preloader.fadeIn();
               })
               .ajaxStop(function () {
                   preloader.delay(800).fadeOut();
               });
    }
    </script>

}
