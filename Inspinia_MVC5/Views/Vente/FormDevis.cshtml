@*<head>
			<meta http-equiv="content-type" content="text/html; charset=ISO-8859-1">
	</head>*@
@*@Html.Raw(Model.ToHtmlString())*@
@{
	double somme = 0;

}
<link href="~/Content/bootstrap-datepicker3.min.css" rel="stylesheet" type="text/css" />
<link href="~/Content/select2.min.css" rel="stylesheet" type="text/css" />
<style type="text/css">
	th {
		white-space: nowrap;
	}

	input[type=number]::-webkit-inner-spin-button, input[type=number]::-webkit-outer-spin-button {
		-webkit-appearance: none;
		margin: 0;
	}

	#Tableau {
		width: 2000px;
	}

	#TableauCAISSON {
		width: 3000px;
	}

	#Tab {
		width: 1500px;
	}

	#TabSST {
		width: 1500px;
	}

	.divScroll {
		overflow: auto;
	}

	.multi {
		width: 200px;
	}

	.selectBox {
		position: relative;
	}

		.selectBox select {
			width: 100%;
			font-weight: bold;
		}

	.overSelect {
		position: absolute;
		left: 0;
		right: 0;
		top: 0;
		bottom: 0;
	}

	#checkboxes {
		display: none;
		border: 1px #dadada solid;
	}

		#checkboxes label {
			display: block;
		}

			#checkboxes label:hover {
				background-color: #1e90ff;
			}

	.modal-dialog {
		width: 1200px; /* New width for default modal */
	}

	.modal-sm {
		width: 350px; /* New width for small modal */
	}

	.modal-lg {
		width: 950px; /* New width for large modal */
	}
</style>

<div class="row wrapper border-bottom white-bg page-heading">
	<div class="col-lg-10">

		@if (ViewBag.IdAffaireCommercial == "" && ViewBag.IdAffaireCommercial == null)
		{
			<h2>
				DEVIS CLIENTS
			</h2>
		}
		else
		{
			<h2>
				Offre de prix

			</h2>
		}

		<ol class="breadcrumb">
			<li><a>Vente</a> </li>
			<li class="active">

				@if (ViewBag.Mode == "Edit")
				{
					if (ViewBag.IdAffaireCommercial == "" || ViewBag.IdAffaireCommercial == null)
					{

						<strong>
							Modifier Devis client
						</strong>

					}
					else
					{
						<strong>
							Modifier Offre de prix
						</strong>
					}

				}
				@if (ViewBag.Mode == "Create")
				{
					if (ViewBag.IdAffaireCommercial == "" || ViewBag.IdAffaireCommercial == null)
					{
						<strong>
							Ajouter Devis client
						</strong>
					}
					else
					{

						<strong>
							Ajouter Offre de prix
						</strong>

					}
				}
				@if (ViewBag.Mode == "Aff")
				{
					if (ViewBag.IdAffaireCommercial == "" || ViewBag.IdAffaireCommercial == null)
					{
						<strong>
							Afficher Devis client
						</strong>
					}
					else
					{
						<strong>
							Afficher Offre de prix
						</strong>
					}
				}
			</li>

		</ol>
	</div>
	<div class="col-lg-2">
	</div>
</div>
<div class="wrapper wrapper-content animated fadeInRight">
	@using (Html.BeginForm("SendDevis", "Vente", new { Mode = ViewBag.Mode, Code = ViewBag.Code, IdAffaireCommercial = ViewBag.IdAffaireCommercial }, FormMethod.Post, new { @class = "form-horizontal", role = "form" }))
	{
		<div class="row" style="margin-bottom: 20px; margin-right: 0px;">
			<button class="btn btn-primary pull-right" type="submit">
				<span class="bold">Enregistrer</span>
			</button>
			<button class="btn btn-warning pull-right" type="button" style="margin-right: 5px;"
					id="DeleteBtn" onclick="Delete();">
				<span class="bold">Supprimer</span>
			</button>
			<button class="btn btn-success pull-right" type="button" style="margin-right: 5px;" @if (ViewBag.Mode == "Create") { @: disabled
					}
					id="PrintBTN" onclick="imp();">
				<span class="bold">Imprimer</span>
			</button>
			<div class="btn-group pull-right" style="margin-right: 5px;">
				<button data-toggle="dropdown" class="btn btn-default dropdown-toggle" @if (ViewBag.Mode == "Create" || ViewBag.EnEcours != null) { @: disabled
						}>
					Transformer <span class="caret"></span>
				</button>
				<ul class="dropdown-menu">
					<li id="VersCommande" onclick="VersCommande();"><a href="#">Commande client</a></li>
					@*<li id="VersFacture"><a href="#">Facture client</a></li>*@
				</ul>
			</div>
		</div>
		<div class="row">
			<div class="col-lg-6">
				<div class="form-group">
					<label class="col-lg-2 control-label" style="padding-left: 5px ; text-align: initial;">
						NUMERO
					</label>
					<div class="col-lg-10">
						@if (ViewBag.numeroo != null)
						{
							<input type="text" class="form-control" readonly="true" name="numero" id="numero" value="@ViewBag.numeroo" required>
						}
						else
						{
							<input type="text" class="form-control" readonly="true" name="numero" id="numero" value="@ViewBag.Numero" required>

						}

					</div>
				</div>
			</div>
			<div class="col-lg-6">
				<div class="form-group">
					<label class="col-lg-2 control-label" style="padding-left: 5px ; text-align: initial;">
						DATE
					</label>
					<div class="col-lg-10">
						<div class="input-group date">
							<span class="input-group-addon"><i class="fa fa-calendar"></i></span>
							@if (ViewBag.Date != null)
							{
								<input type="text" class="form-control" name="date" id="date" value="@ViewBag.Date" required>
							}
							else
							{
								<input type="text" class="form-control" name="date" id="date" required>

							}
						</div>
					</div>
				</div>
			</div>

		</div>
		<div class="row">
			<div class="col-lg-6">
				<div class="form-group">
					<label class="col-lg-2 control-label" style="padding-left: 5px ; text-align: initial;">
						Designation Projet
					</label>
					<div class="col-lg-10">
						@if (ViewBag.designation != null && ViewBag.designation != "")
						{

							<input type="text" class="form-control" name="designation" id="designation" value="@ViewBag.designation">
						}
						else
						{
							<input type="text" class="form-control" name="designation" id="designation" value="">

						}
					</div>
				</div>
			</div>
			<div class="col-lg-6">
				<div class="form-group">
					<label class="col-lg-2 control-label" style="padding-left: 5px ; text-align: initial;">
						PAIEMENT
					</label>
					<div class="col-lg-10">
						<select class="form-control" name="modePaiement" id="modePaiement" required>
							@if (ViewBag.modePaiement != null)
							{
								<option value="@ViewBag.modePaiement">@ViewBag.modePaiement</option>
							}
							else
							{
								<option value=""></option>

							}
							<option value="Chèque">Chèque</option>
							<option value="Espèce">Espèce</option>
							<option value="Virement bancaire">Virement bancaire</option>
							<option value="Carte bancaire">Carte bancaire</option>
							<option value="A terme">A terme</option>
							<option value="Traite">Traite</option>

						</select>
					</div>
				</div>


			</div>

			@*<div class="col-lg-6">
					<div class="form-group">
						<label class="col-lg-2 control-label" style="padding-left: 0px; text-align: initial;">
							SOCIETE
						</label>
						<div class="col-lg-10">
							<select class="form-control" name="Societes" id="Societes"></select>
						</div>
					</div>
				</div>*@

			@*<div class="col-lg-6">
					<div class="form-group">
						<label class="col-lg-2 control-label" style="padding-left: 0px; text-align: initial;">
							CODE_Societe
						</label>
						<div class="col-lg-10">
							<input type="text" class="form-control" readonly="true" name="codeSoc" id="codeSoc"
								   required>
						</div>
					</div>
				</div>*@
		</div>
		<div class="row">
			<div class="col-lg-6">
				<div class="form-group">
					<label class="col-lg-2 control-label" style="padding-left: 5px ; text-align: initial;">
						CLIENT
					</label>
					<div class="col-lg-10" style="padding-left: 0px;">
						<div class="col-lg-11">
							<select class="form-control" name="client" id="client" required><option></option></select>

						</div>
						<div class="col-lg-1" style="padding-left: 0px;padding-right: 0px;">
							<a href="javascript:void(0);" class="CLIENT"><button class="btn btn-outline btn-primary dim" type="button"><i class="fa fa-plus"></i></button></a>
						</div>
					</div>
				</div>
			</div>

			<div class="col-lg-6">
				<div class="form-group">
					<label class="col-lg-2 control-label" style="padding-left: 5px ; text-align: initial;">
						CODE
					</label>
					<div class="col-lg-10">
						@if (ViewBag.IdAffaireCommercial != null && ViewBag.IdAffaireCommercial != "")
						{
							int idAffaire = int.Parse(ViewBag.IdAffaireCommercial);
							Inspinia_MVC5.Models.MED_TRABELSI db12 = new Inspinia_MVC5.Models.MED_TRABELSI();

							Inspinia_MVC5.Models.AffaireCommerciales AffaireCommerciales1 = db12.AffaireCommerciales.Where(t => t.AffaireCommercialeId == idAffaire).FirstOrDefault();
							string clientCode = AffaireCommerciales1.CLIENTS.CODE;
							<input type="text" class="form-control" readonly="true" name="codeClient" id="codeClient" value="@clientCode"
								   required>
						}
						else
						{
							<input type="text" class="form-control" readonly="true" name="codeClient" id="codeClient" value="@ViewBag.codeClient"
								   required>
						}
					</div>
				</div>
			</div>
		</div>
		<div class="row">
			@*<div class="col-lg-6">
					<div class="form-group">
						<label class="col-lg-2 control-label" style="padding-left: 5px ; text-align: initial;">
							TIERS
						</label>
						<div class="col-lg-10">
							<select class="form-control" id="Tiers" name="Tiers"><option>@ViewBag.Tiers</option></select>
						</div>
					</div>
				</div>*@
			<div class="col-lg-6">
				<div class="form-group">
					<label class="col-lg-2 control-label" style="padding-left: 5px ; text-align: initial;">
						REMISE %
					</label>
					<div class="col-lg-10">
						@if (ViewBag.remise != null)
						{
							<input type="text" class="form-control" name="remise" id="remise" value="@ViewBag.remise" min="0" required>
						}
						else
						{
							<input type="text" class="form-control" name="remise" id="remise" value="0" min="0" required>

						}
					</div>
				</div>
			</div>
			<div class="col-lg-6">
				<div class="form-group">
					<label class="col-lg-2 control-label" style="padding-left: 5px ; text-align: initial;">
						FINTION
					</label>
					<div class="col-lg-10">
						<input class="form-control" id="FINTION" name="FINTION" />
					</div>
				</div>
			</div>
			<div class="col-lg-6">
				<div class="form-group">
					<label class="col-lg-2 control-label" style="padding-left: 5px ; text-align: initial;">
						Tiroirs
					</label>
					<div class="col-lg-10">
						<input class="form-control" id="Tiroirs" name="Tiroirs" />
					</div>
				</div>
			</div>
			<div class="col-lg-6">
				<div class="form-group">
					<label class="col-lg-2 control-label" style="padding-left: 5px ; text-align: initial;">
						Charnières
					</label>
					<div class="col-lg-10">
						<input class="form-control" id="Charnieres " name="Charnieres " />
					</div>
				</div>
			</div>
		</div>
		<input type="hidden" name="WithPrint" id="WithPrint" required />
		<div id='myModal' class='modal'>
			<div class="modal-dialog  modal-lg">
				<div class="modal-content">
					<div id='myModalContent'>

					</div>
				</div>
			</div>
		</div>
		<div class="ibox ">
			<div class="ibox-title">
				<h5>Ressource Matériels</h5>
				<span class="label label-primary">M</span>
				<div class="ibox-tools">
					<a class="collapse-link">
						<i class="fa fa-chevron-up"></i>
					</a>


				</div>

			</div>
			<div class="ibox-content">

				<div class="divScroll">
					<button class="btn btn-primary pull-right" type="button" onclick="location.href='@Url.Action("FormDevis", "Achat", new { Mode = "Create", Code = "-1" ,Devisclt=ViewBag.Code}, null)'">
						<span class="bold">DevisFrs</span>
					</button>
					<table class="table table-striped table-bordered table-hover dataTables-example" id="Tableau">
						<thead>
							<tr>
								<th style="width:150px;">
									ARTICLE
								</th>
								<th>
									N° Devis FRS
								</th>
								<th>
									DESCRIPTION
								</th>

								<th style="width:150px;">
									MARQUE
								</th>
								<th style="width:150px;">
									UNITE
								</th>
								<th style="width:150px;">
									DEVISE
								</th>
								<th style="width:150px;">
									CATEGORIE
								</th>
								<th style="width:150px;">
									SOUS_CATEGORIE
								</th>

								@*<th>
										STOCK
									</th>*@

								<th style="width:90px;">
									QTE
								</th>
								<th>
									PUHTAchat
								</th>
								<th>
									Marge
								</th>
								<th>
									PUHTVente
								</th>
								<th>
									REMISE
								</th>
								<th>
									PTHT
								</th>
								<th style="width:90px;">
									TVA
								</th>

								<th>
									TTC
								</th>
								<th>
								</th>

							</tr>
							<tr>
								<th colspan="15" style="text-align:right">Coût Matériels:</th>
								<th><input type="text" class="form-control" readonly="true" name="TotalTTC1" id="TotalTTC1" value="0" required></th>
								<th></th>

							</tr>
						</thead>
						<tbody></tbody>
						<tfoot>


							<tr>
								<td>
									<select class="form-control" id="articles"><option>@ViewBag.lib</option></select>
								</td>
								@*<td>
										<input type="text" class="form-control" id="descriptionProduit" required />
									</td>*@
								<td>
									<input type="text" class="form-control" id="NumDevis" readonly="true" />
								</td>
								<td>
									@*<textarea id="descriptionProduit">
										</textarea>*@
									<select class="form-control" id="descriptionProduit" style="width:180px; height:40px;"><option>@ViewBag.des</option></select>

								</td>
								<td>
									<select class="form-control" name="marque" id="marque"><option>@ViewBag.ma</option></select>
								</td>
								<td>
									<select class="form-control" name="unite" id="unite"><option>@ViewBag.un</option></select>
								</td>
								<td>
									<select class="form-control" id="devise"><option>@ViewBag.dv</option></select>
								</td>
								<td>
									<select class="form-control" id="categorie"><option>@ViewBag.ca</option></select>
								</td>
								<td>
									<select id="Sous_Categorie" name="Sous_Categorie" style="width:140px; height:35px;"><option>@ViewBag.sca</option></select>
								</td>


								<td>
									<input type="number" class="form-control" id="QuantiteProduit" value="1" min="1" />
								</td>
								<td>
									<input type="number" class="form-control" id="PUHTProduit" value="0" min="0" />
								</td>
								<td>
									<input type="number" class="form-control" id="marge" value="0" min="0" />
								</td>
								<td>
									<input type="number" class="form-control" id="PUHTProduit2" value="0" min="0" />
								</td>
								<td>
									<input type="number" class="form-control" id="RemiseProduit" value="0" min="0" />
								</td>
								<td>
									<input type="number" class="form-control" id="PTHTProduit" value="0" readonly="true" />
								</td>
								@*<td>
									<input type="number" class="form-control" id="TVAProduit" min="0"required />
									</td>*@
								<td>
									<select class="form-control" id="TVAProduit"><option>@ViewBag.tv</option></select>
								</td>
								<td>
									<input type="number" class="form-control" id="TTCProduit" value="@ViewBag.ttc" readonly="true" />
								</td>
								<td style="display: flex; border-bottom-width: 0px; border-left-width: 0px; border-right-width: 0px;
                                border-top-width: 0px;" required>
									<button class="btn btn-info btn-circle" type="button" onclick="AddRow()" id="FirstBTN">
										<i class="fa fa-check"></i>
									</button>
									<button class="btn btn-warning btn-circle" type="button" disabled>
										<i class="fa fa-times"></i>
									</button>
								</td>
							</tr>



						</tfoot>
					</table>
				</div>

			</div>
		</div>
		<div class="ibox ">
			<div class="ibox-title">
				<h5>CUISINE</h5>
				<span class="label label-primary">C</span>
				<div class="ibox-tools">
					<a class="collapse-link">
						<i class="fa fa-chevron-up"></i>
					</a>


				</div>

			</div>
			<div class="ibox-content">

				<div class="divScroll">
					@*<button class="btn btn-primary pull-right" type="button" onclick="location.href='@Url.Action("FormDevis", "Achat", new { Mode = "Create", Code = "-1" ,Devisclt=ViewBag.Code}, null)'">
							<span class="bold">DevisFrs</span>
						</button>*@
					<table class="table table-striped table-bordered table-hover dataTables-example" id="TableauCAISSON">
						<thead>
							<tr>
								<th style="width:150px;">
									QTE
								</th>
								<th style="width:150px;">
									CAISSSON
								</th>
								<th>
									SOUS_CAISSON
								</th>
								<th style="width:150px;">
									Type caisson
								</th>
								<th style="width:150px;">
									CREV CAISSON
								</th>
								<th>
									MARGE PRIX ACHAT
								</th>
								<th style="width:150px;">
									PUHTACHAT
								</th>
								<th style="width:150px;">
									ACCESSOIRE
								</th>
								<th style="width:150px;">
									MARGE
								</th>
								<th style="width:150px;">
									PRIX_VENTE CAISSON
								</th>
								<th style="width:150px;">
									FACADE
								</th>
								<th style="width:150px;">
									SOUS_FACADE
								</th>
								<th style="width:150px;">
									Type Facade
								</th>
								<th>
									Marge Facade
								</th>

								<th style="width:150px;">
									PRIX Achat Facade
								</th>

								@*<th>
										REMISE
									</th>*@
								<th>
									PRIX VENTE Facade
								</th>

								<th>
									PTHT SANS MARGE
								</th>
								<th>
									PTHT AVEC MARGE
								</th>
								<th style="width:90px;">
									TVA
								</th>
								<th>
									PTTC
								</th>
								<th>

								</th>
							</tr>

						</thead>
						<tbody></tbody>
						<tfoot>
							<tr>
								<td>

									@if (ViewBag.QuantiteCAISSON != null && ViewBag.QuantiteCAISSON != "")
									{
										<input type="number" class="form-control" id="QuantiteCAISSON" name="QuantiteCAISSON" value="@ViewBag.QuantiteCAISSON" min="1" />
									}
									else
									{
										<input type="number" class="form-control" id="QuantiteCAISSON" name="QuantiteCAISSON" value="1" min="1" />

									}
								</td>
								<td>
									<select class="form-control" id="CAISSON" name="CAISSON">
										<option></option>
									</select>


								</td>

								<td>

									<select class="form-control" id="SSCAISSON"><option></option></select>
								</td>
								<td>

									<select class="form-control" id="MP"><option></option></select>
								</td>
								<td>

									<input type="number" class="form-control" id="CREVCAISSON" name="CREVCAISSON" value="0" min="0" readonly></input>

								</td>
								<td> <input type="number" class="form-control" name="MARGEPRIXACHAT" id="MARGEPRIXACHAT" value="0" min="0" /></td>

								<td> <input type="number" class="form-control" name="PRIXACHAT" id="PRIXACHAT" value="0" min="0" readonly /></td>
								<td>
									<input type="number" class="form-control" name="ACC" id="ACC" value="0" min="0" readonly />
									<button class="btn btn-info btn-circle" type="button" id="AffAcc" onclick="AffAccessoire();" disabled>
										<i class="fa fa-plus"></i>
									</button>
								</td>
								<td>

									<input type="number" class="form-control" id="POURCENTAGE" name="POURCENTAGE" value="0" min="0"></input>

								</td>
								<td> <input type="number" class="form-control" name="PRIXVENTECAISSON" id="PRIXVENTECAISSON" value="0" min="0" readonly /></td>

								<td>
									<select class="form-control" name="FACADE" id="FACADE"></select>
								</td>
								<td>
									<select class="form-control" name="SOUSFACADE" id="SOUSFACADE"></select>
								</td>
								<td>
									<select class="form-control" name="TYPESOUSFACADE" id="TYPESOUSFACADE"></select>
								</td>
								<td>
									<input type="number" class="form-control" id="QuantiteFACADE" value="1" min="1" />
								</td>
								<td>
									<input type="number" class="form-control" id="PRIXFACADE" value="0" min="0" readonly />
								</td>


								<td>
									<input type="number" class="form-control" id="PTHTFACADE" name="PTHTFACADE" value="0" readonly="true" />
								</td>


								<td>
									<input type="number" class="form-control" id="PTHTSSMARGE" name="PTHTSSMARGE" value="0" readonly="true" />
								</td>
								<td>
									<input type="number" class="form-control" id="PTHTAVECMARGE" name="PTHTAVECMARGE" value="0" readonly="true" />
								</td>
								<td>
									<select class="form-control" id="TVACUISINE" name="TVACUISINE"><option>0</option></select>
								</td>
								<td>
									<input type="number" class="form-control" id="PTTCCUISINE" name="PTTCCUISINE" value="" readonly="true" />
								</td>
								<td style="display: flex; border-bottom-width: 0px; border-left-width: 0px; border-right-width: 0px;
                                border-top-width: 0px;" required>
									<button class="btn btn-info btn-circle" type="button" onclick="AddRowCuisine()" id="FirstBTN">
										<i class="fa fa-check"></i>
									</button>
									<button class="btn btn-warning btn-circle" type="button" disabled>
										<i class="fa fa-times"></i>
									</button>
								</td>
							</tr>



						</tfoot>
					</table>
				</div>

			</div>
		</div>
		if ((ViewBag.Mode == "Edit") || (ViewBag.Mode == "Aff") || (ViewBag.Mode == "Create"))
		{
			<div class="ibox float-e-margins">
				<div class="ibox-title">
					<h5>Services</h5>
					<span class="label label-primary">S</span>
					<div class="ibox-tools">
						<a class="collapse-link">
							<i class="fa fa-chevron-up"></i>
						</a>


					</div>

				</div>
				<div class="ibox-content">

					<div>
						<div class="divScroll">

							<table class="table table-striped table-bordered table-hover dataTables-example" id="Tab">
								<thead>
									<tr>

										<th style="width:160px;">
											REF_SERVICE
										</th>
										<th>
											DES_SERVICE
										</th>
										<th>
											UNITE
										</th>
										<th>
											QTE
										</th>

										<th>
											PUHT
										</th>
										<th>
											REMISE
										</th>
										<th>
											PTHT
										</th>
										<th style="width:90px;">
											TVA
										</th>
										<th>
											PTTC
										</th>
										<th style="width:200px;">
											RESSOURCES
										</th>

										<th>

										</th>


									</tr>
									<tr>
										<th colspan="8" style="text-align:right">Coût services:</th>
										<th><input type="text" class="form-control" readonly="true" name="NettotalTTCSERV" id="NettotalTTCSERV" value="0" required></th>
										<th></th>

									</tr>
								</thead>

								<tbody></tbody>
								<tfoot>
									<tr>
										<td>
											<select type="text" class="form-control" id="SERVICE" />
										</td>
										<td>
											<textarea id="descriptionSERVICE">
                                        </textarea>
										</td>
										<td>
											<input class="form-control" id="uniteSERVICE" value="H" />
										</td>
										<td>
											<input type="number" class="form-control" id="QuantiteSERVICE" value="1" min="1" />

										</td>
										<td>
											<input type="number" class="form-control" id="PUHTSERVICE" min="0" />

										</td>
										<td>
											<input type="number" class="form-control" id="RemiseSERVICE" value="0" min="0" />

										</td>
										<td>
											<input type="number" class="form-control" id="PTHTSERVICE" readonly="true" />

										</td>
										<td>
											<select class="form-control" id="TVASERVICE"><option>19</option></select>

										</td>
										<td>
											<input type="number" class="form-control" id="TTCSERVICE" readonly="true" />

										</td>
										<td>

											<select type="text" id="RESSOURCE" data-placeholder="Choose a Country..." class="chosen-select" multiple style="width:350px;" tabindex="4"></select>

										</td>
										<td style="display: flex; border-bottom-width: 0px; border-left-width: 0px; border-right-width: 0px;
                                border-top-width: 0px;" required>
											<button class="btn btn-info btn-circle" type="button" onclick="AddRow2()" id="FirstBTN2">
												<i class="fa fa-check"></i>
											</button>
											<button class="btn btn-warning btn-circle" type="button" disabled>
												<i class="fa fa-times"></i>
											</button>
										</td>
									</tr>

								</tfoot>

							</table>

						</div>




					</div>
				</div>

			</div>
			<div class="ibox float-e-margins">
				<div class="ibox-title">
					<h5>SOUS_TRAITANCE</h5>
					<span class="label label-primary">S_T</span>
					<div class="ibox-tools">
						<a class="collapse-link">
							<i class="fa fa-chevron-up"></i>
						</a>


					</div>

				</div>
				<div class="ibox-content">

					<div>
						<div class="divScroll">

							<table class="table table-striped table-bordered table-hover dataTables-example" id="TabSST">
								<thead>
									<tr>

										<th style="width:160px;">
											REF_SERVICE
										</th>
										<th>
											DES_SERVICE
										</th>
										<th>
											UNITE
										</th>
										<th>
											QTE
										</th>

										<th>
											PUHT
										</th>
										<th>
											Marge
										</th>
										<th>
											PUHTVente
										</th>
										<th>
											REMISE
										</th>
										<th>
											PTHT
										</th>
										<th style="width:90px;">
											TVA
										</th>
										<th>
											PTTC
										</th>
										<th style="width:200px;">
											SOUS_TRAITANCE
										</th>

										<th>

										</th>


									</tr>
									<tr>
										<th colspan="8" style="text-align:right">Coût sous_Traitance:</th>
										<th><input type="text" class="form-control" readonly="true" name="NettotalTTCSSTRAIT" id="NettotalTTCSSTRAIT" value="0" required></th>
										<th></th>

									</tr>
								</thead>

								<tbody></tbody>
								<tfoot>
									<tr>
										<td>
											<select type="text" class="form-control" id="SERVICESOUSTRAITANCE" />
										</td>
										<td>
											<textarea id="descriptionSOUSTRAITANCE">
                                        </textarea>
										</td>
										<td>
											<input class="form-control" id="uniteSOUSTRAITANCE" value="H" />
										</td>
										<td>
											<input type="number" class="form-control" id="QuantiteSOUSTRAITANCE" value="1" min="1" />

										</td>
										<td>
											<input type="number" class="form-control" id="PUHTSOUSTRAITANCE" min="0" />

										</td>
										<td>
											<input type="number" class="form-control" id="margeSOUSTRAITANCE" value="0" min="0" disabled />
										</td>
										<td>
											<input type="number" class="form-control" id="PUHTProduitSOUSTRAITANCE2" min="0" />
										</td>
										<td>
											<input type="number" class="form-control" id="RemiseSOUSTRAITANCE" value="0" min="0" />

										</td>
										<td>
											<input type="number" class="form-control" id="PTHTSOUSTRAITANCE" readonly="true" />

										</td>
										<td>
											<select class="form-control" id="TVASOUSTRAITANCE"><option>19</option></select>

										</td>
										<td>
											<input type="number" class="form-control" id="TTCSOUSTRAITANCE" readonly="true" />

										</td>
										<td>
											<select type="text" id="SOUSTRAITANCE" data-placeholder="choisir employer..." class="chosen-select" multiple style="width:350px;" tabindex="4"></select>
										</td>
										<td style="display: flex; border-bottom-width: 0px; border-left-width: 0px; border-right-width: 0px;
                                             border-top-width: 0px;" required>
											<button class="btn btn-info btn-circle" type="button" onclick="AddRow3()" id="FirstBTN3">
												<i class="fa fa-check"></i>
											</button>
											<button class="btn btn-warning btn-circle" type="button" disabled>
												<i class="fa fa-times"></i>
											</button>
										</td>
									</tr>

								</tfoot>

							</table>

						</div>




					</div>
				</div>

			</div>
			@*<div class="ibox float-e-margins">
					<div class="ibox-title">
						<h5>Planification ressources prévisionnel</h5>
						<span class="label label-primary">S</span>
						<div class="ibox-tools">
							<a class="collapse-link">
								<i class="fa fa-chevron-up"></i>
							</a>


						</div>

					</div>
					<div class="ibox-content">

						<div>

							<div>
								@if (ViewBag.id != null)
								{

									<button class="btn btn-warning  pull-right" type="button" style="width : 40px" onclick="HeuresPlanification(@ViewBag.id);">

										<i class="fa fa-area-chart" aria-hidden="true"></i>

									</button>
									<button class="btn btn-primary pull-right" type="button" onclick="location.href='@Url.Action("Index", "Personnels",null, null)'">
										<span class="bold">Personnels</span>
									</button>
								}

							</div>

							<table class="table table-striped table-bordered table-hover dataTables-example" id="example">
								<thead>
									<tr>

										<th>
											Tâche
										</th>
										<th>
											Date Début planifiée
										</th>
										<th>
											Date fin planifiée
										</th>
										<th>
											Durée planifiée (H)
										</th>
										<th>
											Employé
										</th>
										<th>
											Progrés actuel
										</th>
										<th>
											Coût Vente (HT)
										</th>


									</tr>
								</thead>
								<tbody>
									@if (ViewBag.id != null)
									{
										int code = int.Parse(ViewBag.id);
										Inspinia_MVC5.Models.MED_TRABELSI db = new Inspinia_MVC5.Models.MED_TRABELSI();
										List<Inspinia_MVC5.Models.Tasks> task_list = db.Tasks.Where(t => t.ProjetTechniquesID == code).ToList();
										foreach (var item in task_list)
										{
											<tr>


												<td>
													@item.Text
												</td>
												<td>
													@item.planned_start
												</td>
												<td>
													@item.planned_end
												</td>
												<td>
													@item.duration_h_planning
												</td>
												<td>
													@db.Personnels.Find(item.owner_id).Nom
												</td>
												<td>
													@(item.Progress * 100)%
												</td>
												@{
													double c1 = (double)db.Personnels.Find(item.owner_id).Cout_hor;
													string c4 = item.duration_h_planning.ToString();
													int c2 = int.Parse(c4);
													double c3 = c1 * c2;
													somme = somme + c3;
													//db.Personnels.Find(item.owner_id).Cout_hor * item.duration_h_planning
												}
												<td>
													@c3
												</td>
												@*<td>

														<button class="btn btn-danger  dim" type="button" style="width : 40px" onclick="HeuresPlanification(@item.ID);">

															<i class="fa fa-area-chart" aria-hidden="true"></i>

														</button>

													</td>
											</tr>
										}
									}
								</tbody>
								<tfoot>
									<tr>
										<th colspan="6" style="text-align:right">Coût installation:</th>
										<th></th>
									</tr>
								</tfoot>
							</table>

						</div>
					</div>

				</div>*@
		}

		<div class="hr-line-dashed">
		</div>
		<div class="ibox float-e-margins">
			<div class="ibox-title">
				<h5>Totaux</h5>
				<span class="label label-primary">T</span>
				<div class="ibox-tools">
					<a class="collapse-link">
						<i class="fa fa-chevron-up"></i>
					</a>


				</div>
			</div>
			<div class="ibox-content">
				<div>
					<div class="form-group">
						<label class="col-lg-2 control-label">
							TOTAL HT (Accessoire)
						</label>
						<div class="col-lg-4">
							<input type="text" class="form-control" readonly="true" name="totalHT" id="totalHT" required>
						</div>
						<label class="col-lg-2 control-label">
							TOTAL HT (Installation/services)
						</label>
						@if (ViewBag.somme != null && (ViewBag.somme != 0))
						{
							<div class="col-lg-3">
								<input type="text" class="form-control" readonly="true" name="somme" id="somme" value="0" required>
							</div>
						}
						else
						{
							<div class="col-lg-3">
								<input type="text" class="form-control" readonly="true" name="NettotalHTSERV" id="NettotalHTSERV" value="0" required>
							</div>
						}
						<div class="col-lg-1">
							<select class="form-control" name="TVAProduit1" id="TVAProduit1"><option>@ViewBag.TVAInstallation</option></select>
						</div>
					</div>
					<div class="form-group">
						<label class="col-lg-2 control-label">
							TOTAL TVA (Accessoire+Cuisine)
						</label>
						<div class="col-lg-4">
							<input type="text" class="form-control" readonly="true" name="totalTVA" id="totalTVA" value="0" required>
						</div>
						<label class="col-lg-2 control-label">
							Totaux HT (Cuisine + Accessoire + Installation/service)
						</label>
						<div class="col-lg-4">
							<input type="text" class="form-control" readonly="true" name="TotalHTMI" id="TotalHTMI" value="0" required>
						</div>
					</div>
					<div class="form-group">
						<label class="col-lg-2 control-label">
							TOTAL TTC (Accessoire)
						</label>
						<div class="col-lg-4">
							<input type="text" class="form-control" readonly="true" name="TotalTTC" id="TotalTTC" value="0" required>
						</div>
						<label class="col-lg-2 control-label">
							Totaux TTC (Cuisine + Accessoire + Installation/services)
						</label>
						<div class="col-lg-4">
							<input type="text" class="form-control" readonly="true" name="netAPaye" id="netAPaye" value="0" style="font-size: x-large;" required>
						</div>

					</div>
					<div class="form-group">
						<label class="col-lg-2 control-label">
							Marge Devis
						</label>
						<div class="col-lg-4">
							<input type="text" class="form-control" readonly="true" name="MargeDevis" id="MargeDevis" value="0" style="font-size: x-large;" required>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="ibox float-e-margins">
			<div class="ibox-title">
				<h5>Conditions Commerciales</h5> <span class="label label-primary">CC</span>
				<div class="ibox-tools">
					<a class="collapse-link">
						<i class="fa fa-chevron-up"></i>
					</a>

				</div>
			</div>

			<div class="ibox-content">
				<div>

					<h4>
						Conditions de paiement
						<br><br />
						@if (ViewBag.CondPaim != "" && ViewBag.CondPaim != null)
						{
							<textarea style="FONT-SIZE: 8pt; WIDTH: 1100px; height:50px;" name="conditionsPaim" id="conditionsPaim">
                           @ViewBag.CondPaim
                             </textarea>
						}
						else
						{
							<textarea style="FONT-SIZE: 8pt; WIDTH: 1100px; height:50px;" name="conditionsPaim" id="conditionsPaim">
                            -  à la Commande: 50% 
                            -  à la Réception: 50% 
                            -  Sauf conditions particulières, les factures sont payables à 15J à compter de la date de livraison. En cas de retard de paiement, le prestataire pourra suspendre toutes les commandes en cours.
                        </textarea>
						}

					</h4>
					<h4>
						Validité de l’offre
						<br><br />
						<textarea style="FONT-SIZE: 8pt; WIDTH: 1100px; height:20px;" name="validite" id="validite">
                           -    Notre offre est valable 15 jours de la date de soumission.
                        </textarea>
					</h4>
				</div>
			</div>
		</div>
		<div class="ibox float-e-margins">
			<div class="ibox-title">
				<h5>Traçabilité</h5>
				<span class="label label-primary">T</span>
				<div class="ibox-tools">
					<a class="collapse-link">
						<i class="fa fa-chevron-up"></i>
					</a>


				</div>

			</div>
			<div class="ibox-content">

				<div>
					<div class="divScroll">

						<table class="table table-striped table-bordered table-hover dataTables-example">
							<thead>
								<tr>

									<th style="width:160px;">
										Employer
									</th>
									<th>
										Role
									</th>
									<th>
										Societé
									</th>
									<th>
										Date
									</th>
									<th>
										Ajoute
									</th>

									<th>
										Modification
									</th>


								</tr>

							</thead>

							<tbody></tbody>
							<tfoot>
								@if (ViewBag.id != null)
								{
									int iddevis = int.Parse(ViewBag.id);
									Inspinia_MVC5.Models.MED_TRABELSI db11 = new Inspinia_MVC5.Models.MED_TRABELSI();
									List<Inspinia_MVC5.Models.Tracabilite_Devis_Client> Tracabilite_Devis_Client = db11.Tracabilite_Devis_Client.Where(t => t.Id_Devis == iddevis).ToList();
									foreach (var item in Tracabilite_Devis_Client)
									{
										<tr>
											<td>
												@db11.Inscription.Where(f => f.InsriID == item.Personnel).FirstOrDefault().NOM
											</td>
											<td>
												@db11.Inscription.Where(f => f.InsriID == item.Personnel).FirstOrDefault().Direction
											</td>
											<td>
												@db11.SocieteLogo.Where(f => f.id == item.Societe).FirstOrDefault().Nom_Societe
											</td>
											<td>
												@item.Date
											</td>
											<td>
												@if (item.Ajoute_Par == true)
												{
													<span class="label label-primary">Ajoutée</span>

												}

											</td>
											<td>
												@if (item.Modifie_Par == true)
												{
													<span class="label label-warning-light">Modifiée</span>

												}
											</td>

										</tr>

									}
								}

							</tfoot>

						</table>

					</div>




				</div>
			</div>

		</div>
	}
</div>
@section Styles {
	@Styles.Render("~/Content/plugins/dataTables/dataTablesStyles")
	@Styles.Render("~/plugins/sweetAlertStyles")
	@Styles.Render("~/plugins/awesomeCheckboxStyles")
	@Styles.Render("~/plugins/clockpickerStyles")
	@Styles.Render("~/plugins/dateRangeStyles")
	@Styles.Render("~/Content/plugins/iCheck/iCheckStyles")
	@Styles.Render("~/Content/plugins/chosen/chosenStyles")
	@Styles.Render("~/plugins/switcheryStyles")
	@Styles.Render("~/plugins/jasnyBootstrapStyles")
	@Styles.Render("~/plugins/nouiSliderStyles")
	@Styles.Render("~/plugins/dataPickerStyles")
	@Styles.Render("~/Content/plugins/ionRangeSlider/ionRangeStyles")
	@Styles.Render("~/plugins/imagecropperStyles")
	@Styles.Render("~/Content/plugins/colorpicker/colorpickerStyles")
	@Styles.Render("~/plugins/select2Styles")
	@Styles.Render("~/plugins/touchSpinStyles")

}
@section Scripts {
	<script src="~/Scripts/jquery-1.10.2.js"></script>
	<script src="~/Scripts/bootstrap.js"></script>
	<script src="~/Scripts/bootstrap.min.js"></script>
	<script src="~/js/bootstrap-datepicker.min.js" type="text/javascript"></script>
	<script src="~/js/select2.min.js" type="text/javascript"></script>

	@*<script src="~/Scripts/jquery-1.10.2.min.js"></script>*@
	@*<script src="https://code.jquery.com/jquery-1.10.2.js"></script>*@

	@Scripts.Render("~/plugins/select2")
	@Scripts.Render("~/plugins/dataPicker")
	@Scripts.Render("~/plugins/dataTables")
	@Scripts.Render("~/plugins/sweetAlert")
	@Scripts.Render("~/plugins/iCheck")
	@Scripts.Render("~/plugins/ionRange")
	@Scripts.Render("~/plugins/nouiSlider")
	@Scripts.Render("~/plugins/jasnyBootstrap")
	@Scripts.Render("~/plugins/switchery")
	@Scripts.Render("~/plugins/chosen")
	@Scripts.Render("~/plugins/knob")
	@Scripts.Render("~/plugins/imagecropper")
	@Scripts.Render("~/plugins/colorpicker")
	@Scripts.Render("~/plugins/clockpicker")
	@Scripts.Render("~/plugins/dateRange")
	@Scripts.Render("~/plugins/touchSpin")


	<script type="text/javascript">


       //         $('#Tableau').dataTable({
       //             "bPaginate": false,
       //             "bInfo": false,
       //             "bFilter": false,
       //             "bAutoWidth": false,
       // "aoColumns": [
       //  { sWidth: '50px' },
       //  { sWidth: '100px' },
       //  { sWidth: '120px' },
       //  { sWidth: '30px' }
       //             ]
       //});

        $("#Li-Vente").attr("class", "active");
        $("#ul-Vente").attr("class", "nav nav-second-level collapse in");
        $("#ul-Vente").attr("aria-expanded", "true");
        RemplirListe();
        RemplirListe2();
        RemplirListe3();
        RemplirListe4();
        RemplirListe5();
        RemplirListe6();
        RemplirListe7();
        RemplirListe9();
        RemplirListe11();
        RemplirListe12();
        RemplirListe13();
        RemplirListe14();
        RemplirListe15();
        RemplirListe16();
        $("#date").datepicker({
            format: 'dd/mm/yyyy'
        });
        $("#TYPESOUSFACADE").select2();
        $("#client").select2();
        $("#marque").select2();
        $("#descriptionProduit").select2();
        $("#articles").select2();
        $("#SERVICE").select2();
        $("#RESSOURCE").select2();
        $("#SERVICESOUSTRAITANCE").select2();
        $("#SOUSTRAITANCE").select2();
        //$("#articles").select2();
        $("#TVAProduit").select2();
        $("#TVACUISINE").select2();
        $("#TVASERVICE").select2();
        $("#TVASOUSTRAITANCE").select2();
       $("#TVAProduit1").select2();
        $("#unite").select2();
        $("#devise").select2();
        $("#categorie").select2();
        $("#Sous_Categorie").select2();
        $("#societe").select2();
        $("#SSCAISSON").select2();
        $("#CAISSON").select2();
        $("#MP").select2();

        $("#FACADE").select2();
        $("#SOUSFACADE").select2();

        $("#modePaiement").select2();
        var Mode = "@ViewBag.Mode";
        var client = "@Model.CLIENT";
        @*var PTHTACC = "@ViewBag.PTHTACC";*@
        @*var IdAffaireCommercial = "@Model.IdAffaireCommercial";*@
        @*var dess = decodeHtml("@ViewBag.designation");
        $("#designation").val(dess);*@
        //if (PTHTACC != "")
        //{
        //    $("#ACC").val(PTHTACC);
        //}
      //var Societes = "@Model.Societes";
    //******************************************************************
        function AffAccessoire2(parampassed) {

            var LignesCuisine = parampassed;
            var SSCAISSON = $("#SSCAISSON").val();
            var date = $("#date").val();
            var numero = $("#numero").val();
            var designation = $("#designation").val();
            var modePaiement = $("#modePaiement option:selected").text();
            var client = $("#client option:selected").text();
            var codeClient = $("#codeClient").val();
            var Tiers = $("#Tiers option:selected").text();
            var remise = $("#remise").val();
            var IdAffaireCommercial = "@ViewBag.IdAffaireCommercial";
            var QuantiteCAISSON = $('#QuantiteCAISSON').val();
            var CAISSON = $('#CAISSON').val();
            var LIB_CAISSON = $("#CAISSON option:selected").text();
            var SSCAISSON = $('#SSCAISSON').val();
            var LIB_SSCAISSON = $("#SSCAISSON option:selected").text();
            var IDTYPCAISSON = $('#MP').val();
            var TYPCAISSON = $("#MP option:selected").text();
            var CREVCAISSON = $('#CREVCAISSON').val();
            var MARGEPRIXACHAT = $('#MARGEPRIXACHAT').val();
            var PRIXACHAT = $('#PRIXACHAT').val();
            var ACC = $('#ACC').val();
            var POURCENTAGE = $('#POURCENTAGE').val();
            var PRIXVENTECAISSON = $('#PRIXVENTECAISSON').val();
            //var PRIXVENTECAISSON = $('#PRIXVENTECAISSON').val();
            var FACADE = $('#FACADE').val();
            var LIB_FACADE = $("#FACADE option:selected").text();
            var SOUSFACADE = $('#SOUSFACADE').val();
            var LIB_SOUSFACADE = $("#SOUSFACADE option:selected").text();
            var IDTYPFACADE = $('#TYPESOUSFACADE').val();
            var TYPFACADE = $("#TYPESOUSFACADE option:selected").text();
            var QuantiteFACADE = $('#QuantiteFACADE').val();
            var PRIXFACADE = $('#PRIXFACADE').val();
            var PTHTFACADE = $('#PTHTFACADE').val();
            var PTHTSSMARGE = $('#PTHTSSMARGE').val();
            var PTHTAVECMARGE = $('#PTHTAVECMARGE').val();
            var TVACUISINE = $('#TVACUISINE').val();
            var PTTCCUISINE = $('#PTTCCUISINE').val();
            var PartielView1 = "/Vente/ACCESSOIRE?Mode=" + mode + "&Code=" + code + "&Date=" + date + "&numero=" + numero + "&designation=" + designation + "&modePaiement=" + modePaiement + "&client=" + client + "&codeClient=" + codeClient + "&Tiers=" + Tiers + "&remise=" + remise + "&SSCAISSON=" + SSCAISSON + "&IdAffaireCommercial=" + IdAffaireCommercial + "&QuantiteCAISSON=" + QuantiteCAISSON + "&CAISSON=" + CAISSON + "&LIB_SSCAISSON=" + LIB_SSCAISSON + "&TYPCAISSON=" + TYPCAISSON + "&IDTYPCAISSON=" + IDTYPCAISSON + "&LignesCuisine=" + LignesCuisine;
            var $buttonClicked = $(this);
            var options = { "backdrop": "static", keyboard: true };
            $.ajax({
                type: "GET",
                url: PartielView1,
                contentType: "application/json; charset=utf-8",
                data: "",
                datatype: "json",
                success: function (data) {
                    $('#myModalContent').html(data);
                    $('#myModal').modal(options);
                    $('#myModal').modal('show');

                },
                error: function () {
                    alert("Dynamic content load failed.");
                }
            });
        }

        $('#TVACUISINE').append($('<option>', {
            value: "",
            text: ""
        }));


        $.ajax({
            type: 'POST',
            url: "/Vente/GetAllTVA",
            success: function (response) {
                $.each(response, function (i, item) {
                    $('#TVACUISINE').append($('<option>', {
                        value: item.Valeur_TVA,
                        text: item.Valeur_TVA
                    }));
                });
            }
        });
        @*var caisson = "@ViewBag.CAISSON";*@
        debugger;
        var caisson = "@Session["CAISSON"]";
        $('#CAISSON').append($('<option>', {
            value: "",
            text: ""
        }));
        $.ajax({
            type: 'POST',
            url: "/Vente/GetAllCAISSON",
            success: function (response) {
                $.each(response, function (i, item) {
                    $('#CAISSON').append($('<option>', {
                        value: item.ID,
                        text: item.TYPE_CAISSON1
                    }));
                    //if (Mode == "Edit") {
                    //    $("#CAISSON").val(fournisseur).trigger("change");
                    //}
                    //if (Mode == "Aff") {
                    //    $("#CAISSON").val(fournisseur).trigger("change");
                    //}
                    if (caisson != "" && caisson != null) {
                        $("#CAISSON").val(caisson).trigger("change");
                    }
                });
            }
        });
        $('#FACADE').append($('<option>', {
            value: "",
            text: ""
        }));
        $.ajax({
            type: 'POST',
            url: "/Vente/GetAllFACADE",
            success: function (response) {
                $.each(response, function (i, item) {
                    $('#FACADE').append($('<option>', {
                        value: item.ID,
                        text: item.REF_FAC
                    }));
                    //if (Mode == "Edit") {
                    //    $("#SERVICE").val(fournisseur).trigger("change");
                    //}
                    //if (Mode == "Aff") {
                    //    $("#SERVICE").val(fournisseur).trigger("change");
                    //}
                });
            }
        });
        $('#SOUSFACADE').append($('<option>', {
            value: "",
            text: ""
        }));
        $.ajax({
            type: 'POST',
            url: "/Vente/GetAllSSFACADE",
			success: function (response) {

                $.each(response, function (i, item) {
                    $('#SOUSFACADE').append($('<option>', {
                        value: item.ID,
                        text: item.TYPE_FACADE1
                    }));
                    //if (Mode == "Edit") {
                    //    $("#SERVICE").val(fournisseur).trigger("change");
                    //}
                    //if (Mode == "Aff") {
                    //    $("#SERVICE").val(fournisseur).trigger("change");
                    //}
                });
            }
        });
         $(document).on("change", "#FACADE", function (e) {

            var FACADE = this.value;
             var ddlProducts = $("#SOUSFACADE");
            $.ajax({
                //cache: false,
                type: "GET",
                url: '@Url.Action("GetSSFACADEbyId", "Vente")',
                data: { "id": FACADE },
                success: function (data) {
					ddlProducts.html('');
					ddlProducts.append($('<option>', {
						value: "",
						text: ""
					}));
                    $.each(data, function (id, option) {
                        ddlProducts.append($('<option></option>').val(option.id).html(option.name));
                    });
                },
                error: function (xhr, ajaxOptions, thrownError) {
                    alert('Found error to load product!!.');
                }
            });


        });
         @*$(document).on("change", "#SOUSFACADE", function (e) {
            debugger;
            var SSFACADE = this.value;
             var FACADE = $("#FACADE").val();
            $.ajax({
                //cache: false,
                type: "GET",
                url: '@Url.Action("GetFACDEEbyIdTYPEFACADE", "Vente")',
                data: {
                    SSFACADE: SSFACADE,
                    FACADE: FACADE
                },
                success: function (response) {

                    $("#PRIXFACADE").val(response);
                    $("#PTHTFACADE").val(response);
                    var PRIXACHAT = $("#PRIXACHAT").val();
                    PRIXACHAT = parseFloat(PRIXACHAT);
                    var PRIXVENTECAISSON = $("#PRIXVENTECAISSON").val();
                    PRIXVENTECAISSON = parseFloat(PRIXVENTECAISSON);
                    var QuantiteFACADE = $("#QuantiteFACADE").val();
                    QuantiteFACADE = parseFloat(QuantiteFACADE);
                    var PRIXFACADE = parseFloat($('#PRIXFACADE').val());
                    var PTHTFACADE = PRIXFACADE * QuantiteFACADE;
                    PTHTFACADE = parseFloat(PTHTFACADE);
                    $('#PTHTFACADE').val(PTHTFACADE.toFixed(3));
                    var QuantiteCAISSON = parseFloat($('#QuantiteCAISSON').val());
                    QuantiteCAISSON = parseFloat(QuantiteCAISSON);
                    var PTHTSSMARGE = QuantiteCAISSON * (PRIXACHAT + PTHTFACADE);
                    PTHTSSMARGE = parseFloat(PTHTSSMARGE);
                    $('#PTHTSSMARGE').val(PTHTSSMARGE.toFixed(3));
                    var PTHTAVECMARGE = QuantiteCAISSON * (PRIXVENTECAISSON + PTHTFACADE);
                    PTHTAVECMARGE = parseFloat(PTHTAVECMARGE);
                    $('#PTHTAVECMARGE').val(PTHTAVECMARGE.toFixed(3));
                    var TVACUISINE = $('#TVACUISINE').val();
                    TVACUISINE = parseFloat(TVACUISINE);
                    var MontantTVACUISINE = (PTHTAVECMARGE * TVACUISINE) / 100;
                    var TTCCUISINE = PTHTAVECMARGE + MontantTVACUISINE;
                    $('#PTTCCUISINE').val(TTCCUISINE.toFixed(3));

                },
                error: function (xhr, ajaxOptions, thrownError) {
                    alert('Found error to load product!!.');
                }
            });
        });*@
        $(document).on("change", "#TYPESOUSFACADE", function (e) {

            var TYPESOUSFACADE = this.value;
            var FACADE = $("#FACADE").val();
            var SSFACADE = $("#SOUSFACADE").val();
            $.ajax({
                //cache: false,
                type: "GET",
                url: '@Url.Action("GetFACDEEbyIdTYPEFACADE", "Vente")',
                data: {
                    TYPESOUSFACADE: TYPESOUSFACADE,
                    FACADE: FACADE,
                    SSFACADE: SSFACADE,
                },
                success: function (response) {

                    $("#PRIXFACADE").val(response);
                    $("#PTHTFACADE").val(response);
                    var PRIXACHAT = $("#PRIXACHAT").val();
                    PRIXACHAT = parseFloat(PRIXACHAT);
                    var PRIXVENTECAISSON = $("#PRIXVENTECAISSON").val();
                    PRIXVENTECAISSON = parseFloat(PRIXVENTECAISSON);
                    var QuantiteFACADE = $("#QuantiteFACADE").val();
                    QuantiteFACADE = parseFloat(QuantiteFACADE);
                    var PRIXFACADE = parseFloat($('#PRIXFACADE').val());
                    var PTHTFACADE = PRIXFACADE * QuantiteFACADE;
                    PTHTFACADE = parseFloat(PTHTFACADE);
                    $('#PTHTFACADE').val(PTHTFACADE.toFixed(3));
                    var QuantiteCAISSON = parseFloat($('#QuantiteCAISSON').val());
                    QuantiteCAISSON = parseFloat(QuantiteCAISSON);
                    var PTHTSSMARGE = QuantiteCAISSON * (PRIXACHAT + PTHTFACADE);
                    PTHTSSMARGE = parseFloat(PTHTSSMARGE);
                    $('#PTHTSSMARGE').val(PTHTSSMARGE.toFixed(3));
                    var PTHTAVECMARGE = QuantiteCAISSON * (PRIXVENTECAISSON + PTHTFACADE);
                    PTHTAVECMARGE = parseFloat(PTHTAVECMARGE);
                    $('#PTHTAVECMARGE').val(PTHTAVECMARGE.toFixed(3));
                    var TVACUISINE = $('#TVACUISINE').val();
                    TVACUISINE = parseFloat(TVACUISINE);
                    var MontantTVACUISINE = (PTHTAVECMARGE * TVACUISINE) / 100;
                    var TTCCUISINE = PTHTAVECMARGE + MontantTVACUISINE;
                    $('#PTTCCUISINE').val(TTCCUISINE.toFixed(3));

                },
                error: function (xhr, ajaxOptions, thrownError) {
                    alert('Found error to load product!!.');
                }
            });
        });
        $(document).on("change", "#SSCAISSON", function (e) {
            debugger;
            var SSCAISSON = "@Session["SSCAISSON"]";
            //alert(SSCAISSON);
            if(SSCAISSON != "" && SSCAISSON != null) {
                var SSCAISSON = SSCAISSON;
            }
            else
            {
                var SSCAISSON = this.value;
            }
            //var SSCAISSON = this.value;
            var ddlProducts = $("#MP");
            var IDTYPCAISSON="@Session["IDTYPCAISSON"]";
            @*var TYPCAISSON= "@ViewBag.TYPCAISSON";*@
            $.ajax({
                //cache: false,
                type: "GET",
                url: '@Url.Action("GetMPIdSSCAISSON", "Vente")',
                data: { "id": SSCAISSON },
                success: function (data) {
                    ddlProducts.html('');
                    $('#MP').append($('<option>', {
                        value: "",
                        text: ""
					}));

                    $.each(data, function (id, option) {
                        ddlProducts.append($('<option></option>').val(option.id).html(option.name));
                    });

                    if (IDTYPCAISSON != null && IDTYPCAISSON != "") {
                        $("#MP").val(IDTYPCAISSON).trigger("change");
                    }
                    $("#AffAcc").attr("disabled", false);
                },
                error: function (xhr, ajaxOptions, thrownError) {
                    alert('Found error to load product!!.');
                }
            });


        });
        $(document).on("change", "#SOUSFACADE", function (e) {
            var SSCAISSON = this.value;
            var ddlProducts = $("#TYPESOUSFACADE");
            $.ajax({
                //cache: false,
                type: "GET",
                url: '@Url.Action("GetMPIdSOUSFACADE", "Vente")',
                data: { "id": SSCAISSON },
                success: function (data) {
                    ddlProducts.html('');
                    $('#TYPESOUSFACADE').append($('<option>', {
                        value: "",
                        text: ""
                    }));
                    $.each(data, function (id, option) {
                        ddlProducts.append($('<option></option>').val(option.id).html(option.name));
                    });
                },
                error: function (xhr, ajaxOptions, thrownError) {
                    alert('Found error to load product!!.');
                }
            });


        });
        $(document).on("change", "#MP", function (e) {
            var IDTYPCAISSON = "@Session["IDTYPCAISSON"]";
            if (IDTYPCAISSON != "" && IDTYPCAISSON != null) {
                var MP = IDTYPCAISSON;

            }
            else
            {
                var MP = this.value;
            }
           var SSCAISSON = "@Session["SSCAISSON"]";

            if (SSCAISSON == null || SSCAISSON == "")
            {
                var SSCAISSON = $("#SSCAISSON").val();
            }
             @*var IDTYPCAISSON="@ViewBag.IDTYPCAISSON";*@


            var TYPCAISSON = "@Session["TYPCAISSON"]";
            //if ((SSCAISSON != "") && (SSCAISSON != null))
            //{
            $.ajax({
                type: "GET",
                url: '@Url.Action("GetPHTSSCAISSONbyId", "Vente")',
                data: {
                    SSCAISSON: SSCAISSON,
                    MP: MP,
                },
                success: function (response) {
                    $("#CREVCAISSON").val(response.ptht);
                    $("#PRIXACHAT").val(response.ptht);
                    var PRIXACHAT = $("#PRIXACHAT").val();
                    PRIXACHAT = parseFloat(PRIXACHAT);
                    $("#ACC").val(response.Acc);
                    $("#MARGEPRIXACHAT").val(0);
                    $("#POURCENTAGE").val(0);
                    var PRIXVENTECAISSON = ((response.ptht) + (response.Acc));
                    PRIXVENTECAISSON = parseFloat(PRIXVENTECAISSON);
                    $("#PRIXVENTECAISSON").val(PRIXVENTECAISSON);
                    var QuantiteFACADE = $("#QuantiteFACADE").val();
                    QuantiteFACADE = parseFloat(QuantiteFACADE);
                    var PRIXFACADE = parseFloat($('#PRIXFACADE').val());
                    var PTHTFACADE = PRIXFACADE * QuantiteFACADE;
                    PTHTFACADE = parseFloat(PTHTFACADE);
                    $('#PTHTFACADE').val(PTHTFACADE.toFixed(3));
                    var QuantiteCAISSON = parseFloat($('#QuantiteCAISSON').val());
                    QuantiteCAISSON = parseFloat(QuantiteCAISSON);
                    var PTHTSSMARGE = QuantiteCAISSON * (PRIXACHAT + PTHTFACADE);
                    PTHTSSMARGE = parseFloat(PTHTSSMARGE);
                    $('#PTHTSSMARGE').val(PTHTSSMARGE.toFixed(3));
                    var PTHTAVECMARGE = QuantiteCAISSON * (PRIXVENTECAISSON + PTHTFACADE);
                    PTHTAVECMARGE = parseFloat(PTHTAVECMARGE);
                    $('#PTHTAVECMARGE').val(PTHTAVECMARGE.toFixed(3));
                    var TVACUISINE = $('#TVACUISINE').val();
                    TVACUISINE = parseFloat(TVACUISINE);
                    var MontantTVACUISINE = (PTHTAVECMARGE * TVACUISINE) / 100;
                    var TTCCUISINE = PTHTAVECMARGE + MontantTVACUISINE;
                    $('#PTTCCUISINE').val(TTCCUISINE.toFixed(3));


                },
                error: function (xhr, ajaxOptions, thrownError) {
                    alert('Found error to load product!!.');
                }
            });
            //}
        });

        $(document).on("change", "#CAISSON", function (e) {
            debugger;
            //$("#SSCAISSON").val('');
            //$("#MP").val('');
            var ddlProducts = $("#SSCAISSON");

            var SSCAISSON = "@Session["SSCAISSON"]";
            var CAISSON = "@Session["CAISSON"]";
            if (CAISSON != "" && CAISSON != null) {
                var caisson = CAISSON;
            }
            else {
                var caisson = this.value;
            }
            $.ajax({
                //cache: false,
                type: "GET",
                url: '@Url.Action("GetCAISSONbyTypeId", "Vente")',
                data: { "id": caisson },
                success: function (data) {
                    ddlProducts.html('');
                    $('#SSCAISSON').append($('<option>', {
                        value: "",
                        text: ""
                    }));
                    $.each(data, function (id, option) {
                        ddlProducts.append($('<option></option>').val(option.id).html(option.name));
                    });

                    if (SSCAISSON != null && SSCAISSON != "") {
                        $('#SSCAISSON').val(SSCAISSON).trigger("change");
                    }
                    //if (CAISSON != null && CAISSON != "") {
                    //    $('#CAISSON').val(CAISSON).trigger("change");
                    //}
                },
                error: function (xhr, ajaxOptions, thrownError) {
                    alert('Found error to load product!!.');
                }

            });
        });

        $('#SERVICE').append($('<option>', {
            value: "",
            text: ""
        }));
        $.ajax({
            type: 'POST',
            url: "/Vente/GetAllSERVICE",
            success: function (response) {
                $.each(response, function (i, item) {
                    $('#SERVICE').append($('<option>', {
                        value: item.ID,
                        text: item.NOM
                    }));
                    //if (Mode == "Edit") {
                    //    $("#SERVICE").val(fournisseur).trigger("change");
                    //}
                    //if (Mode == "Aff") {
                    //    $("#SERVICE").val(fournisseur).trigger("change");
                    //}
                });
            }
        });
        $('#SERVICESOUSTRAITANCE').append($('<option>', {
            value: "",
            text: ""
        }));
        $.ajax({
            type: 'POST',
            url: "/Vente/GetAllSERVICE",
            success: function (response) {
                $.each(response, function (i, item) {
                    $('#SERVICESOUSTRAITANCE').append($('<option>', {
                        value: item.ID,
                        text: item.NOM
                    }));
                    //if (Mode == "Edit") {
                    //    $("#SERVICE").val(fournisseur).trigger("change");
                    //}
                    //if (Mode == "Aff") {
                    //    $("#SERVICE").val(fournisseur).trigger("change");
                    //}
                });
            }
        });
        $('#RESSOURCE').append($('<option>', {
            value: "",
            text: ""
        }));
        $.ajax({
            type: 'POST',
            url: "/Vente/GetAllRESSOURCE",
            success: function (response) {
                $.each(response, function (i, item) {
                    $('#RESSOURCE').append($('<option>', {
                        value: item.PersonnelId,
                        text: item.Nom
                    }));

                });
            }
        });
        $('#SOUSTRAITANCE').append($('<option>', {
            value: "",
            text: ""
        }));
        $.ajax({
            type: 'POST',
            url: "/Vente/GetAllSOUSTRAITANCE",
            success: function (response) {
                $.each(response, function (i, item) {
                    $('#SOUSTRAITANCE').append($('<option>', {
                        value: item.ID,
                        text: item.NOM
                    }));

                });
            }
        });

        var mode = "@ViewBag.Mode";
        var code = "@ViewBag.Code";
        $(function () {
            $(".CLIENT").click(function () {
                var date = $("#date").val();
                var numero = $("#numero").val();
                var designation = $("#designation").val();
                var modePaiement = $("#modePaiement option:selected").text();
                var client = $("#client option:selected").text();
                var codeClient = $("#codeClient").val();
                var Tiers = $("#Tiers option:selected").text();
                var remise = $("#remise").val();
                var PartielView1 = "/Vente/Client?Mode=" + mode + "&Code=" + code +"&Date=" + date + "&numero=" + numero + "&designation=" + designation + "&modePaiement=" + modePaiement + "&client=" + client + "&codeClient=" + codeClient + "&Tiers=" + Tiers + "&remise=" + remise;
                var $buttonClicked = $(this);
                var options = { "backdrop": "static", keyboard: true };
                $.ajax({
                    type: "GET",
                    url: PartielView1,
                    contentType: "application/json; charset=utf-8",
                    data: "",
                    datatype: "json",
                    success: function (data) {
                        $('#myModalContent').html(data);
                        $('#myModal').modal(options);
                        $('#myModal').modal('show');

                    },
                    error: function () {
                        alert("Dynamic content load failed.");
                    }
                });
            });

            $("#closbtn").click(function () {
                $('#myModal').modal('hide');
            });

        });
        function AffAccessoire()
        {
            var SSCAISSON = $("#SSCAISSON").val();
            var date = $("#date").val();
            var numero = $("#numero").val();
            var designation = $("#designation").val();
            var modePaiement = $("#modePaiement option:selected").text();
            var client = $("#client").val();
            var codeClient = $("#codeClient").val();
            var Tiers = $("#Tiers option:selected").text();
            var remise = $("#remise").val();
            var IdAffaireCommercial = "@ViewBag.IdAffaireCommercial";

            var QuantiteCAISSON = $('#QuantiteCAISSON').val();
            var CAISSON = $('#CAISSON').val();
            var LIB_CAISSON = $("#CAISSON option:selected").text();
            var SSCAISSON = $('#SSCAISSON').val();
            var LIB_SSCAISSON = $("#SSCAISSON option:selected").text();
            var IDTYPCAISSON = $('#MP').val();

            var TYPCAISSON = $("#MP option:selected").text();
            var CREVCAISSON = $('#CREVCAISSON').val();
            var MARGEPRIXACHAT = $('#MARGEPRIXACHAT').val();
            var PRIXACHAT = $('#PRIXACHAT').val();
            var ACC = $('#ACC').val();
            var POURCENTAGE = $('#POURCENTAGE').val();
            var PRIXVENTECAISSON = $('#PRIXVENTECAISSON').val();
            //var PRIXVENTECAISSON = $('#PRIXVENTECAISSON').val();
            var FACADE = $('#FACADE').val();
            var LIB_FACADE = $("#FACADE option:selected").text();
            var SOUSFACADE = $('#SOUSFACADE').val();
            var LIB_SOUSFACADE = $("#SOUSFACADE option:selected").text();
            var IDTYPFACADE = $('#TYPESOUSFACADE').val();
            var TYPFACADE = $("#TYPESOUSFACADE option:selected").text();
            var QuantiteFACADE = $('#QuantiteFACADE').val();
            var PRIXFACADE = $('#PRIXFACADE').val();
            var PTHTFACADE = $('#PTHTFACADE').val();
            var PTHTSSMARGE = $('#PTHTSSMARGE').val();
            var PTHTAVECMARGE = $('#PTHTAVECMARGE').val();
            var TVACUISINE = $('#TVACUISINE').val();
            var PTTCCUISINE = $('#PTTCCUISINE').val();


            var PartielView1 = "/Vente/ACCESSOIRE?Mode=" + mode + "&Code=" + code + "&Date=" + date + "&numero=" + numero + "&designation=" + designation + "&modePaiement=" + modePaiement + "&client=" + client + "&codeClient=" + codeClient + "&Tiers=" + Tiers + "&remise=" + remise + "&SSCAISSON=" + SSCAISSON + "&IdAffaireCommercial=" + IdAffaireCommercial + "&QuantiteCAISSON=" + QuantiteCAISSON + "&CAISSON=" + CAISSON + "&LIB_SSCAISSON=" + LIB_SSCAISSON + "&TYPCAISSON=" + TYPCAISSON + "&IDTYPCAISSON=" + IDTYPCAISSON;
            var $buttonClicked = $(this);
            var options = { "backdrop": "static", keyboard: true };
            $.ajax({
                type: "GET",
                url: PartielView1,
                contentType: "application/json; charset=utf-8",
                data: "",
                datatype: "json",
                success: function (data) {
                    debugger;
                    $('#myModalContent').html(data);
                    $('#myModal').modal(options);
                    $('#myModal').modal('show');

                },
                error: function () {
                    alert("Dynamic content load failed.");
                }
            });
        }


        var client2 = "@ViewBag.client";
        $('#client').append($('<option>', {
            value: "",
            text: ""
        }));

        $.ajax({
            type: 'POST',
            url: "/Vente/GetAllClient",
            success: function (response) {

                $.each(response, function (i, item) {
                    $('#client').append($('<option>', {
                        value: item.ID,
                        text: item.NOM

                    }));


                  if (client2 != "" && client2 != null)
                  {
                   $("#client").val(client2).trigger("change");
                  }
                    if (Mode == "Edit") {
                        $("#client").val(client).trigger("change");
                    }
                    if (Mode == "Aff") {
                        $("#client").val(client).trigger("change");
                    }
                });
            }
        });
        //*********************************************************************************



        //$('#Societes').append($('<option>', {
        //    value: "",
        //    text: ""
        //}));

        //$.ajax({
        //    type: 'POST',
        //    url: "/Vente/GetAllSocietes",
        //    success: function (response) {

        //        $.each(response, function (i, item) {
        //            $('#Societes').append($('<option>', {
        //                value: item.SociID,
        //                text: item.NOM

        //            }));

        //            if (Mode == "Edit") {
        //                $("#Societes").val(Societes).trigger("change");
        //            }
        //        });
        //    }
        //});
        //*****************************************************************************************************
        $(document).on("change", "#categorie", function (e) {
        //$("#categorie").change(function () {

            var selectedItemValue = $(this).val();
            var ddlProducts = $("#Sous_Categorie");
            $.ajax({
                cache: false,
                type: "GET",
                url: '@Url.Action("GetsousByCategoryId", "Vente")',
                data: { "id": selectedItemValue },
                success: function (data) {
                ddlProducts.html('');
                $.each(data, function (id, option) {
                    ddlProducts.append($('<option style="width:100px; height:50px;"></option>').val(option.id).html(option.name));
                });
                },
                error: function (xhr, ajaxOptions, thrownError) {
                alert('Found error to load sous categorie!!.');
                }
                });
                });
        //*****************************************************************************************************
        // $(document).on("change", "#Societes", function (e) {
        //        //$('#Societes').on('change', function () {
        //    $("#codeSoc").val("");
        //    if (this.value != "") {
        //        $.ajax({
        //            type: 'POST',
        //            url: "/Vente/GetSocByID?ID=" + this.value,
        //            success: function (response) {
        //                $("#codeSoc").val(response.CODE_ACCES);
        //            }
        //        });
        //    }
        //});
         //******************************************************************
         $(document).on("change", "#date", function (e) {
            var code = "@ViewBag.Mode";
            var num = $("#numero").val();
            if (this.value != "") {
                $.ajax({
                    type: 'POST',
                    url: "/Vente/GetNumeroDevis?DATE=" + this.value + "&Mode=" + code + "&Num=" + num,
                    success: function (response) {
                        $("#numero").val(response);
                    }
                });
            }
        });
         $(document).on("change", "#SERVICE", function (e) {
            var selectedItemValue = $('#SERVICE').val();
            $('#descriptionSERVICE').val("");
             $.ajax({
                cache: false,
                type: "GET",
                url: '@Url.Action("GetService", "Vente")',
                 data: { "ID": selectedItemValue },
                success: function (data) {
                    $('#descriptionSERVICE').val(data.DES_SERVICE);

                }
             });

        });
        $(document).on("change", "#SERVICESOUSTRAITANCE", function (e) {
            var selectedItemValue = $('#SERVICESOUSTRAITANCE').val();
            $('#descriptionSOUSTRAITANCE').val("");
             $.ajax({
                cache: false,
                type: "GET",
                url: '@Url.Action("GetService", "Vente")',
                 data: { "ID": selectedItemValue },
                success: function (data) {
                    $('#descriptionSOUSTRAITANCE').val(data.DES_SERVICE);

                }
             });

        });
        $(document).on("keyup", "input[type=number][data-modif!=edited]", function (e) {
            var Qte = $("#QuantiteProduit").val();
            var PUHTProduit2 = $("#PUHTProduit2").val();
            var PRIX_VENTE_HT = parseFloat($('#PUHTProduit').val());
            Qte = parseFloat(Qte);
            var marge = ((PUHTProduit2 - PRIX_VENTE_HT) * 100) / PRIX_VENTE_HT;
            marge = parseFloat(marge);
            var PrixTotHTSansRemise = Qte * PUHTProduit2;
            $('#marge').val(marge.toFixed(3));
            var Remise = $("#RemiseProduit").val();
            Remise = parseFloat(Remise);
            var MontantRemise = (PrixTotHTSansRemise * Remise) / 100;
            var PTHTProduit = PrixTotHTSansRemise - MontantRemise;
            $('#PTHTProduit').val(PTHTProduit.toFixed(3));
            var TVA = $('#TVAProduit').val();
            TVA = parseFloat(TVA);
            var MontantTVA = (PTHTProduit * TVA) / 100;
            var TTCProduit = PTHTProduit + MontantTVA;
            $('#TTCProduit').val(TTCProduit.toFixed(3));

            var Qte1 = $("#QuantiteSERVICE").val();
            Qte1 = parseFloat(Qte1);
            var PRIX_VENTE_HT1 = parseFloat($('#PUHTSERVICE').val());
            var PrixTotHTSansRemise1 = Qte1 * PRIX_VENTE_HT1;
            var Remise1 = $("#RemiseSERVICE").val();
            Remise1 = parseFloat(Remise1);
            var MontantRemise1 = (PrixTotHTSansRemise1 * Remise1) / 100;
            var PTHTProduit1 = PrixTotHTSansRemise1 - MontantRemise1;
            $('#PTHTSERVICE').val(PTHTProduit1.toFixed(3));
            var TVA1 = $('#TVASERVICE').val();
            TVA1 = parseFloat(TVA1);

            var MontantTVA1 = (PTHTProduit1 * TVA1) / 100;
            var TTCProduit1 = PTHTProduit1 + MontantTVA1;
            $('#TTCSERVICE').val(TTCProduit1.toFixed(3));

            var Qte2 = $("#QuantiteSOUSTRAITANCE").val();
            Qte2 = parseFloat(Qte2);
            var PRIX_VENTE_HT2 = parseFloat($('#PUHTSOUSTRAITANCE').val());
            var PUHTSOUSTRAITANCE2 = parseFloat($("#PUHTProduitSOUSTRAITANCE2").val());
            var marge1 = ((PUHTSOUSTRAITANCE2 - PRIX_VENTE_HT2) * 100) / PRIX_VENTE_HT2;
            marge1 = parseFloat(marge1);
            $('#margeSOUSTRAITANCE').val(marge1.toFixed(3));
            var PrixTotHTSansRemise2 = Qte2 * PUHTSOUSTRAITANCE2;
            var Remise2 = $("#RemiseSOUSTRAITANCE").val();
            Remise2 = parseFloat(Remise2);
            var MontantRemise2 = (PrixTotHTSansRemise2 * Remise2) / 100;
            var PTHTProduit2 = PrixTotHTSansRemise2 - MontantRemise2;
            $('#PTHTSOUSTRAITANCE').val(PTHTProduit2.toFixed(3));
            var TVA2 = $('#TVASOUSTRAITANCE').val();
            TVA2 = parseFloat(TVA2);
            var MontantTVA2 = (PTHTProduit2 * TVA2) / 100;
            var TTCProduit2 = PTHTProduit2 + MontantTVA2;
            $('#TTCSOUSTRAITANCE').val(TTCProduit2.toFixed(3));

            var MARGEPRIXACHAT = $("#MARGEPRIXACHAT").val();
            MARGEPRIXACHAT = parseFloat(MARGEPRIXACHAT);
            var CREVCAISSON = parseFloat($('#CREVCAISSON').val());

            var PRIXACHAT = CREVCAISSON + MARGEPRIXACHAT;
            PRIXACHAT = parseFloat(PRIXACHAT);
            $('#PRIXACHAT').val(PRIXACHAT.toFixed(3));
            var SSCAISSON = $("#SSCAISSON").val();
            var MP = $("#MP").val();
            if (MP != null && MP != "")
            {

            $.ajax({
                type: "GET",
                url: '@Url.Action("GetPHTSSCAISSONbyId", "Vente")',
                data: {
                    SSCAISSON: SSCAISSON,
                    MP, MP
                },
                success: function (response) {
                    $("#ACC").val(response.Acc);
                }

            });
            var ACC = parseFloat($('#ACC').val());
            //if (CREVCAISSON != "" || MARGEPRIXACHAT != "") {
            //    var ACC2 = CREVCAISSON + MARGEPRIXACHAT + ACC;
            //}
            //else
            //{
                ACC2 = ACC;
            //}
                ACC2 = parseFloat(ACC2);

            $('#ACC').val(ACC2.toFixed(3));

            var POURCENTAGE = $("#POURCENTAGE").val();
            POURCENTAGE = parseFloat(POURCENTAGE);
            var ACC3 = $("#ACC").val();
            ACC3 = parseFloat(ACC3);
            var PRIXVENTECAISSON = ((ACC3 + PRIXACHAT) * POURCENTAGE / 100) + (ACC3 + PRIXACHAT);
            var PRIXVENTECAISSON = parseFloat(PRIXVENTECAISSON);

            $('#PRIXVENTECAISSON').val(PRIXVENTECAISSON.toFixed(3));

            var QuantiteFACADE = $("#QuantiteFACADE").val();
            QuantiteFACADE = parseFloat(QuantiteFACADE);
            var PRIXFACADE = parseFloat($('#PRIXFACADE').val());
            var PTHTFACADE = PRIXFACADE * QuantiteFACADE;
            PTHTFACADE = parseFloat(PTHTFACADE);
            $('#PTHTFACADE').val(PTHTFACADE.toFixed(3));
            var QuantiteCAISSON = parseFloat($('#QuantiteCAISSON').val());
            QuantiteCAISSON = parseFloat(QuantiteCAISSON);
            var PTHTSSMARGE = QuantiteCAISSON * (PRIXACHAT + PTHTFACADE);
            PTHTSSMARGE = parseFloat(PTHTSSMARGE);
            $('#PTHTSSMARGE').val(PTHTSSMARGE.toFixed(3));
            var PTHTAVECMARGE = QuantiteCAISSON * (PRIXVENTECAISSON + PTHTFACADE);
            PTHTAVECMARGE = parseFloat(PTHTAVECMARGE);
            $('#PTHTAVECMARGE').val(PTHTAVECMARGE.toFixed(3));
            var TVACUISINE = $('#TVACUISINE').val();
            TVACUISINE = parseFloat(TVACUISINE);
            var MontantTVACUISINE = (PTHTAVECMARGE * TVACUISINE) / 100;
            var TTCCUISINE = PTHTAVECMARGE + MontantTVACUISINE;
            $('#PTTCCUISINE').val(TTCCUISINE.toFixed(3));
            }

        });
         //*****************************************************************************************************
         $(document).on("change", "#articles", function (e) {
            $('#descriptionProduit').val("");
            $('#marque').val("");
            $('#unite').val("");
            $('#devise').val("");
            $('#categorie').val("");
            $('#Sous_Categorie').val("");
            $('#PUHTProduit').val("");
            $('#TVAProduit').val("");
            $('#PTHTProduit').val("");
            $('#TTCProduit').val("");
            var mode = "@ViewBag.Mode";
            var code = "@ViewBag.Code";
            var IdAffaireCommercial = "@ViewBag.IdAffaireCommercial";
            var date = $("#date").val();
            var numero = $("#numero").val();
            var designation = $("#designation").val();
            var modePaiement = $("#modePaiement option:selected").text();

            var client = $("#client option:selected").text();
            var codeClient = $("#codeClient").val();
            var Tiers = $("#Tiers option:selected").text();
            var remise = $("#remise").val();

            var options = { "backdrop": "static", keyboard: true };
            $.ajax({
                type: "GET",
                url: "/Vente/Articlesdevis?id=" + this.value + "&Mode=" + mode + "&Code=" + code + "&Date=" + date + "&Date=" + date + "&numero=" + numero + "&designation=" + designation + "&modePaiement=" + modePaiement + "&client=" + client + "&codeClient=" + codeClient + "&Tiers=" + Tiers + "&remise=" + remise + "&IdAffaireCommercial="+IdAffaireCommercial,
                contentType: "application/json; charset=utf-8",
                data: "",
                datatype: "json",
                success: function (response) {
                    $('#myModalContent').html(response);
                    $('#myModal').modal(options);
                    $('#myModal').modal('show');
                },
                error: function () {
                    alert("Dynamic content load failed.");
                }
            });
            $("#closbtn").click(function () {
                $('#myModal').modal('hide');
            });

        });
        $(document).on("change", "#TVAProduit", function (e) {

            var Qte = $("#QuantiteProduit").val();
            Qte = parseFloat(Qte);
            var PRIX_VENTE_HT = parseFloat($('#PUHTProduit2').val());
            var PrixTotHTSansRemise = Qte * PRIX_VENTE_HT;
            var Remise = $("#RemiseProduit").val();
            Remise = parseFloat(Remise);
            var MontantRemise = (PrixTotHTSansRemise * Remise) / 100;
            var PTHTProduit = PrixTotHTSansRemise - MontantRemise;
            $('#PTHTProduit').val(PTHTProduit.toFixed(3));
            var TVA = $(this).val();
            TVA = parseFloat(TVA);
            var MontantTVA = (PTHTProduit * TVA) / 100;
            var TTCProduit = PTHTProduit + MontantTVA;

            $('#TTCProduit').val(TTCProduit.toFixed(3));

        });
        $(document).on("change", "#TVACUISINE", function (e) {

            //var MARGEPRIXACHAT = $("#MARGEPRIXACHAT").val();
            //MARGEPRIXACHAT = parseFloat(MARGEPRIXACHAT);
            //var CREVCAISSON = parseFloat($('#CREVCAISSON').val());
            //var ACC = parseFloat($('#ACC').val());
            //var PRIXACHAT = CREVCAISSON + MARGEPRIXACHAT;
            //PRIXACHAT = parseFloat(PRIXACHAT);
            //$('#PRIXACHAT').val(PRIXACHAT.toFixed(3));
            //var ACC2 = CREVCAISSON + MARGEPRIXACHAT + ACC;
            //ACC2 = parseFloat(ACC2);
            //$('#ACC').val(ACC2.toFixed(3));

            //var POURCENTAGE = $("#POURCENTAGE").val();
            //POURCENTAGE = parseFloat(POURCENTAGE);
            //var ACC3 = $("#ACC").val();
            //ACC3 = parseFloat(ACC3);
            //var PRIXVENTECAISSON = (ACC3 * POURCENTAGE / 100) + ACC3;
            //var PRIXVENTECAISSON = parseFloat(PRIXVENTECAISSON);

            //$('#PRIXVENTECAISSON').val(PRIXVENTECAISSON.toFixed(3));

            //var QuantiteFACADE = $("#QuantiteFACADE").val();
            //QuantiteFACADE = parseFloat(QuantiteFACADE);
            //var PRIXFACADE = parseFloat($('#PRIXFACADE').val());
            //var PTHTFACADE = PRIXFACADE * QuantiteFACADE;
            //PTHTFACADE = parseFloat(PTHTFACADE);
            //$('#PTHTFACADE').val(PTHTFACADE.toFixed(3));
            //var QuantiteCAISSON = parseFloat($('#QuantiteCAISSON').val());
            //QuantiteCAISSON = parseFloat(QuantiteCAISSON);
            //var PTHTSSMARGE = QuantiteCAISSON * (PRIXACHAT + PTHTFACADE);
            //PTHTSSMARGE = parseFloat(PTHTSSMARGE);
            //$('#PTHTAVECMARGE').val(PTHTAVECMARGE.toFixed(3));
            var PTHTAVECMARGE = $('#PTHTAVECMARGE').val();
            PTHTAVECMARGE = parseFloat(PTHTAVECMARGE);

            var TVACUISINE = $(this).val();
            TVACUISINE = parseFloat(TVACUISINE);
            var MontantTVACUISINE = (PTHTAVECMARGE * TVACUISINE) / 100;
            var TTCCUISINE = PTHTAVECMARGE + MontantTVACUISINE;
            $('#PTTCCUISINE').val(TTCCUISINE.toFixed(3));
        });
        $(document).on("change", "#TVAProduit1", function (e) {
            UpdatePrice();
        });
        $(document).on("change", "#TVASERVICE", function (e) {

            var Qte1 = $("#QuantiteSERVICE").val();
            Qte1 = parseFloat(Qte1);
            var PRIX_VENTE_HT1 = parseFloat($('#PUHTSERVICE').val());
            var PrixTotHTSansRemise1 = Qte1 * PRIX_VENTE_HT1;
            var Remise1 = $("#RemiseSERVICE").val();
            Remise1 = parseFloat(Remise1);
            var MontantRemise1 = (PrixTotHTSansRemise1 * Remise1) / 100;
            var PTHTProduit1 = PrixTotHTSansRemise1 - MontantRemise1;
            $('#PTHTSERVICE').val(PTHTProduit1.toFixed(3));
            var TVA1 = $(this).val();
            TVA1 = parseFloat(TVA1);

            var MontantTVA1 = (PTHTProduit1 * TVA1) / 100;
            var TTCProduit1 = PTHTProduit1 + MontantTVA1;
            $('#TTCSERVICE').val(TTCProduit1.toFixed(3));
        });
        $(document).on("change", "#TVASOUSTRAITANCE", function (e) {

            var Qte2 = $("#QuantiteSOUSTRAITANCE").val();
            Qte2 = parseFloat(Qte2);
            var PRIX_VENTE_HT2 = parseFloat($('#PUHTSOUSTRAITANCE').val());
            var PUHTSOUSTRAITANCE2 = parseFloat($("#PUHTProduitSOUSTRAITANCE2").val());
            var marge1 = ((PUHTSOUSTRAITANCE2 - PRIX_VENTE_HT2) * 100) / PRIX_VENTE_HT2;
            marge1 = parseFloat(marge1);
            $('#margeSOUSTRAITANCE').val(marge1.toFixed(3));
            var PrixTotHTSansRemise2 = Qte2 * PUHTSOUSTRAITANCE2;
            var Remise2 = $("#RemiseSOUSTRAITANCE").val();
            Remise2 = parseFloat(Remise2);
            var MontantRemise2 = (PrixTotHTSansRemise2 * Remise2) / 100;
            var PTHTProduit2 = PrixTotHTSansRemise2 - MontantRemise2;
            $('#PTHTSOUSTRAITANCE').val(PTHTProduit2.toFixed(3));
            var TVA2 = $(this).val();
            TVA2 = parseFloat(TVA2);
            var MontantTVA2 = (PTHTProduit2 * TVA2) / 100;
            var TTCProduit2 = PTHTProduit2 + MontantTVA2;

            $('#TTCSOUSTRAITANCE').val(TTCProduit2.toFixed(3));
        });
        $(document).on("change", "#totalHT", function (e) {

            UpdatePrice();

        });
        $(document).on("change", "#NEW_TVA", function (e) {
            var Qte1 = $('#NEW_QTE').val();
            Qte1 = parseFloat(Qte1);
            var PRIX_VENTE_HT = parseFloat($('#NEW_PUVENTE').val());
            var PrixTotHTSansRemise = Qte1 * PRIX_VENTE_HT;
            var Remise = $('#NEW_REMISE').val();
            Remise = parseFloat(Remise);
            var MontantRemise = (PrixTotHTSansRemise * Remise) / 100;
            var PTHTProduit = PrixTotHTSansRemise - MontantRemise;
            $('#NEW_PTHT').val(PTHTProduit.toFixed(3));
            var TVA = $(this).val();
            TVA = parseFloat(TVA);
            var MontantTVA = (PTHTProduit * TVA) / 100;
            var TTCProduit = PTHTProduit + MontantTVA;
            $('#NEW_PTCT').text(TTCProduit.toFixed(3));

        });
        //*****************************Fournisseur**********************************
        $(document).on("keydown", "input[data-modif=edited]", function (e) {
            var Qte = $('#NEW_QTE').val();
            var PUHTProduit2 = $("#NEW_PUVENTE").val();
            var PRIX_VENTE_HT = parseFloat($('#NEW_PUHT').text());
            Qte = parseFloat(Qte);
            var marge = ((PUHTProduit2 - PRIX_VENTE_HT) * 100) / PRIX_VENTE_HT;

            marge = parseFloat(marge);
            var PrixTotHTSansRemise = Qte * PUHTProduit2;
            $('#NEW_MARGE').text(marge.toFixed(3));
            var Remise = $("#NEW_REMISE").val();
            Remise = parseFloat(Remise);
            var MontantRemise = (PrixTotHTSansRemise * Remise) / 100;
            var PTHTProduit = PrixTotHTSansRemise - MontantRemise;
            $('#NEW_PTHT').text(PTHTProduit.toFixed(3));
            var TVA = $('#NEW_TVA').val();
            TVA = parseFloat(TVA);
            var MontantTVA = (PTHTProduit * TVA) / 100;
            var TTCProduit = PTHTProduit + MontantTVA;
            $('#NEW_PTCT').text(TTCProduit.toFixed(3));

        });
        $(document).on("keyup", "input[data-modif=edited]", function (e) {
            var Qte = $('#NEW_QTE').val();
            var PUHTProduit2 = $("#NEW_PUVENTE").val();
            var PRIX_VENTE_HT = parseFloat($('#NEW_PUHT').text());
            Qte = parseFloat(Qte);
            var marge = ((PUHTProduit2 - PRIX_VENTE_HT) * 100) / PRIX_VENTE_HT;

            marge = parseFloat(marge);
            var PrixTotHTSansRemise = Qte * PUHTProduit2;
            $('#NEW_MARGE').text(marge.toFixed(3));
            var Remise = $("#NEW_REMISE").val();
            Remise = parseFloat(Remise);
            var MontantRemise = (PrixTotHTSansRemise * Remise) / 100;
            var PTHTProduit = PrixTotHTSansRemise - MontantRemise;
            $('#NEW_PTHT').text(PTHTProduit.toFixed(3));
            var TVA = $('#NEW_TVA').val();
            TVA = parseFloat(TVA);
            var MontantTVA = (PTHTProduit * TVA) / 100;
            var TTCProduit = PTHTProduit + MontantTVA;
            $('#NEW_PTCT').text(TTCProduit.toFixed(3));
        });

        //******************************************************************
        $(document).on("click", "#Tableau tbody tr td", function (e) {
            var index = this.cellIndex;
            var html = this.innerText;
            var Parent = this.parentNode.id;
            var locked = $("#" + Parent).attr("data-locked");


            var CELL_QTE = $("#Tableau tbody tr[id=" + Parent + "] td")[8];
            var CELL_PUHT = $("#Tableau tbody tr[id=" + Parent + "] td")[9];

            var CELL_MARGE = $("#Tableau tbody tr[id=" + Parent + "] td")[10];
            var CELL_PUVENTE = $("#Tableau tbody tr[id=" + Parent + "] td")[11];

            var CELL_REMISE = $("#Tableau tbody tr[id=" + Parent + "] td")[12];
            var CELL_PTHT = $("#Tableau tbody tr[id=" + Parent + "] td")[13];
            var CELL_TVA = $("#Tableau tbody tr[id=" + Parent + "] td")[14];
            var CELL_PTTC = $("#Tableau tbody tr[id=" + Parent + "] td")[15];

            var TXT_QTE = $(CELL_QTE).html();

            var TXT_PUHT = $(CELL_PUHT).html();
            var TXT_MARGE = $(CELL_MARGE).html();
            var TXT_PUVENTE = $(CELL_PUVENTE).html();

            var TXT_REMISE = $(CELL_REMISE).html();
            var TXT_PTHT = $(CELL_PTHT).html();
            var TXT_TVA = $(CELL_TVA).html();
            var TXT_PTCT = $(CELL_PTTC).html();

            if (index == 8 && $(this).html().indexOf("number") < 0 && locked != "true") {
                $(this).html("");
                $(this).append("<input type='number' class='form-control' id='NEW_QTE' value='" + html + "' data-modif='edited'>");
                //-----------------------------------------------------------------
                $(CELL_PUHT).html("");
                $(CELL_PUHT).append("<strong id='NEW_PUHT'>" + TXT_PUHT + "</strong>");
                $(CELL_MARGE).html("");
                $(CELL_MARGE).append("<strong id='NEW_MARGE'>" + TXT_MARGE + "</strong>");
                $(CELL_PTHT).html("");
                $(CELL_PTHT).append("<strong id='NEW_PTHT'>" + TXT_PTHT + "</strong>");
                $(CELL_PTTC).html("");
                $(CELL_PTTC).append("<strong id='NEW_PTCT'>" + TXT_PTCT + "</strong>");

                //-----------------------------------------------------------------

                $(CELL_PUVENTE).html("");
                $(CELL_PUVENTE).append("<input type='number' class='form-control' id='NEW_PUVENTE' value='" + TXT_PUVENTE + "' data-modif='edited'>");

                $(CELL_REMISE).html("");
                $(CELL_REMISE).append("<input type='number' class='form-control' id='NEW_REMISE' value='" + TXT_REMISE + "' data-modif='edited'>");

                $(CELL_TVA).html("");
                $(CELL_TVA).append("<select type='number' class='form-control' id='NEW_TVA' value='" + TXT_TVA + "' data-modif='edited'><option>" + TXT_TVA + "</option></select>");
                //-----------------------------------------------------------------

                $("#BtnRow_" + Parent).attr("disabled", false);
                LockRow(Parent);
                RemplirListeNewTva();

            }
            if (index == 11 && $(this).html().indexOf("number") < 0 && locked != "true") {
                $(this).html("");
                $(this).append("<input type='number' class='form-control' id='NEW_PUVENTE' value='" + html + "' data-modif='edited'>");
                $(CELL_PUHT).html("");
                $(CELL_PUHT).append("<strong id='NEW_PUHT'>" + TXT_PUHT + "</strong>");
                $(CELL_MARGE).html("");
                $(CELL_MARGE).append("<strong id='NEW_MARGE'>" + TXT_MARGE + "</strong>");
                $(CELL_PTHT).html("");
                $(CELL_PTHT).append("<strong id='NEW_PTHT'>" + TXT_PTHT + "</strong>");
                $(CELL_PTTC).html("");
                $(CELL_PTTC).append("<strong id='NEW_PTCT'>" + TXT_PTCT + "</strong>");
                //-----------------------------------------------------------------
                $(CELL_QTE).html("");
                $(CELL_QTE).append("<input type='number' class='form-control' id='NEW_QTE' value='" + TXT_QTE + "' data-modif='edited'>");


                $(CELL_REMISE).html("");
                $(CELL_REMISE).append("<input type='number' class='form-control' id='NEW_REMISE' value='" + TXT_REMISE + "' data-modif='edited'>");

                $(CELL_TVA).html("");
                $(CELL_TVA).append("<select type='number' class='form-control' id='NEW_TVA' value='" + TXT_TVA + "' data-modif='edited'><option>" + TXT_TVA + "</option></select>");
                //-----------------------------------------------------------------
                $("#BtnRow_" + Parent).attr("disabled", false);
                LockRow(Parent);
                RemplirListeNewTva();

            }
            if (index == 12 && $(this).html().indexOf("number") < 0 && locked != "true") {
                $(this).html("");
                $(this).append("<input type='number' class='form-control' id='NEW_REMISE' value='" + html + "' data-modif='edited'>");
                $(CELL_PUHT).html("");
                $(CELL_PUHT).append("<strong id='NEW_PUHT'>" + TXT_PUHT + "</strong>");
                $(CELL_MARGE).html("");
                $(CELL_MARGE).append("<strong id='NEW_MARGE'>" + TXT_MARGE + "</strong>");
                $(CELL_PTHT).html("");
                $(CELL_PTHT).append("<strong id='NEW_PTHT'>" + TXT_PTHT + "</strong>");
                $(CELL_PTTC).html("");
                $(CELL_PTTC).append("<strong id='NEW_PTCT'>" + TXT_PTCT + "</strong>");
                //-----------------------------------------------------------------
                $(CELL_QTE).html("");
                $(CELL_QTE).append("<input type='number' class='form-control' id='NEW_QTE' value='" + TXT_QTE + "' data-modif='edited'>");

                $(CELL_PUVENTE).html("");
                $(CELL_PUVENTE).append("<input type='number' class='form-control' id='NEW_PUVENTE' value='" + TXT_PUVENTE + "' data-modif='edited'>");


                $(CELL_TVA).html("");
                $(CELL_TVA).append("<select type='number' class='form-control' id='NEW_TVA' value='" + TXT_TVA + "' data-modif='edited'><option>" + TXT_TVA + "</option></select>");
                //-----------------------------------------------------------------
                $("#BtnRow_" + Parent).attr("disabled", false);
                LockRow(Parent);
                RemplirListeNewTva();

            }
            if (index == 14 && $(this).html().indexOf("number") < 0 && locked != "true") {
                $(this).html("");
                $(this).append("<select type='number' class='form-control' id='NEW_TVA' value='" + html + "' data-modif='edited'><option>" + html + "</option></select>");
                $(CELL_PUHT).html("");
                $(CELL_PUHT).append("<strong id='NEW_PUHT'>" + TXT_PUHT + "</strong>");
                $(CELL_MARGE).html("");
                $(CELL_MARGE).append("<strong id='NEW_MARGE'>" + TXT_MARGE + "</strong>");
                $(CELL_PTHT).html("");
                $(CELL_PTHT).append("<strong id='NEW_PTHT'>" + TXT_PTHT + "</strong>");
                $(CELL_PTTC).html("");
                $(CELL_PTTC).append("<strong id='NEW_PTCT'>" + TXT_PTCT + "</strong>");
                //-----------------------------------------------------------------
                $(CELL_QTE).html("");
                $(CELL_QTE).append("<input type='number' class='form-control' id='NEW_QTE' value='" + TXT_QTE + "' data-modif='edited'>");


                $(CELL_PUVENTE).html("");
                $(CELL_PUVENTE).append("<input type='number' class='form-control' id='NEW_PUVENTE' value='" + TXT_PUVENTE + "' data-modif='edited'>");


                $(CELL_REMISE).html("");
                $(CELL_REMISE).append("<input type='number' class='form-control' id='NEW_REMISE' value='" + TXT_REMISE + "' data-modif='edited'>");
                //-----------------------------------------------------------------
                $("#BtnRow_" + Parent).attr("disabled", false);
                LockRow(Parent);
                RemplirListeNewTva();

            }
        });

        $("#client").change(function () {

            var selectedItemValue = $(this).val();

            var ddlProducts = $("#Tiers");
            $.ajax({
                cache: false,
                type: "GET",
                url: '@Url.Action("GetTiersBySocietesId", "Vente")',
                data: { "id": selectedItemValue },
                success: function (data) {
                ddlProducts.html('');
                $.each(data, function (id, option) {
                ddlProducts.append($('<option></option>').val(option.id).html(option.name));
                });
                },
                //error: function (xhr, ajaxOptions, thrownError) {
                //alert('Found error to load product!!.');
                //}
                });
                });
        //--------------------------------------------------------------------------
        function remplirChamps() {
            //$('#descriptionProduit').val("");
            //$('#devise').val("");
            //$('#categorie').val("");
            //$('#Sous_Categorie').val("");
            //$('#PUHTProduit').val("");
            //$('#TVAProduit').val("");
            //$('#PTHTProduit').val("");
            //$('#TTCProduit').val("");
            var lib = "@ViewBag.lib";
            var id = "@ViewBag.id";
            var des = decodeHtml("@ViewBag.des");
            var numd = "@ViewBag.NumD";
            var ma = decodeHtml("@ViewBag.ma");

            var un = "@ViewBag.un";
            var dv = "@ViewBag.dv";
            var ca = decodeHtml("@ViewBag.ca");
            var sca = decodeHtml("@ViewBag.sca");
            var pu = ("@ViewBag.pu").replace(",",".");
            var qt = "@ViewBag.qt";
            var tv = "@ViewBag.tv";
            var pth = ("@ViewBag.pth").replace(",", ".");
            var ttc = ("@ViewBag.ttc").replace(",", ".");

            id = parseInt(id);
            pu = parseFloat(pu).toFixed(3);
            pth = parseFloat(pth).toFixed(3);
            ttc = parseFloat(ttc).toFixed(3);
            qt = parseFloat(qt);
            $("#descriptionProduit option").text(des);
            $("#NumDevis").val(numd);

            $("#marque option").text(ma);
            //alert($("#marque").val());

            //alert($("#marque").val());
            //$('#marque option').text(ma);
            //$('#marque').find("select option:contains('"+ma+"')").filter(":selected");
            //$("#marque option").each(function (i, item) {
            //  if ($(this).attr("value") == ma) {
            //       $(this).attr("selected", true);
            //       $(this).attr("value") = ma;
            //  }
            //});
            //$("#marque option").filter(function () {
            //    return $(this).val() == ma;
            //}).prop("selected", true);
            //$('#marque option').prop('selected', true);
            //$("#marque option").select = ma;
            //$('#marque option[value=' + ma + ']').prop('selected', true);
            //alert($('#marque option').val());
            //$('#marque').select('val', ma);
            //$('marque').val(ma).trigger('change');

            //alert($('#marque').val());
            //$("#marque").val(ma).trigger("change");
            //if (m != "")
            //{
                //$("#marque").text(ma);
            //}
            //$('#marque').val(ma);
            //$("#unite").val(un).trigger("change");
            //$('#marque option[value=' + ma + ']').attr("selected", "selected");
            //$('#devise option[value=' + dv + ']').attr("selected", "selected");
            $("#unite option").text(un);
            $("#devise option").text(dv);
            $("#categorie option").text(ca);
            $("#Sous_Categorie option").text(sca);
            //$("#QuantiteProduit").val(qt);
            $("#TVAProduit option").text(tv);
            $("#PTHTProduit").val(pth);

            $("#TTCProduit").val(ttc);
            $("#PUHTProduit").val(pu);
            $("#PUHTProduit2").val(pu);

            $('#articles').val(id);
            $("#articles option").text(lib);

        }
        function decodeHtml(html) {
            var txt = document.createElement("textarea");
            txt.innerHTML = html;
            return txt.value;
        }
        if (Mode == "Create") {
            $("#DeleteBtn").attr("disabled", true);
            var liste = "@ViewBag.ListeDesPoduits";
            var listeservice = "@ViewBag.LignesServ";
            var LignesServSSTraitance = "@ViewBag.LignesServSSTraitance";
            var LignesCuisine="@ViewBag.LignesCuisine";
            if (liste != "") {
                RemplirTableau();
            }
            else
            {
                remplirChamps();
            }
            if (listeservice != null)
            {
                RemplirTableau4();

            }
            if (LignesServSSTraitance != null)
            {
                RemplirTableau5();

            }
            if (LignesCuisine != null) {
                RemplirTableauCuisine2();
            }
            else
            {
                RemplirTableauCuisine();
            }
            //$("#articles option:selected").text(lib);


        }

        if (Mode == "Edit")
        {
         var TVAProduit1 = "@Model.TVAInstallation";
         var designation = decodeHtml("@Model.Designation");
         $("#designation").val(designation);
                            var FINTION = decodeHtml("@Model.FINTION");
                            $("#FINTION").val(FINTION);
                            var Tiroirs = decodeHtml("@Model.Tiroirs");
                            $("#Tiroirs").val(Tiroirs);
                            var Charnieres = decodeHtml("@Model.Charnieres");
                            $("#Charnieres").val(Charnieres);
                            var remise = "@Model.REMISE";
                            $("#remise").val(parseFloat(remise.replace(",", ".")));
            var codeFournisseur = "@ViewBag.CODE_FOURNISSEUR";
            var date = "@Model.DATE";
            date = date.replace(" 00:00:00", "");
            var modePaiement = decodeHtml("@Model.MODE_PAIEMENT");
            $("#modePaiement").val(modePaiement).trigger("change");
            //modePaiement = modePaiement.replace("&#232;", "è");
            //modePaiement = modePaiement.replace("&#233;", "é");
            $("#date").val(date);
            //
            var totalHT = ("@Model.THT").replace(",", ".");
            var NetHT = ("@Model.NHT").replace(",", ".");
            var totalTVA = ("@Model.TTVA").replace(",", ".");
            var TotalTTC = ("@Model.TTC").replace(",", ".");
            var netAPaye = ("@Model.TNET").replace(",", ".");
            var MargeDevis = ("@Model.Marge").replace(",", ".");

           var somme = "@ViewBag.somme";

           var totalHT = parseFloat(totalHT.replace(",", "."));
           var somme = parseFloat(somme.replace(",", "."));

          TVAProduit1 = parseInt(TVAProduit1);

            totalHT = parseFloat(totalHT);
            NetHT = parseFloat(NetHT);
            totalTVA = parseFloat(totalTVA);
            TotalTTC = parseFloat(TotalTTC);
            netAPaye = parseFloat(netAPaye);
            somme = parseFloat(somme);
            var TotalHTMI = somme + totalHT;

            TotalHTMI = parseFloat(TotalHTMI);

            $("#TVAProduit1").val(TVAProduit1);
            $("#MargeDevis").val(MargeDevis);
            $("#somme").val(somme.toFixed(3));
            $("#totalHT").val(totalHT.toFixed(3));
            $("#NetHT").val(NetHT.toFixed(3));
            $("#totalTVA").val(totalTVA.toFixed(3));
            $("#TotalTTC").val(TotalTTC.toFixed(3));
            $("#TotalHTMI").val(TotalHTMI.toFixed(3));
            $("#netAPaye").val(netAPaye.toFixed(3));
            $("#client").val(client).trigger("change");
            $("#codeClient").val(codeClient);

            //$("#modePaiement option").each(function (i, item) {
            //    if ($(this).attr("value") == modePaiement) {
            //        $(this).attr("selected", true);
            //    }
            //});

                            RemplirTableau();
                            RemplirTableau4();
                            RemplirTableau5();
                            RemplirTableauCuisine();
        }
        if (Mode == "Aff") {

            document.getElementById('date').disabled = true;
            document.getElementById('client').disabled = true;
            document.getElementById('Tiers').disabled = true;
            document.getElementById('modePaiement').disabled = true;
            document.getElementById('designation').disabled = true;
            document.getElementById('remise').disabled = true;
            document.getElementById('FINTION').disabled = true;
            document.getElementById('Tiroirs').disabled = true;
            document.getElementById('Charnieres').disabled = true;

            var remise = "@Model.REMISE";
            var designation = decodeHtml("@Model.Designation");
            $("#designation").val(designation);
             var FINTION = decodeHtml("@Model.FINTION");
                            $("#FINTION").val(FINTION);
                            var Tiroirs = decodeHtml("@Model.Tiroirs");
                            $("#Tiroirs").val(Tiroirs);
                            var Charnieres = decodeHtml("@Model.Charnieres");
                            $("#Charnieres").val(Charnieres);
            $("#remise").val(parseInt(remise));
            RemplirTableau2();
            var codeFournisseur = "@ViewBag.CODE_FOURNISSEUR";
            var date = "@Model.DATE";
            date = date.replace(" 00:00:00", "");
             var modePaiement = decodeHtml("@Model.MODE_PAIEMENT");
                            $("#modePaiement").val(modePaiement).trigger("change");
            $("#date").val(date);


             var totalHT = ("@Model.THT").replace(",", ".");
            var NetHT = ("@Model.NHT").replace(",", ".");
            var totalTVA = ("@Model.TTVA").replace(",", ".");
            var TotalTTC = ("@Model.TTC").replace(",", ".");
            var netAPaye = ("@Model.TNET").replace(",", ".");
             var MargeDevis = ("@Model.Marge").replace(",", ".");
           var somme = "@ViewBag.somme";

           var totalHT = parseFloat(totalHT.replace(",", "."));
           var somme = parseFloat(somme.replace(",", "."));

            totalHT = parseFloat(totalHT);
            NetHT = parseFloat(NetHT);
            totalTVA = parseFloat(totalTVA);
            TotalTTC = parseFloat(TotalTTC);
            netAPaye = parseFloat(netAPaye);
            somme = parseFloat(somme);
            var TotalHTMI = somme + totalHT;
            TotalHTMI = parseFloat(TotalHTMI);
            $("#MargeDevis").val(MargeDevis);
            $("#somme").val(somme.toFixed(3));
            $("#totalHT").val(totalHT.toFixed(3));
            $("#NetHT").val(NetHT.toFixed(3));
            $("#totalTVA").val(totalTVA.toFixed(3));
            $("#TotalTTC").val(TotalTTC.toFixed(3));
            $("#TotalHTMI").val(TotalHTMI.toFixed(3));
            $("#netAPaye").val(netAPaye.toFixed(3));
            $("#client").val(client).trigger("change");
            $("#codeClient").val(codeClient);
            //$("#modePaiement option").each(function (i, item) {
            //    if ($(this).attr("value") == modePaiement) {
            //        $(this).attr("selected", true);
            //    }
            //});

            RemplirTableau4();
            RemplirTableau5();
            RemplirTableauCuisine();
        }

        //******************************************************************
            $(document).on("keydown", "input[type=number][data-modif!=edited]", function (e) {
            var Qte = $("#QuantiteProduit").val();

            Qte = parseFloat(Qte);
            var PRIX_VENTE_HT = parseFloat($('#PUHTProduit').val());
            var PrixTotHTSansRemise = Qte * PRIX_VENTE_HT;
            var Remise = $("#RemiseProduit").val();
            Remise = parseFloat(Remise);
            var MontantRemise = (PrixTotHTSansRemise * Remise) / 100;
            var PTHTProduit = PrixTotHTSansRemise - MontantRemise;
            $('#PTHTProduit').val(PTHTProduit.toFixed(3));
            var TVA = $('#TVAProduit').val();
            TVA = parseFloat(TVA);
            var MontantTVA = (PTHTProduit * TVA) / 100;
            var TTCProduit = PTHTProduit + MontantTVA;
             $('#TTCProduit').val(TTCProduit.toFixed(3));


                var Qte1 = $("#QuantiteSERVICE").val();
                Qte1 = parseFloat(Qte1);
                var PRIX_VENTE_HT1 = parseFloat($('#PUHTSERVICE').val());
                var PrixTotHTSansRemise1 = Qte1 * PRIX_VENTE_HT1;
                var Remise1 = $("#RemiseSERVICE").val();
                Remise1 = parseFloat(Remise1);
                var MontantRemise1 = (PrixTotHTSansRemise1 * Remise1) / 100;
                var PTHTProduit1 = PrixTotHTSansRemise1 - MontantRemise1;
                $('#PTHTSERVICE').val(PTHTProduit1.toFixed(3));
                var TVA1 = $('#TVASERVICE').val();
                TVA1 = parseFloat(TVA1);
                var MontantTVA1 = (PTHTProduit1 * TVA1) / 100;
                var TTCProduit1 = PTHTProduit1 + MontantTVA1;
                $('#TTCSERVICE').val(TTCProduit1.toFixed(3));
        });

        //$('#PUHTProduit2').on('change', function () {
            //var marge = $("#marge").val();
        //    marge = parseFloat(marge);
        //    var PUHTProduit22 = $("#PUHTProduit2").val();
        //    var PRIX_VENTE_HT = parseFloat($('#PUHTProduit').val());
        //    PRIX_VENTE_HT = parseFloat(PRIX_VENTE_HT);

        //    PUHTProduit22 = parseFloat(PUHTProduit22);
        //    var marge2 = ((PUHTProduit22 - PRIX_VENTE_HT) * 100) / PRIX_VENTE_HT;
        //    marge2 = parseFloat(marge2);

        //    $('#marge').val(marge2);
        //    //var marque = $('#marque').val();
        //    //var unite = $('#unite').val();
        //    //var devise = $('#devise').val();
        //    //var categorie = $('#categorie').val();
        //    Qte = parseFloat(Qte);
        //    var PUHTProduit2 = PRIX_VENTE_HT + (marge * PRIX_VENTE_HT) / 100;

        //    var PrixTotHTSansRemise = Qte * PUHTProduit2;
        //    $('#PUHTProduit2').val(PUHTProduit2.toFixed(3));

        //    var Remise = $("#RemiseProduit").val();
        //    Remise = parseFloat(Remise);
        //    var MontantRemise = (PrixTotHTSansRemise * Remise) / 100;
        //    var PTHTProduit = PrixTotHTSansRemise - MontantRemise;
        //    $('#PTHTProduit').val(PTHTProduit.toFixed(3));
        //    var TVA = $('#TVAProduit').val();
        //    TVA = parseFloat(TVA);
        //    var MontantTVA = (PTHTProduit * TVA) / 100;
        //    var TTCProduit = PTHTProduit + MontantTVA;
        //    $('#TTCProduit').val(TTCProduit.toFixed(3));
        //});
        //$(document).on("keyup", "PUHTProduit2", function (e) {
        //    var marge = $("#marge").val();
        //    marge = parseFloat(marge);
        //    var PUHTProduit22 = $("#PUHTProduit2").val();
        //    var PRIX_VENTE_HT = parseFloat($('#PUHTProduit').val());

        //    PUHTProduit22 = parseFloat(PUHTProduit22);
        //    var marge2 = ((PUHTProduit22 - PRIX_VENTE_HT) * 100) / PRIX_VENTE_HT;
        //    $('#marge').val(marge2);
        //    //var marque = $('#marque').val();
        //    //var unite = $('#unite').val();
        //    //var devise = $('#devise').val();
        //    //var categorie = $('#categorie').val();
        //    Qte = parseFloat(Qte);
        //    var PUHTProduit2 = PRIX_VENTE_HT + (marge * PRIX_VENTE_HT) / 100;

        //    var PrixTotHTSansRemise = Qte * PUHTProduit2;
        //    $('#PUHTProduit2').val(PUHTProduit2.toFixed(3));

        //    var Remise = $("#RemiseProduit").val();
        //    Remise = parseFloat(Remise);
        //    var MontantRemise = (PrixTotHTSansRemise * Remise) / 100;
        //    var PTHTProduit = PrixTotHTSansRemise - MontantRemise;
        //    $('#PTHTProduit').val(PTHTProduit.toFixed(3));
        //    var TVA = $('#TVAProduit').val();
        //    TVA = parseFloat(TVA);
        //    var MontantTVA = (PTHTProduit * TVA) / 100;
        //    var TTCProduit = PTHTProduit + MontantTVA;
        //    $('#TTCProduit').val(TTCProduit.toFixed(3));
        //});

                //**************************** CHANGE TVA******************


            //**************************** CHANGE TVA******************


            //--------------------------------------------------------------------------------------
            $(document).ready(function () {
                $('#example').DataTable({
                    "footerCallback": function (row, data, start, end, display) {
                        var api = this.api(), data;

                        // Remove the formatting to get integer data for summation
                        var intVal = function (i) {
                            return typeof i === 'string' ?
                                i.replace(/[\$,]/g, '') * 1 :
                                typeof i === 'number' ?
                                    i : 0;
                        };

                        // Total over all pages
                        total = api
                            .column(6)
                            .data()
                            .reduce(function (a, b) {
                                return intVal(a) + intVal(b);
                            }, 0);

                        // Total over this page
                        pageTotal = api
                            .column(6, { page: 'current' })
                            .data()
                            .reduce(function (a, b) {
                                return intVal(a) + intVal(b);
                            }, 0);

                        // Update footer
                        $(api.column(6).footer()).html(
                            pageTotal + ' TND '
                        );
                    }
                });

    });
    //--------------------------------------------------------------------------
    function LockRow(parampassed) {
        $("#Tableau tbody tr").each(function (i, item) {
            if ($(this).attr("id") != parampassed) {
                $(this).attr("data-locked", true);
            }
        });
    }
    //--------------------------------------------------------------------------
    function RemplirListe() {
        $('#articles').append($('<option>', {
            value: "",
            text: ""
        }));


        $.ajax({
            type: 'POST',
            url: "/Vente/GetAllProduct",
            success: function (response) {
                $.each(response, function (i, item) {
                    $('#articles').append($('<option>', {
                        value: item.ID,
                        text: item.Libelle_Prd
                    }));
                });
            }
        });
                        }
 //--------------------------------------------------------------------------
                        function RemplirListe9() {

                            $('#TVAProduit1').append($('<option>', {
                                value: "",
                                text: ""
                            }));


                            $.ajax({
                                type: 'POST',
                                url: "/Vente/GetAllTVA",
                                success: function (response) {
                                    $.each(response, function (i, item) {
                                        $('#TVAProduit1').append($('<option>', {
                                            value: item.Valeur_TVA,
                                            text: item.Valeur_TVA
                                        }));
                                    });
                                }
                            });
        }

        function RemplirListeTVACUISINE() {

            $('#TVACUISINE').append($('<option>', {
                value: "",
                text: ""
            }));


            $.ajax({
                type: 'POST',
                url: "/Vente/GetAllTVA",
                success: function (response) {
                    $.each(response, function (i, item) {
                        $('#TVACUISINE').append($('<option>', {
                            value: item.Valeur_TVA,
                            text: item.Valeur_TVA
                        }));
                    });
                }
            });
        }
        function RemplirListe13() {

            $('#TVASERVICE').append($('<option>', {
                value: "",
                text: ""
            }));


            $.ajax({
                type: 'POST',
                url: "/Vente/GetAllTVA",
                success: function (response) {
                    $.each(response, function (i, item) {
                        $('#TVASERVICE').append($('<option>', {
                            value: item.Valeur_TVA,
                            text: item.Valeur_TVA
                        }));
                    });
                }
            });
        }
        function RemplirListe16() {

            $('#TVASOUSTRAITANCE').append($('<option>', {
                value: "",
                text: ""
            }));


            $.ajax({
                type: 'POST',
                url: "/Vente/GetAllTVA",
                success: function (response) {
                    $.each(response, function (i, item) {
                        $('#TVASOUSTRAITANCE').append($('<option>', {
                            value: item.Valeur_TVA,
                            text: item.Valeur_TVA
                        }));
                    });
                }
            });
        }
        function RemplirListe12() {
            $('#RESSOURCE').append($('<option>', {
                value: "",
                text: ""
            }));
            $.ajax({
                type: 'POST',
                url: "/Vente/GetAllRESSOURCE",
                success: function (response) {
                    $.each(response, function (i, item) {
                        $('#RESSOURCE').append($('<option>', {
                            value: item.PersonnelId,
                            text: item.Nom
                        }));
                    });
                }
            });
        }
        function RemplirListe15() {
            $('#SOUSTRAITANCE').append($('<option>', {
                value: "",
                text: ""
            }));
            $.ajax({
                type: 'POST',
                url: "/Vente/GetAllSOUSTRAITANCE",
                success: function (response) {
                    $.each(response, function (i, item) {
                        $('#SOUSTRAITANCE').append($('<option>', {
                            value: item.ID,
                            text: item.NOM
                        }));
                    });
                }
            });
        }
        function RemplirListe11() {
            $('#SERVICE').append($('<option>', {
                value: "",
                text: ""
            }));


            $.ajax({
                type: 'POST',
                url: "/Vente/GetAllSERVICE",
                success: function (response) {
                    $.each(response, function (i, item) {
                        $('#SERVICE').append($('<option>', {
                            value: item.ID,
                            text: item.REF
                        }));
                    });
                }
            });
        }
        function RemplirListe14() {
            $('#SERVICESOUSTRAITANCE').append($('<option>', {
                value: "",
                text: ""
            }));


            $.ajax({
                type: 'POST',
                url: "/Vente/GetAllSERVICE",
                success: function (response) {
                    $.each(response, function (i, item) {
                        $('#SERVICESOUSTRAITANCE').append($('<option>', {
                            value: item.ID,
                            text: item.REF
                        }));
                    });
                }
            });
        }
        //--------------------------------------------------------------------------
                function RemplirListe2() {

                    $('#TVAProduit').append($('<option>', {
                        value: "",
                        text: ""
                    }));


                    $.ajax({
                        type: 'POST',
                        url: "/Vente/GetAllTVA",
                        success: function (response) {
                            $.each(response, function (i, item) {
                                $('#TVAProduit').append($('<option>', {
                                    value: item.Valeur_TVA,
                                    text: item.Valeur_TVA
                                }));
                            });
                        }
                    });
                }
        //--------------------------------------------------------------------------
        function RemplirListe3() {
            //$('#marque').find('option').remove();
                    $('#marque').append($('<option>', {
                        value: "",
                        text: ""
                    }));

                    $.ajax({
                        type: 'POST',
                        url: "/Vente/GetAllMarque",
                        success: function (response) {
                            $.each(response, function (i, item) {
                                $('#marque').append($('<option>', {
                                    value: item.Nom_marque,
                                    text: item.Nom_marque
                                }));
                            });
                        }
                    });
                }
        //------------------------------------------------------------------------------------------
                function RemplirListe4() {
                    $('#unite').append($('<option>', {
                        value: "",
                        text: ""
                    }));

                    $.ajax({
                        type: 'POST',
                        url: "/Vente/GetAllUnite",
                        success: function (response) {

                            $.each(response, function (i, item) {
                                $('#unite').append($('<option>', {
                                    value: item.Valeur_Unite,
                                    text: item.Valeur_Unite

                                }));

                            });
                        }
                    });
                }
        //-----------------------------------------------------------------------------------------
                function RemplirListe5() {
                    $('#devise').append($('<option>', {
                        value: "",
                        text: ""
                    }));

                    $.ajax({
                        type: 'POST',
                        url: "/Vente/GetAllDevise",
                        success: function (response) {

                            $.each(response, function (i, item) {
                                $('#devise').append($('<option>', {
                                    value: item.Nom_Devise,
                                    text: item.Nom_Devise

                                }));

                            });
                        }
                    });
                }
                //--------------------------------------------------------------------------------------

        function RemplirListe6() {
            $('#categorie').append($('<option>', {
                value: "",
                text: ""
            }));

            $.ajax({
                type: 'POST',
                url: "/Vente/GetAllCategorie",
                success: function (response) {

                    $.each(response, function (i, item) {
                        $('#categorie').append($('<option>', {
                            value: item.CentreID,
                            text: item.Libelle

                        }));

                    });
                }
            });
        }

        function RemplirListe7() {
            $('#descriptionProduit').append($('<option>', {
                value: "",
                text: ""
            }));

            $.ajax({
                type: 'POST',
                url: "/Vente/GetAllDescription",
                success: function (response) {
                    $.each(response, function (i, item) {
                        $('#descriptionProduit').append($('<option>', {
                            value: item,
                            text: item

                        }));

                    });
                }
            });
        }
       //--------------------------------------------------------------------------
        function RemplirListeNewTva() {

            $('#NEW_TVA').append($('<option>', {
                value: "",
                text: ""
            }));


            $.ajax({
                type: 'POST',
                url: "/Vente/GetAllTVA",
                success: function (response) {
                    $.each(response, function (i, item) {
                        $('#NEW_TVA').append($('<option>', {
                            value: item.Valeur_TVA,
                            text: item.Valeur_TVA
                        }));
                    });
                }
            });
        }
        function RemplirListe17() {
            @*var caisson = "@Session["CAISSON"]";*@
            $('#CAISSON').append($('<option>', {
                value: "",
                text: ""
            }));
            $.ajax({
                type: 'POST',
                url: "/Vente/GetAllCAISSON",
                success: function (response) {
                    $.each(response, function (i, item) {
                        $('#CAISSON').append($('<option>', {
                            value: item.ID,
                            text: item.TYPE_CAISSON1
                        }));
                        //if (caisson != "" && caisson != null) {
                        //    $("#CAISSON").val(caisson).trigger("change");
                        //}
                        //if (Mode == "Edit") {
                        //    $("#SERVICE").val(fournisseur).trigger("change");
                        //}
                        //if (Mode == "Aff") {
                        //    $("#SERVICE").val(fournisseur).trigger("change");
                        //}
                    });
                }
            });

            @*var ddlProducts = $("#SSCAISSON");
            var SSCAISSON = "@ViewBag.SSCAISSON";
            var CAISSON = "@ViewBag.CAISSON";
            if (CAISSON != "" && CAISSON != null) {
                var caisson = CAISSON;
            }
            else
            {
                var caisson = this.value;
            }
            $.ajax({
                //cache: false,
                type: "GET",
                url: '@Url.Action("GetCAISSONbyTypeId", "Vente")',
                data: { "id": caisson },
                success: function (data) {
                    ddlProducts.html('');
                    $('#SSCAISSON').append($('<option>', {
                        value: "",
                        text: ""
                    }));
                    $.each(data, function (id, option) {
                        ddlProducts.append($('<option></option>').val(option.id).html(option.name));
                    });

                    if (SSCAISSON != null && SSCAISSON != "") {
                        $('#SSCAISSON').val(SSCAISSON).trigger("change");
                    }
                },
                error: function (xhr, ajaxOptions, thrownError) {
                    alert('Found error to load product!!.');
                }

            });
            var SSCAISSON = "@ViewBag.SSCAISSON";
            if (SSCAISSON != "" && SSCAISSON != null) {
                var SSCAISSON = SSCAISSON;
            }
            else {
                var SSCAISSON = this.value;
            }
            //var SSCAISSON = this.value;
            var ddlProducts = $("#MP");
            var IDTYPCAISSON="@ViewBag.IDTYPCAISSON";
            var TYPCAISSON= "@ViewBag.TYPCAISSON";
            $.ajax({
                //cache: false,
                type: "GET",
                url: '@Url.Action("GetMPIdSSCAISSON", "Vente")',
                data: { "id": SSCAISSON },
                success: function (data) {

                    ddlProducts.html('');
                    $('#MP').append($('<option>', {
                        value: "",
                        text: ""
                    }));
                    $.each(data, function (id, option) {
                        ddlProducts.append($('<option></option>').val(option.id).html(option.name));
                    });

                    if (IDTYPCAISSON != null && IDTYPCAISSON != "") {
                        $("#MP").val(IDTYPCAISSON).trigger("change");
                    }
                    $("#AffAcc").attr("disabled", false);
                },
                error: function (xhr, ajaxOptions, thrownError) {
                    alert('Found error to load product!!.');
                }
            });*@
        }
        function RemplirListe20() {
            $('#CAISSON').append($('<option>', {
                value: "",
                text: ""
            }));
            $.ajax({
                type: 'POST',
                url: "/Vente/GetAllCAISSON",
                success: function (response) {
                    $.each(response, function (i, item) {
                        $('#CAISSON').append($('<option>', {
                            value: item.ID,
                            text: item.TYPE_CAISSON1
                        }));
                        //if (caisson != "" && caisson != null) {
                        //    $("#CAISSON").val(caisson).trigger("change");
                        //}
                        //if (Mode == "Edit") {
                        //    $("#SERVICE").val(fournisseur).trigger("change");
                        //}
                        //if (Mode == "Aff") {
                        //    $("#SERVICE").val(fournisseur).trigger("change");
                        //}
                    });
                }
            });
        }
        function RemplirListe18()
        {
            $('#FACADE').append($('<option>', {
                value: "",
                text: ""
            }));
            $.ajax({
                type: 'POST',
                url: "/Vente/GetAllFACADE",
                success: function (response) {
                    $.each(response, function (i, item) {
                        $('#FACADE').append($('<option>', {
                            value: item.ID,
                            text: item.REF_FAC
                        }));
                        //if (Mode == "Edit") {
                        //    $("#SERVICE").val(fournisseur).trigger("change");
                        //}
                        //if (Mode == "Aff") {
                        //    $("#SERVICE").val(fournisseur).trigger("change");
                        //}
                    });
                }
            });
        }
        //function RemplirListe19() {
        //    $('#SOUSFACADE').append($('<option>', {
        //        value: "",
        //        text: ""
        //    }));
        //    $.ajax({
        //        type: 'POST',
        //        url: "/Vente/GetAllSSFACADE",
        //        success: function (response) {
        //            $.each(response, function (i, item) {
        //                $('#SOUSFACADE').append($('<option>', {
        //                    value: item.ID,
        //                    text: item.TYPE_FACADE1
        //                }));
        //                //if (Mode == "Edit") {
        //                //    $("#SERVICE").val(fournisseur).trigger("change");
        //                //}
        //                //if (Mode == "Aff") {
        //                //    $("#SERVICE").val(fournisseur).trigger("change");
        //                //}
        //            });
        //        }
        //    });
        //}
        //--------------------------------------------------------------------------

         //--------------------------------------------------------------------------
        $(document).on("change", "#categorie", function (e) {
            var selectedItemValue = $("#categorie option:selected").text();
             $('#descriptionProduit').val("");
            $('#marque').val("");
            $('#unite').val("");
            $('#devise').val("");
            $('#Sous_Categorie').val("");
            $('#PUHTProduit').val("");
            $('#TVAProduit').val("");
            $('#PTHTProduit').val("");
            $('#TTCProduit').val("");
            var mode = "@ViewBag.Mode";
            var code = "@ViewBag.Code";
            //var num = ;
            var date = $("#date").val();
            var numero = $("#numero").val();
            var designation = $("#designation").val();
            var modePaiement = $("#modePaiement option:selected").text();
            var client = $("#client option:selected").text();
            var codeClient = $("#codeClient").val();
            var Tiers = $("#Tiers option:selected").text();
            var remise = $("#remise").val();
             var IdAffaireCommercial = "@ViewBag.IdAffaireCommercial";
            @*var num = ;
            var date = "@ViewBag.Code";
            var paiement = "@ViewBag.Code";*@
            @*var client = "@ViewBag.Code";
            var t = "@ViewBag.Code";
            var code = "@ViewBag.Code";*@

            //var PartielView = '/Vente/Articlesdevis';
            var options = { "backdrop": "static", keyboard: true };
            $.ajax({
                type: "GET",
                url: "/Vente/ArticlesdevisCategorie?id=" + selectedItemValue + "&Mode=" + mode + "&Code=" + code + "&Date=" + date + "&Date=" + date + "&numero=" + numero + "&designation=" + designation + "&modePaiement=" + modePaiement + "&client=" + client + "&codeClient=" + codeClient + "&Tiers=" + Tiers + "&remise=" + remise + "&IdAffaireCommercial=" + IdAffaireCommercial,
                contentType: "application/json; charset=utf-8",
                data: "",
                datatype: "json",
                success: function (response) {
                    $('#myModalContent').html(response);
                    $('#myModal').modal(options);
                    $('#myModal').modal('show');
                },
                error: function () {
                    alert("Dynamic content load failed.");
                }
            });
            $("#closbtn").click(function () {
                $('#myModal').modal('hide');
            });
        });
         //--------------------------------------------------------------------------
        $(document).on("change", "#marque", function (e) {
            var selectedItemValue = $("#marque option:selected").text();
            $('#descriptionProduit').val("");
            $('#unite').val("");
            $('#devise').val("");
            $('#categorie').val("");
            $('#Sous_Categorie').val("");
            $('#PUHTProduit').val("");
            $('#TVAProduit').val("");
            $('#PTHTProduit').val("");
            $('#TTCProduit').val("");
            var mode = "@ViewBag.Mode";
            var code = "@ViewBag.Code";
            //var num = ;
            var date = $("#date").val();
            var numero = $("#numero").val();
            var designation = $("#designation").val();
            var modePaiement = $("#modePaiement option:selected").text();
            var client = $("#client option:selected").text();
            var codeClient = $("#codeClient").val();
            var Tiers = $("#Tiers option:selected").text();
            var remise = $("#remise").val();
            var IdAffaireCommercial = "@ViewBag.IdAffaireCommercial";
            @*var num = ;
            var date = "@ViewBag.Code";
            var paiement = "@ViewBag.Code";*@
            @*var client = "@ViewBag.Code";
            var t = "@ViewBag.Code";
            var code = "@ViewBag.Code";*@

            //var PartielView = '/Vente/Articlesdevis';
            var options = { "backdrop": "static", keyboard: true };
            $.ajax({
                type: "GET",
                url: "/Vente/ArticlesdevisMarque?id=" + selectedItemValue + "&Mode=" + mode + "&Code=" + code + "&Date=" + date + "&Date=" + date + "&numero=" + numero + "&designation=" + designation + "&modePaiement=" + modePaiement + "&client=" + client + "&codeClient=" + codeClient + "&Tiers=" + Tiers + "&remise=" + remise + "&IdAffaireCommercial=" + IdAffaireCommercial,
                contentType: "application/json; charset=utf-8",
                data: "",
                datatype: "json",
                success: function (response) {
                    $('#myModalContent').html(response);
                    $('#myModal').modal(options);
                    $('#myModal').modal('show');
                },
                error: function () {
                    alert("Dynamic content load failed.");
                }
            });
            $("#closbtn").click(function () {
                $('#myModal').modal('hide');
            });
        });
         //--------------------------------------------------------------------------
        $(document).on("change", "#descriptionProduit", function (e) {
            var des = $("#descriptionProduit option:selected").text();
            $('#marque').val("");
            $('#unite').val("");
            $('#devise').val("");
            $('#categorie').val("");
            $('#Sous_Categorie').val("");
            $('#PUHTProduit').val("");
            $('#TVAProduit').val("");
            $('#PTHTProduit').val("");
            $('#TTCProduit').val("");
            var mode = "@ViewBag.Mode";
            var code = "@ViewBag.Code";
            //var num = ;
            var date = $("#date").val();
            var numero = $("#numero").val();
            var designation = $("#designation").val();
            var modePaiement = $("#modePaiement option:selected").text();
            var client = $("#client option:selected").text();
            var codeClient = $("#codeClient").val();
            var Tiers = $("#Tiers option:selected").text();
            var remise = $("#remise").val();
            var IdAffaireCommercial = "@ViewBag.IdAffaireCommercial";

            //var PartielView = '/Vente/Articlesdevis';
            var options = { "backdrop": "static", keyboard: true };
            $.ajax({
                type: "GET",
                url: "/Vente/ArticlesdevisDes?id=" + des + "&Mode=" + mode + "&Code=" + code + "&Date=" + date + "&Date=" + date + "&numero=" + numero + "&designation=" + designation + "&modePaiement=" + modePaiement + "&client=" + client + "&codeClient=" + codeClient + "&Tiers=" + Tiers + "&remise=" + remise + "&IdAffaireCommercial=" + IdAffaireCommercial,
                contentType: "application/json; charset=utf-8",
                data: "",
                datatype: "json",
                success: function (response) {
                    $('#myModalContent').html(response);
                    $('#myModal').modal(options);
                    $('#myModal').modal('show');
                },
                error: function () {
                    alert("Dynamic content load failed.");
                }
            });
            $("#closbtn").click(function () {
                $('#myModal').modal('hide');
            });
        });
    //--------------------------------------------------------------------------


    //--------------------------------------------------------------------------
    $(document).on("change", "#client", function (e) {
        $("#codeClient").val("");
        if (this.value != "") {
            $.ajax({
                type: 'POST',
                url: "/Vente/GetClientByID?ID=" + this.value,
                success: function (response) {
                    $("#codeClient").val(response.CODE);
                }
            });
        }
        });
        //--------------------------------------------------------------------------
        //$(document).on("change", "#Societes", function (e) {
        // $("#codeSoc").val("");
        //    if (this.value != "") {
        //        $.ajax({
        //            type: 'POST',
        //            url: "/Vente/GetSocByID?ID=" + this.value,
        //            success: function (response) {
        //                $("#codeSoc").val(response.CODE_ACCES);
        //            }
        //        });
        //    }
        //});
    //--------------------------------------------------------------------------
    $(document).on("change", "#remise", function (e) {
      UpdatePriceRemise();
    });
    //--------------------------------------------------------------------------
        function AddRowCuisine() {

            var QuantiteCAISSON = $('#QuantiteCAISSON').val();
            var CAISSON = $('#CAISSON').val();
            var LIB_CAISSON = $("#CAISSON option:selected").text();
            var SSCAISSON = $('#SSCAISSON').val();
            var LIB_SSCAISSON = $("#SSCAISSON option:selected").text();
            var IDTYPCAISSON = $('#MP').val();
            var TYPCAISSON = $("#MP option:selected").text();
            var CREVCAISSON = $('#CREVCAISSON').val();
            var MARGEPRIXACHAT = $('#MARGEPRIXACHAT').val();
            var PRIXACHAT = $('#PRIXACHAT').val();
            var ACC = $('#ACC').val();
            var POURCENTAGE = $('#POURCENTAGE').val();
            var PRIXVENTECAISSON = $('#PRIXVENTECAISSON').val();
            //var PRIXVENTECAISSON = $('#PRIXVENTECAISSON').val();
            var FACADE = $('#FACADE').val();
            var LIB_FACADE = $("#FACADE option:selected").text();
            var SOUSFACADE = $('#SOUSFACADE').val();
            var LIB_SOUSFACADE = $("#SOUSFACADE option:selected").text();
            var IDTYPFACADE = $('#TYPESOUSFACADE').val();
            var TYPFACADE = $("#TYPESOUSFACADE option:selected").text();
            var QuantiteFACADE = $('#QuantiteFACADE').val();
            var PRIXFACADE = $('#PRIXFACADE').val();
            var PTHTFACADE = $('#PTHTFACADE').val();
            var PTHTSSMARGE = $('#PTHTSSMARGE').val();
            var PTHTAVECMARGE = $('#PTHTAVECMARGE').val();
            var TVACUISINE = $('#TVACUISINE').val();
            var PTTCCUISINE = $('#PTTCCUISINE').val();
            var data = {
                QuantiteCAISSON: QuantiteCAISSON,
                CAISSON : CAISSON,
                LIB_CAISSON : LIB_CAISSON,
                SSCAISSON : SSCAISSON,
                LIB_SSCAISSON: LIB_SSCAISSON,
                IDTYPCAISSON: IDTYPCAISSON,
                TYPCAISSON: TYPCAISSON,
                IDTYPFACADE: IDTYPFACADE,
                TYPFACADE: TYPFACADE,
                CREVCAISSON : CREVCAISSON,
                MARGEPRIXACHAT : MARGEPRIXACHAT,
                PRIXACHAT : PRIXACHAT,
                ACC : ACC,
                POURCENTAGE : POURCENTAGE,
                PRIXVENTECAISSON : PRIXVENTECAISSON,
                FACADE : FACADE,
                LIB_FACADE : LIB_FACADE,
                SOUSFACADE :SOUSFACADE,
                LIB_SOUSFACADE : LIB_SOUSFACADE,
                QuantiteFACADE :QuantiteFACADE,
                PRIXFACADE : PRIXFACADE,
                PTHTFACADE : PTHTFACADE,
                PTHTSSMARGE : PTHTSSMARGE,
                PTHTAVECMARGE: PTHTAVECMARGE,
                TVACUISINE: TVACUISINE,
                PTTCCUISINE: PTTCCUISINE,
            };
            $.ajax({
                type: 'POST',
                url: "/Vente/AddLineDevisCuisine",
                data: data,
                success: function (response) {
                    debugger;
                    @*("@ViewBag.SSCAISSON").empty();*@
                    @*("@ViewBag.IDTYPCAISSON").empty();
                    ("@ViewBag.TYPCAISSON").empty();
                    ("@ViewBag.CAISSON").empty();*@
                    RemplirTableauCuisine2();



                }
            });
        }
        function AddRow() {
            var NumDevis = $('#NumDevis').val();
            var ID_Produit = "@ViewBag.idd";
            var LIB_Produi = $("#articles option:selected").text();
            var Description_Produit = $('#descriptionProduit').val();
            var index11 = Description_Produit.indexOf('&');
            if (index11 != -1) {
                var index22 = Description_Produit.indexOf(';');
                index11 = parseInt(index11);
                index22 = parseInt(index22);
                var des1 = Description_Produit.substring(index11, index22 + 1);
                var Description_Produit2 = Description_Produit.replace(des1, "");
                var index33 = Description_Produit.indexOf('#');
                var des2 = Description_Produit.substring(index33 + 1, index22);
                //var des2 = decodeHtml("des2");
            }
            else {
                var Description_Produit2 = Description_Produit;
            }
            var marque = $("#marque option:selected").text();
            var unite = decodeHtml($("#unite option:selected").text());
            var devise = $("#devise option:selected").text();
            var categorie = $("#categorie option:selected").text();
            var sous_categorie = $("#Sous_Categorie option:selected").text();
            var index = sous_categorie.indexOf('&');
            if (index != -1) {
                var index2 = sous_categorie.indexOf(';');
                //var length = sous_categorie.length;
                index = parseInt(index);
                index2 = parseInt(index2);
                var sscat2 = sous_categorie.substring(index, index2 + 1);
                var sous_categorie2 = sous_categorie.replace(sscat2, "");
                var index22 = sous_categorie.indexOf('#');
                var sscat3 = sous_categorie.substring(index22+1, index2);

            }
            else {
                var sous_categorie2 = sous_categorie;
            }

            //var StockProduit = $("#StockProduit").val();
            var Quantite_Produit = $('#QuantiteProduit').val();
            var PUHT_Produit = $('#PUHTProduit').val();
            var PUHT_Produit2 = $('#PUHTProduit2').val();
            var Marge = $('#marge').val();
            var Remise_Produit = $('#RemiseProduit').val();
            var PTHT_Produit = $('#PTHTProduit').val();
            var TVA_Produit = $("#TVAProduit option:selected").text();
            var TTC_Produit = $('#TTCProduit').val();

            var data = {
                ID_Produit: ID_Produit,
                NumDevis: NumDevis,
                LIB_Produi: LIB_Produi,
                Description_Produit: Description_Produit2,
                marque: marque,
                unite: unite,
                devise: devise,
                categorie: categorie,
                sous_categorie: sous_categorie2,
                //StockProduit: StockProduit,
                Quantite_Produit: Quantite_Produit,
                PUHT_Produit: PUHT_Produit,
                PUHT_Produit2: PUHT_Produit2,
                Marge: Marge,
                Remise_Produit: Remise_Produit,
                PTHT_Produit: PTHT_Produit,
                TVA_Produit: TVA_Produit,
                TTC_Produit: TTC_Produit,
                des1: des2,
                sscat2: sscat3,
                index11: index11,
                index22: index22

            };


            $.ajax({
                type: 'POST',
                url: "/Vente/AddLineDevis",
                data: data,
                success: function (response) {
                    RemplirTableau11();



                }
            });
        }
        function AddRow2() {
            var ID_Produit = $("#SERVICE").val();
            var LIB_Produi = $("#SERVICE option:selected").text();
            var Description_Produit = $('#descriptionSERVICE').val();
            var unite = $('#uniteSERVICE').val();
            var Quantite_Produit = $('#QuantiteSERVICE').val();
            var PUHT_Produit = $('#PUHTSERVICE').val();
            var Remise_Produit = $('#RemiseSERVICE').val();
            var PTHT_Produit = $('#PTHTSERVICE').val();
            var TVA_Produit = $("#TVASERVICE option:selected").text();
            var TTC_Produit = $('#TTCSERVICE').val();
            var RESSOURCE = $("#RESSOURCE").val();
            var RESSOURCE2 = $("#RESSOURCE option:selected").text();


            var data1 = {
                ID_Produit: ID_Produit,
                LIB_Produi: LIB_Produi,
                Description_Produit: Description_Produit,
                unite: unite,
                Quantite_Produit: Quantite_Produit,
                PUHT_Produit: PUHT_Produit,
                Remise_Produit: Remise_Produit,
                PTHT_Produit: PTHT_Produit,
                TVA_Produit: TVA_Produit,
                TTC_Produit: TTC_Produit,
                RESSOURCE: RESSOURCE,
                RESSOURCE2: RESSOURCE2,

            };


            $.ajax({
                type: 'POST',
                url: "/Vente/AddLineSERVICE",
                data: data1,
                success: function (response) {
                    RemplirTableau4();

                }
            });
        }
        function AddRow3() {
            var ID_Produit = $("#SERVICESOUSTRAITANCE").val();
            var LIB_Produi = $("#SERVICESOUSTRAITANCE option:selected").text();
            var Description_Produit = $('#descriptionSOUSTRAITANCE').val();
            var unite = $('#uniteSOUSTRAITANCE').val();
            var Quantite_Produit = $('#QuantiteSOUSTRAITANCE').val();
            var PUHT_Produit = $('#PUHTSOUSTRAITANCE').val();
            var margeSOUSTRAITANCE = $('#margeSOUSTRAITANCE').val();
            var PUHTSOUSTRAITANCE2 = $('#PUHTProduitSOUSTRAITANCE2').val();
            var Remise_Produit = $('#RemiseSOUSTRAITANCE').val();
            var PTHT_Produit = $('#PTHTSOUSTRAITANCE').val();
            var TVA_Produit = $("#TVASOUSTRAITANCE option:selected").text();
            var TTC_Produit = $('#TTCSOUSTRAITANCE').val();
            var SOUS_TRAITANCE = $("#SOUSTRAITANCE").val();
            var SOUS_TRAITANCE2 = $("#SOUSTRAITANCE option:selected").text();

            var data1 = {
                ID_Produit: ID_Produit,
                LIB_Produi: LIB_Produi,
                Description_Produit: Description_Produit,
                unite: unite,
                Quantite_Produit: Quantite_Produit,
                PUHT_Produit: PUHT_Produit,
                margeSOUSTRAITANCE: margeSOUSTRAITANCE,
                PUHTSOUSTRAITANCE2: PUHTSOUSTRAITANCE2,
                Remise_Produit: Remise_Produit,
                PTHT_Produit: PTHT_Produit,
                TVA_Produit: TVA_Produit,
                TTC_Produit: TTC_Produit,
                SOUS_TRAITANCE: SOUS_TRAITANCE,
                SOUS_TRAITANCE2: SOUS_TRAITANCE2,

            };

            $.ajax({
                type: 'POST',
                url: "/Vente/AddLineSERVICESOUSTRAITANCE",
                data: data1,
                success: function (response) {
                    RemplirTableau5();

                }
            });
        }
        //---------------------------------------------------




    //--------------------------------------------------------------------------
           function RemplirTableau() {
            $("#Tableau tbody").empty();
            var Code = "@ViewBag.Code";

        $.ajax({
            type: 'POST',
            url: "/Vente/GetAllLineDevis",
            success: function (response) {
                $.each(response, function (i, item) {

                    var line = "<tr id='" + item.ID + "'><td>" + item.LIBELLE + "</td><td>" + item.NumDevis + "</td><td>" + item.DESIGNATION + "</td><td>" + item.MARQUE + "</td><td>" + item.UNITE + "</td><td>" + item.DEVISE + "</td><td>" + item.CATEGORIE + "</td><td>" + item.Sous_CATEGORIE + "</td><td>" + item.QUANTITE + "</td><td>" + item.PRIX_VENTE_HT + "</td><td>" + item.MARGE + "</td><td>" + item.PRIX_VENTE_HT2 + "</td><td>" + item.REMISE + "</td><td>" + item.PTHT + "</td><td>" + item.TVA + "</td><td>" + item.TTC + "</td><td style='display: flex; border-bottom-width: 0px; border-left-width: 0px; border-right-width: 0px; border-top-width: 0px;'> <button class='btn btn-info btn-circle' type='button' onclick='EditRow(\"" + item.ID + "\")' disabled id='BtnRow_" + item.ID + "'> <i class='fa fa-check'></i> </button> <button class='btn btn-warning btn-circle' type='button' onclick='DeleteRow(\"" + item.ID + "\")'> <i class='fa fa-times'></i> </button> </td></tr>";
                    $("#Tableau tbody").append(line);
                });
                $("#Tableau tfoot").replaceWith("<tfoot> <tr> <td>  <select class='form-control' id='articles'><option>@ViewBag.lib</option></select></td> <td> <input type='text' class='form-control' id='NumDevis' readonly='true' /> </td> <td><select class='form-control'  name='descriptionProduit' id='descriptionProduit'><option>@ViewBag.des</option> </select> </td><td> <select class='form-control' id='marque'><option>@ViewBag.ma</option></select> </td><td> <select class='form-control' id='unite'><option>@ViewBag.un</option></select></td><td> <select class='form-control' id='devise'><option>@ViewBag.dv</option></select> </td><td> <select class='form-control' id='categorie'><option>@ViewBag.ca</option> </select> </td><td> <select class='form-control' name='Sous_Categorie' id='Sous_Categorie'><option>@ViewBag.sca</option></select></td> <td> <input type='number' class='form-control' id='QuantiteProduit' value='1' min='1'/> </td> <td> <input type='number' class='form-control' id='PUHTProduit' min='0'/> </td> <td> <input type='number' class='form-control' id='marge' value='0' min='0'/> </td> <td> <input type='number' class='form-control' id='PUHTProduit2' min='0'/> </td> <td> <input type='number' class='form-control' id='RemiseProduit' value='0' min='0' /> </td> <td> <input type='number' class='form-control' id='PTHTProduit' readonly='true' /> </td> <td> <select class='form-control' id='TVAProduit'><option>@ViewBag.tv</option></select> </td> <td> <input type='number' class='form-control' id='TTCProduit' readonly='true' /> </td> <td style='display: flex; border-bottom-width: 0px; border-left-width: 0px; border-right-width: 0px; border-top-width: 0px;'> <button class='btn btn-info btn-circle' type='button' onclick='AddRow()'  id='FirstBTN'> <i class='fa fa-check'></i> </button> <button class='btn btn-warning btn-circle' type='button' disabled> <i class='fa fa-times'></i> </button> </td> </tr></tfoot>");
                $("#marque").select2();
                $("#descriptionProduit").select2();
                $("#articles").select2();
                $("#TVAProduit").select2();
                $("#unite").select2();
                $("#devise").select2();
                $("#categorie").select2();
                $("#Sous_Categorie").select2();
                remplirChamps();
                RemplirListe();
                RemplirListe2();
                RemplirListe3();
                RemplirListe4();
                RemplirListe5();
                RemplirListe6();
                RemplirListe7();



            }
        });

        UpdatePrice();

        }
        function RemplirTableauEditLine() {
            $("#Tableau tbody").empty();

            $.ajax({
                type: 'POST',
                url: "/Vente/GetAllLineDevis",
                success: function (response) {
                    $.each(response, function (i, item) {

                        var line = "<tr id='" + item.ID + "'><td>" + item.LIBELLE + "</td><td>" + item.NumDevis + "</td><td>" + item.DESIGNATION + "</td><td>" + item.MARQUE + "</td><td>" + item.UNITE + "</td><td>" + item.DEVISE + "</td><td>" + item.CATEGORIE + "</td><td>" + item.Sous_CATEGORIE + "</td><td>" + item.QUANTITE + "</td><td>" + item.PRIX_VENTE_HT + "</td><td>" + item.MARGE + "</td><td>" + item.PRIX_VENTE_HT2 + "</td><td>" + item.REMISE + "</td><td>" + item.PTHT + "</td><td>" + item.TVA + "</td><td>" + item.TTC + "</td><td style='display: flex; border-bottom-width: 0px; border-left-width: 0px; border-right-width: 0px; border-top-width: 0px;'> <button class='btn btn-info btn-circle' type='button' onclick='EditRow(\"" + item.ID + "\")' disabled id='BtnRow_" + item.ID + "'> <i class='fa fa-check'></i> </button> <button class='btn btn-warning btn-circle' type='button' onclick='DeleteRow(\"" + item.ID + "\")'> <i class='fa fa-times'></i> </button> </td></tr>";
                        $("#Tableau tbody").append(line);
                    });
                    $("#Tableau tfoot").replaceWith("<tfoot> <tr> <td>  <select class='form-control' id='articles'><option></option></select></td> <td> <input type='text' class='form-control' id='NumDevis' readonly='true' /> </td> <td><select class='form-control'  name='descriptionProduit' id='descriptionProduit'><option></option> </select> </td><td> <select class='form-control' id='marque'><option></option></select> </td><td> <select class='form-control' id='unite'><option></option></select></td><td> <select class='form-control' id='devise'><option></option></select> </td><td> <select class='form-control' id='categorie'><option></option> </select> </td><td> <select class='form-control' name='Sous_Categorie' id='Sous_Categorie'><option></option></select></td> <td> <input type='number' class='form-control' id='QuantiteProduit' value='1' min='1'/> </td> <td> <input type='number' class='form-control' id='PUHTProduit' min='0'/> </td> <td> <input type='number' class='form-control' id='marge' value='0' min='0'/> </td> <td> <input type='number' class='form-control' id='PUHTProduit2' min='0'/> </td> <td> <input type='number' class='form-control' id='RemiseProduit' value='0' min='0' /> </td> <td> <input type='number' class='form-control' id='PTHTProduit' readonly='true' /> </td> <td> <select class='form-control' id='TVAProduit'><option></option></select> </td> <td> <input type='number' class='form-control' id='TTCProduit' readonly='true' /> </td> <td style='display: flex; border-bottom-width: 0px; border-left-width: 0px; border-right-width: 0px; border-top-width: 0px;'> <button class='btn btn-info btn-circle' type='button' onclick='AddRow()'  id='FirstBTN'> <i class='fa fa-check'></i> </button> <button class='btn btn-warning btn-circle' type='button' disabled> <i class='fa fa-times'></i> </button> </td> </tr></tfoot>");
                    $("#marque").select2();
                    $("#descriptionProduit").select2();
                    $("#articles").select2();
                    $("#TVAProduit").select2();
                    $("#unite").select2();
                    $("#devise").select2();
                    $("#categorie").select2();
                    $("#Sous_Categorie").select2();

                    RemplirListe();
                    RemplirListe2();
                    RemplirListe3();
                    RemplirListe4();
                    RemplirListe5();
                    RemplirListe6();
                    RemplirListe7();



                }
            });



            UpdatePrice();

        }
        function RemplirTableauCuisine() {
            $("#TableauCAISSON tbody").empty();
            var Code = "@ViewBag.Code";
            $.ajax({
                type: 'POST',
                url: "/Vente/GetAllLineCuisine",
                success: function (response) {
                    $.each(response, function (i, item) {
                        var line = "<tr><td>" + item.QuantiteCAISSON + "</td><td>" + item.LIB_CAISSON + "</td><td>" + item.LIB_SSCAISSON + "</td><td>" + item.TYPCAISSON + "</td><td>" + item.CREVCAISSON + "</td><td>" + item.MARGEPRIXACHAT + "</td><td>" + item.PRIXACHAT + "</td><td>" + item.ACC + "<button class='btn btn-xs btn-success' type='button' onclick='AffAccessoire2(\"" + item.ID + "\")' ;'><i class= 'fa fa-search-plus' ></i></button></td><td>" + item.POURCENTAGE + "</td><td>" + item.PRIXVENTECAISSON + "</td><td>" + item.LIB_FACADE + "</td><td>" + item.LIB_SOUSFACADE + "</td><td>" + item.TYPFACADE + "</td><td>" + item.QuantiteFACADE + "</td><td>" + item.PRIXFACADE + "</td><td>" + item.PTHTFACADE + "</td><td>" + item.PTHTSSMARGE + "</td><td>" + item.PTHTAVECMARGE + "</td><td>" + item.TVACUISINE + "</td><td>" + item.PTTCCUISINE + "</td><td style='display: flex; border-bottom-width: 0px; border-left-width: 0px; border-right-width: 0px; border-top-width: 0px;'> <button class='btn btn-info btn-circle' type='button' onclick='EditRow(\"" + item.ID + "\")' disabled id='BtnRow_" + item.ID + "'> <i class='fa fa-check'></i> </button> <button class='btn btn-warning btn-circle' type='button' onclick='DeleteRowCuisine(\"" + item.ID + "\")'> <i class='fa fa-times'></i> </button> </td></tr>";
                        $("#TableauCAISSON tbody").append(line);
                    });
                    $("#TableauCAISSON tfoot").replaceWith("<tfoot><tr><td><input type='number' class='form-control' id='QuantiteCAISSON' name='QuantiteCAISSON' value='1' min='1' /></td><td><select class='form-control' id='CAISSON' name='CAISSON'><option></option></select></td><td><select class='form-control' id='SSCAISSON'><option></option></select></td><td><select class='form-control' id='MP' name='MP'><option></option></select></td><td><input type='number' class='form-control' id='CREVCAISSON' name='CREVCAISSON' value='0' min='0' readonly></input></td><td> <input type='number' class='form-control' name='MARGEPRIXACHAT' id='MARGEPRIXACHAT' value='0' min='0' /></td><td><input type='number' class='form-control' name='PRIXACHAT' id='PRIXACHAT' value='0' min='0' readonly /></td><td><input type='number' class='form-control' name='ACC' id='ACC' value='0' min='0'  readonly /> <button class='btn btn-info btn-circle' id='AffAcc' type='button' onclick='AffAccessoire();' disabled><i class= 'fa fa-plus' ></i></button ></td><td><input type='number' class='form-control' id='POURCENTAGE' name='POURCENTAGE' value='0' min='0'></input></td><td> <input type='number' class='form-control' name='PRIXVENTECAISSON' id='PRIXVENTECAISSON' value='0' min='0' readonly /></td><td><select class='form-control' name='FACADE' id='FACADE'></select></td><td><select class='form-control' name='SOUSFACADE' id='SOUSFACADE'></select></td><td><select class='form-control' id='TYPESOUSFACADE' name='TYPESOUSFACADE'><option></option></select></td><td><input type='number' class='form-control' id='QuantiteFACADE' value='1' min='1' /></td><td><input type='number' class='form-control' id='PRIXFACADE' value='0' min='0' readonly /></td><td><input type='number' class='form-control' id='PTHTFACADE' name='PTHTFACADE' value='0' readonly='true' /></td><td><input type='number' class='form-control' id='PTHTSSMARGE' name='PTHTSSMARGE' value='' readonly='true' /></td><td><input type='number' class='form-control' id='PTHTAVECMARGE' name='PTHTAVECMARGE' value='' readonly='true' /></td> <td><select class= 'form-control' id ='TVACUISINE' name = 'TVACUISINE'> <option>0</option></select ></td ><td><input type='number' class='form-control' id='PTTCCUISINE' name='PTTCCUISINE' value='' readonly='true' /></td><td style='display: flex; border-bottom-width: 0px; border-left-width: 0px; border-right-width: 0px;border-top-width: 0px;' required><button class='btn btn-info btn-circle' type='button' onclick='AddRowCuisine()' id='FirstBTN'><i class='fa fa-check'></i></button><button class='btn btn-warning btn-circle' type='button' disabled><i class='fa fa-times'></i></button></td></tr></tfoot>");
                    $("#SSCAISSON").select2();
                    $("#CAISSON").select2();
                    $("#MP").select2();
                    $("#TVACUISINE").select2();
                    $("#TYPESOUSFACADE").select2();
                    $("#FACADE").select2();
                    $("#SOUSFACADE").select2();
                    RemplirListe17();
                    RemplirListe18();
                    //RemplirListe19();
                    RemplirListeTVACUISINE();
                }
            });
            UpdatePrice();
        }
        function RemplirTableauCuisine2() {
            $("#TableauCAISSON tbody").empty();
            var Code = "@ViewBag.Code";
            $.ajax({
                type: 'POST',
                url: "/Vente/GetAllLineCuisine",
                success: function (response) {
                    $.each(response, function (i, item) {
                        var line = "<tr><td>" + item.QuantiteCAISSON + "</td><td>" + item.LIB_CAISSON + "</td><td>" + item.LIB_SSCAISSON + "</td><td>" + item.TYPCAISSON + "</td><td>" + item.CREVCAISSON + "</td><td>" + item.MARGEPRIXACHAT + "</td><td>" + item.PRIXACHAT + "</td><td>" + item.ACC + "<button class='btn btn-xs btn-success' type='button' onclick='AffAccessoire2(\"" + item.ID + "\")' ;'><i class= 'fa fa-search-plus' ></i></button></td><td>" + item.POURCENTAGE + "</td><td>" + item.PRIXVENTECAISSON + "</td><td>" + item.LIB_FACADE + "</td><td>" + item.LIB_SOUSFACADE + "</td><td>" + item.TYPFACADE + "</td><td>" + item.QuantiteFACADE + "</td><td>" + item.PRIXFACADE + "</td><td>" + item.PTHTFACADE + "</td><td>" + item.PTHTSSMARGE + "</td><td>" + item.PTHTAVECMARGE + "</td><td>" + item.TVACUISINE + "</td><td>" + item.PTTCCUISINE + "</td><td style='display: flex; border-bottom-width: 0px; border-left-width: 0px; border-right-width: 0px; border-top-width: 0px;'> <button class='btn btn-info btn-circle' type='button' onclick='EditRow(\"" + item.ID + "\")' disabled id='BtnRow_" + item.ID + "'> <i class='fa fa-check'></i> </button> <button class='btn btn-warning btn-circle' type='button' onclick='DeleteRowCuisine(\"" + item.ID + "\")'> <i class='fa fa-times'></i> </button> </td></tr>";
                        $("#TableauCAISSON tbody").append(line);
                    });
                    $("#TableauCAISSON tfoot").replaceWith("<tfoot><tr><td><input type='number' class='form-control' id='QuantiteCAISSON' name='QuantiteCAISSON' value='1' min='1' /></td><td><select class='form-control' id='CAISSON' name='CAISSON'><option></option></select></td><td><select class='form-control' id='SSCAISSON'><option></option></select></td><td><select class='form-control' id='MP' name='MP'><option></option></select></td><td><input type='number' class='form-control' id='CREVCAISSON' name='CREVCAISSON' value='0' min='0' readonly></input></td><td> <input type='number' class='form-control' name='MARGEPRIXACHAT' id='MARGEPRIXACHAT' value='0' min='0' /></td><td><input type='number' class='form-control' name='PRIXACHAT' id='PRIXACHAT' value='0' min='0' readonly /></td><td><input type='number' class='form-control' name='ACC' id='ACC' value='0' min='0'  readonly /> <button class='btn btn-info btn-circle' id='AffAcc' type='button' onclick='AffAccessoire();' disabled><i class= 'fa fa-plus' ></i></button ></td><td><input type='number' class='form-control' id='POURCENTAGE' name='POURCENTAGE' value='0' min='0'></input></td><td> <input type='number' class='form-control' name='PRIXVENTECAISSON' id='PRIXVENTECAISSON' value='0' min='0' readonly /></td><td><select class='form-control' name='FACADE' id='FACADE'></select></td><td><select class='form-control' name='SOUSFACADE' id='SOUSFACADE'></select></td><td><select class='form-control' id='TYPESOUSFACADE' name='TYPESOUSFACADE'><option></option></select></td><td><input type='number' class='form-control' id='QuantiteFACADE' value='1' min='1' /></td><td><input type='number' class='form-control' id='PRIXFACADE' value='0' min='0' readonly /></td><td><input type='number' class='form-control' id='PTHTFACADE' name='PTHTFACADE' value='0' readonly='true' /></td><td><input type='number' class='form-control' id='PTHTSSMARGE' name='PTHTSSMARGE' value='' readonly='true' /></td><td><input type='number' class='form-control' id='PTHTAVECMARGE' name='PTHTAVECMARGE' value='' readonly='true' /></td> <td><select class= 'form-control' id ='TVACUISINE' name = 'TVACUISINE'> <option>0</option></select ></td ><td><input type='number' class='form-control' id='PTTCCUISINE' name='PTTCCUISINE' value='' readonly='true' /></td><td style='display: flex; border-bottom-width: 0px; border-left-width: 0px; border-right-width: 0px;border-top-width: 0px;' required><button class='btn btn-info btn-circle' type='button' onclick='AddRowCuisine()' id='FirstBTN'><i class='fa fa-check'></i></button><button class='btn btn-warning btn-circle' type='button' disabled><i class='fa fa-times'></i></button></td></tr></tfoot>");
                    $("#SSCAISSON").select2();
                    $("#SSCAISSON").val("");
                    $("#CAISSON").select2();
                    $("#CAISSON").val("");
                    $("#MP").val("");
                    $("#MP").select2();
                    $("#TVACUISINE").select2();
                    $("#TYPESOUSFACADE").select2();
                    $("#FACADE").select2();
                    $("#SOUSFACADE").select2();
                    RemplirListe20();
                    RemplirListe18();
                    ////RemplirListe19();
                    RemplirListeTVACUISINE();
                }
            });
            UpdatePrice();
        }
        //--------------------------------------------------------------------------
        function RemplirTableau11() {
            $("#Tableau tbody").empty();

            $.ajax({
                type: 'POST',
                url: "/Vente/GetAllLineDevis",
                success: function (response) {
                    $.each(response, function (i, item) {
                        var line = "<tr id='" + item.ID + "'><td>" + item.LIBELLE + "</td><td>" + item.NumDevis + "</td><td>" + item.DESIGNATION + "</td><td>" + item.MARQUE + "</td><td>" + item.UNITE + "</td><td>" + item.DEVISE + "</td><td>" + item.CATEGORIE + "</td><td>" + item.Sous_CATEGORIE + "</td><td>" + item.QUANTITE + "</td><td>" + item.PRIX_VENTE_HT + "</td><td>" + item.MARGE + "</td><td>" + (item.PRIX_VENTE_HT2).toFixed(3) + "</td><td>" + item.REMISE + "</td><td>" + item.PTHT + "</td><td>" + item.TVA + "</td><td>" + item.TTC + "</td><td style='display: flex; border-bottom-width: 0px; border-left-width: 0px; border-right-width: 0px; border-top-width: 0px;'> <button class='btn btn-info btn-circle' type='button' onclick='EditRow(\"" + item.ID + "\")' disabled id='BtnRow_" + item.ID + "'> <i class='fa fa-check'></i> </button> <button class='btn btn-warning btn-circle' type='button' onclick='DeleteRow(\"" + item.ID + "\")'> <i class='fa fa-times'></i> </button> </td></tr>";
                        $("#Tableau tbody").append(line);
                    });
                    $("#Tableau tfoot").replaceWith("<tfoot><tr> <td><select class='form-control' id='articles'><option></option></select></td> <td> <input type='text' class='form-control' id='NumDevis' readonly='true' /> </td> <td><select class='form-control' name='descriptionProduit' id='descriptionProduit'><option></option> </select> </td><td> <select class='form-control' id='marque'><option></option></select> </td><td> <select class='form-control' id='unite'></select> </td><td> <select class='form-control' id='devise'><option></option></select> </td><td> <select class='form-control' id='categorie'><option></option> </select> </td><td> <select class='form-control' name='Sous_Categorie' id='Sous_Categorie'><option></option>  </select></td> <td> <input type='number' class='form-control' id='QuantiteProduit' value='1' min='1'/> </td> <td> <input type='number' class='form-control' id='PUHTProduit' min='0'/> </td> <td> <input type='number' class='form-control' id='marge' min='0'/> </td> <td> <input type='number' class='form-control' id='PUHTProduit2' min='0'/> </td> <td> <input type='number' class='form-control' id='RemiseProduit' value='0' min='0' /> </td> <td> <input type='number' class='form-control' id='PTHTProduit' readonly='true' /> </td> <td> <select class='form-control' id='TVAProduit'><option></option> </select> </td> <td> <input type='number' class='form-control' id='TTCProduit' readonly='true' /> </td> <td style='display: flex; border-bottom-width: 0px; border-left-width: 0px; border-right-width: 0px; border-top-width: 0px;'> <button class='btn btn-info btn-circle' type='button' onclick='AddRow()'  id='FirstBTN'> <i class='fa fa-check'></i> </button> <button class='btn btn-warning btn-circle' type='button' disabled> <i class='fa fa-times'></i> </button> </td> </tr> </tfoot>");
                    $("#marque").select2();
                    $("#descriptionProduit").select2();
                    $("#articles").select2();
                    $("#TVAProduit").select2();
                    $("#unite").select2();
                    $("#devise").select2();
                    $("#categorie").select2();
                    $("#Sous_Categorie").select2();
                    RemplirListe();
                    RemplirListe2();
                    RemplirListe3();
                    RemplirListe4();
                    RemplirListe5();
                    RemplirListe6();
                    RemplirListe7();




                }
            });



            UpdatePrice();

        }
        //---------------------------------------------------------------------------
        //function RemplirTableau12() {
        //    $("#Tableau12 tbody").empty();
        //    $.ajax({
        //        type: 'POST',
        //        url: "/Vente/GetAllLinSERVICE",
        //        success: function (response) {
        //            alert("hhh");
        //            $.each(response, function (i, item) {
        //                //alert(item.ID);
        //                //alert(item.REFSERVICE);
        //                //alert(item.DescriptionSERVICE);
        //                //alert(item.UNITE);
        //                //alert(item.QUANTITE);
        //                //alert(item.PRIX_VENTE_HT);
        //                //alert(item.REMISE);
        //                //alert(item.PTHT);
        //                //alert(item.TVA);
        //                var line = "<tr id='" + item.ID + "'><td>" + item.REFSERVICE + "</td><td>" + item.DescriptionSERVICE + "</td><td>" + item.UNITE + "</td><td>" + item.QUANTITE + "</td><td>" + item.PRIX_VENTE_HT+ "</td><td>" + item.REMISE+ "</td><td>" + item.PTHT + "</td><td>" + item.TVA + "</td><td>" + item.TTC + "</td><td>" + item.RESSOURCE + "</td><td style='display: flex; border-bottom-width: 0px; border-left-width: 0px; border-right-width: 0px; border-top-width: 0px;'> <button class='btn btn-info btn-circle' type='button' onclick='EditRow(\"" + item.ID + "\")' disabled id='BtnRow_" + item.ID + "'> <i class='fa fa-check'></i> </button> <button class='btn btn-warning btn-circle' type='button' onclick='DeleteRow(\"" + item.ID + "\")'> <i class='fa fa-times'></i> </button> </td></tr>";
        //                $("#Tableau12 tbody").append(line);

        //            });
        //            $("#Tableau12 tfoot").empty();


        //        }
        //    });

        //}
    //--------------------------------------------------------------------------
        function RemplirTableau4() {
            $("#Tab tbody").empty();
             var Code = "@ViewBag.Code";
            $.ajax({
                type: 'POST',
                url: "/Vente/GetAllLinSERVICE",
                success: function (response1) {

                    $.each(response1, function (i, item) {


                        var line = "<tr id='" + item.ID + "'><td>" + item.REFSERVICE + "</td><td>" + item.DescriptionSERVICE + "</td><td>" + item.UNITE + "</td><td>" + item.QUANTITE + "</td><td>" + item.PRIX_VENTE_HT + "</td><td>" + item.REMISE + "</td><td>" + item.PTHT + "</td><td>" + item.TVA + "</td><td>" + item.TTC + "</td><td>" + item.RESSOURCE2 + "</td><td style='display: flex; border-bottom-width: 0px; border-left-width: 0px; border-right-width: 0px; border-top-width: 0px;'> <button class='btn btn-info btn-circle' type='button' onclick='EditRow(\"" + item.ID + "\")' disabled id='BtnRow_" + item.ID + "'> <i class='fa fa-check'></i> </button> <button class='btn btn-warning btn-circle' type='button' onclick='DeleteRow2(\"" + item.ID + "\")'> <i class='fa fa-times'></i> </button> </td></tr>";
                       $("#Tab tbody").append(line);


                    });
                    if (Mode == "Aff") {
                        $("#Tab tfoot").empty();
                    }
                    else {
                        $("#Tab tfoot").replaceWith("<tfoot><tr><tr><td><select type='text' class='form-control' id='SERVICE'/></td><td><textarea id='descriptionSERVICE'></textarea></td><td><input class='form-control' id='uniteSERVICE' value='H'/></td><td><input type='number' class='form-control' id='QuantiteSERVICE' value='1' min='1'/></td><td><input type='number' class='form-control' id='PUHTSERVICE' min='0' /></td><td><input type='number' class='form-control' id='RemiseSERVICE' value='0' min='0'/></td><td><input type='number' class='form-control' id='PTHTSERVICE' readonly='true'/></td><td><select class='form-control' id='TVASERVICE'><option>19</option></select></td><td><input type='number' class='form-control' id='TTCSERVICE' readonly='true'/></td><td><select type='text' id='RESSOURCE' data-placeholder='Choisir un employer...' class='chosen-select' multiple style='width:350px;' tabindex='4'></select></td><td style='display: flex; border-bottom-width: 0px; border-left-width: 0px; border-right-width: 0px; border-top-width: 0px;'> <button class='btn btn-info btn-circle' type='button' onclick='AddRow2()'  id='FirstBTN'> <i class='fa fa-check'></i> </button> <button class='btn btn-warning btn-circle' type='button' disabled> <i class='fa fa-times'></i> </button> </td> </tr> </tfoot>");
                        $("#SERVICE").select2();
                        $("#RESSOURCE").select2();
                        $("#TVASERVICE").select2();
                        RemplirListe11();
                        RemplirListe12();
                        RemplirListe13();
                    }
                }
            });

            UpdatePrice();

        }
        function RemplirTableau5() {
            $("#TabSST tbody").empty();
           var Code = "@ViewBag.Code";

            $.ajax({
                type: 'POST',
                url: "/Vente/GetAllLinSERVICESOUSTRAITANCE",

                success: function (response1) {
                    $.each(response1, function (i, item) {
                        var line = "<tr id='" + item.ID + "'><td>" + item.REFSERVICE + "</td><td>" + item.DescriptionSERVICE + "</td><td>" + item.UNITE + "</td><td>" + item.QUANTITE + "</td><td>" + item.PRIX_VENTE_HT + "</td><td>" + item.Marge + "</td><td>" + item.PRIX_VENTE_HT2 + "</td><td>" + item.REMISE + "</td><td>" + item.PTHT + "</td><td>" + item.TVA + "</td><td>" + item.TTC + "</td><td>" + item.SOUS_TRAITANCE2 + "</td><td style='display: flex; border-bottom-width: 0px; border-left-width: 0px; border-right-width: 0px; border-top-width: 0px;'> <button class='btn btn-info btn-circle' type='button' onclick='EditRow(\"" + item.ID + "\")' disabled id='BtnRow_" + item.ID + "'> <i class='fa fa-check'></i> </button> <button class='btn btn-warning btn-circle' type='button' onclick='DeleteRow3(\"" + item.ID + "\")'> <i class='fa fa-times'></i> </button> </td></tr>";
                        $("#TabSST tbody").append(line);
                    });
                    if (Mode == "Aff") {
                        $("#TabSST tfoot").empty();
                    }
                    else {
                        $("#TabSST tfoot").replaceWith("<tfoot><tr><tr><td><select type='text' class='form-control' id='SERVICESOUSTRAITANCE'/></td><td><textarea id='descriptionSOUSTRAITANCE'></textarea></td><td><input class='form-control' id='uniteSOUSTRAITANCE' value='H'/></td><td><input type='number' class='form-control' id='QuantiteSOUSTRAITANCE' value='1' min='1'/></td><td><input type='number' class='form-control' id='PUHTSOUSTRAITANCE' min='0' /></td><td><input type = 'number' class= 'form-control' id = 'margeSOUSTRAITANCE' value = '0' min = '0' disabled /></td ><td><input type='number' class='form-control' id='PUHTProduitSOUSTRAITANCE2' value='0' min='0' /></td><td><input type='number' class='form-control' id='RemiseSOUSTRAITANCE' value='0' min='0'/></td><td><input type='number' class='form-control' id='PTHTSOUSTRAITANCE' readonly='true'/></td><td><select class='form-control' id='TVASOUSTRAITANCE'><option>19</option></select></td><td><input type='number' class='form-control' id='TTCSOUSTRAITANCE' readonly='true'/></td><td><select type='text' id='SOUSTRAITANCE' name='SOUSTRAITANCE' data-placeholder='choisir employer...' class='chosen-select' multiple style='width:350px;' tabindex='4'></select></td><td style='display: flex; border-bottom-width: 0px; border-left-width: 0px; border-right-width: 0px; border-top-width: 0px;'> <button class='btn btn-info btn-circle' type='button' onclick='AddRow3()'  id='FirstBTN'> <i class='fa fa-check'></i> </button> <button class='btn btn-warning btn-circle' type='button' disabled> <i class='fa fa-times'></i> </button> </td> </tr> </tfoot>");
                        $("#SERVICESOUSTRAITANCE").select2();
                        $("#SOUSTRAITANCE").select2();
                        $("#TVASOUSTRAITANCE").select2();
                        RemplirListe14();
                        RemplirListe15();
                        RemplirListe16();
                    }
                }
            });

            UpdatePrice();

        }
    function RemplirTableau2() {

        $("#Tableau tbody").empty();

        $.ajax({
            type: 'POST',
            url: "/Vente/GetAllLineDevis",
            success: function (response) {
                $.each(response, function (i, item) {

                    var line = "<tr id='" + item.ID + "'><td>" + item.LIBELLE + "</td><td>" + item.NumDevis + "</td><td>" + item.DESIGNATION + "</td><td>" + item.MARQUE + "</td><td>" + item.UNITE + "</td><td>" + item.DEVISE + "</td><td>" + item.CATEGORIE + "</td><td>" + item.Sous_CATEGORIE + "</td><td>" + item.QUANTITE + "</td><td>" /*+ item.QUANTITELiv + "</td><td>" + item.QUANTITERES + "</td><td>" */ + item.PRIX_VENTE_HT + "</td><td>" + item.MARGE + "</td><td>" + item.PRIX_VENTE_HT2 + "</td><td>" + item.REMISE + "</td><td>" + item.PTHT + "</td><td>" + item.TVA + "</td><td>" + item.TTC + "</td><td style='display: flex; border-bottom-width: 0px; border-left-width: 0px; border-right-width: 0px; border-top-width: 0px;'> <button class='btn btn-info btn-circle' type='button' onclick='EditRow(\"" + item.ID + "\")' disabled id='BtnRow_" + item.ID + "'> <i class='fa fa-check'></i> </button> <button class='btn btn-warning btn-circle' type='button' onclick='DeleteRow(\"" + item.ID + "\")'> <i class='fa fa-times'></i> </button> </td></tr>";
                    $("#Tableau tbody").append(line);
                });
                $("#Tableau tfoot").empty();

                RemplirListe();
                RemplirListe2();
                RemplirListe3();
                RemplirListe4();
                RemplirListe5();
                RemplirListe6();
                RemplirListe7();

            }
        });
        UpdatePrice();
        }
        //--------------------------------------------------------------------------
        function RemplirTableau3() {
            $.ajax({
                type: 'POST',
                url: "/Vente/GetAllLineDevis2",
                success: function (response) {
                    $("#Tableau tfoot").replaceWith("<tfoot> <tr id='" + response.ID + "'> <td> <select class='form-control' name='articles'  id='articles'><option value='" + response.ID + "'>" + response.LIBELLE + "</option></select> </td> <td> <input type='text' class='form-control' id='NumDevis'value='" + response.NumDevis + "' readonly='true'/></td> <td><textarea name='descriptionProduit' id='descriptionProduit'>" + response.DESIGNATION + " </textarea ></td><td> <select class='form-control' id='marque'><option> " + response.MARQUE + "</option></select> </td><td> <select class='form-control' id='unite'><option>" + response.UNITE + "</option></select> </td><td> <select class='form-control' id='devise'><option>" + response.DEVISE + "</option> </select> </td><td> <select class='form-control' id='categorie'><option>" + response.CATEGORIE + "</option> </select> </td><td> <select class='form-control' name='Sous_Categorie' id='Sous_Categorie'><option> " + response.Sous_CATEGORIE + " </option> </select> </td><td> <input type='number' class='form-control' id='QuantiteProduit' value='" + response.QUANTITE + "' min='1'/> </td> <td> <input type='number' class='form-control' id='PUHTProduit' value='" + response.PRIX_VENTE_HT + "' min='0'/> </td> <td> <input type='number' class='form-control' id='RemiseProduit' value='" + response.REMISE + "' min='0' /> </td> <td> <input type='number' class='form-control' id='PTHTProduit' value='" + response.PTHT + "' readonly='true' /> </td> <td> <select class='form-control' id='TVAProduit' ><option> " + response.TVA + "</option> </select> </td> <td> <input type='number' class='form-control' id='TTCProduit' readonly='true' value='" + response.TTC + "'/> </td> <td style='display: flex; border-bottom-width: 0px; border-left-width: 0px; border-right-width: 0px; border-top-width: 0px;'> <button class='btn btn-info btn-circle' type='button' onclick='AddRow()'> <i class='fa fa-check'></i> </button> <button class='btn btn-warning btn-circle' type='button' disabled> <i class='fa fa-times'></i> </button> </td> </tr> </tfoot>");

                    RemplirListe();
                    RemplirListe2();
                    RemplirListe3();
                    RemplirListe4();
                    RemplirListe5();
                    RemplirListe6();
                    RemplirListe7();

                }
            });



            UpdatePrice2();

        }

    //-------------------------------------------------------------

        function EditRow(parampassed) {
            var ID_Produit = parampassed;
            var Quantite_Produit = $('#NEW_QTE').val();
            var PUHT_Produit = $('#NEW_PUVENTE').val();
            var NEW_MARGE = $('#NEW_MARGE').text();
            var Remise_Produit = $('#NEW_REMISE').val();
            var PTHT_Produit = $('#NEW_PTHT').text();
            var TVA_Produit = $('#NEW_TVA').val();
            var TTC_Produit = $('#NEW_PTCT').text();
            var data = {
                ID_Produit: ID_Produit,
                Quantite_Produit: Quantite_Produit,
                PUHT_Produit: PUHT_Produit,
                Remise_Produit: Remise_Produit,
                NEW_MARGE: NEW_MARGE,
                PTHT_Produit: PTHT_Produit,
                TVA_Produit: TVA_Produit,
                TTC_Produit: TTC_Produit
            };
            $.ajax({
                type: 'POST',
                data: data,
                url: "/Vente/EditLineDevis",
                success: function (response) {
                    RemplirTableauEditLine();
                }
            });
        }
    //---------------------------------------------------------------------------
        function DeleteRow(parampassed) {
            $.ajax({
                type: 'POST',
                url: "/Vente/DeleteLineDevis?parampassed=" + parampassed,
                success: function (response) {
                    RemplirTableau();
                }
            });
        }

        function DeleteRowCuisine(parampassed) {
            $.ajax({
                type: 'POST',
                url: "/Vente/DeleteLineDevisCuisine?parampassed=" + parampassed,
                success: function (response) {
                    RemplirTableauCuisine2();
                }
            });
        }
        function DeleteRow2(parampassed) {
            $.ajax({
                type: 'POST',
                url: "/Vente/DeleteLineService?parampassed=" + parampassed,
                success: function (response) {
                    RemplirTableau4();
                }
            });
        }
        function DeleteRow3(parampassed) {

            $.ajax({
                type: 'POST',
                url: "/Vente/DeleteLineServiceSST?parampassed=" + parampassed,
                success: function (response) {
                    RemplirTableau5();
                }
            });
        }
    //---------------------------------------------------------------------------
                        function UpdatePriceRemise() {
                            var remise = $("#remise").val();
                            remise = parseFloat(remise);
                            var totalHT = $("#totalHT").val();
                            var totalTVA = $("#totalTVA").val();
                            totalHT = parseFloat(totalHT);
                            totalTVA = parseFloat(totalTVA);
                            var NewTotalTva = totalTVA - ((totalTVA * remise) / 100);
                            NewTotalTva = parseFloat(NewTotalTva);
                            $("#totalTVA").val(NewTotalTva.toFixed(3));
                            var NetHT = totalHT - ((totalHT * remise) / 100);
                            NetHT = parseFloat(NetHT);
                            $("#NetHT").val(NetHT);
                            var tva1 = $("#TVAProduit1").val();
                            tva1 = parseFloat(tva1);
                            var somme = $("#somme").val();
                            somme = parseFloat(somme);
                            var netAPaye = NetHT + NewTotalTva + somme + (somme * tva1 / 100) - ((somme * remise) / 100);
                            netAPaye = parseFloat(netAPaye);

                            var TotalHTMI = totalHT + somme;
                            TotalHTMI = parseFloat(TotalHTMI);

                            var TotalTTC = NetHT + NewTotalTva;
                            TotalTTC = parseFloat(TotalTTC);

                            $("#TotalTTC").val(TotalTTC.toFixed(3));
                            $("#TotalTTC1").val(TotalTTC.toFixed(3));
                            $("#NettotalHTSERV").val(NettotalHTSERV.toFixed(3));
                            $("#netAPaye").val(netAPaye.toFixed(3));


                        }


        function UpdatePrice() {
        var remise = $("#remise").val();
        var Code = "@ViewBag.Code";

        $.ajax({
            type: 'POST',
            url: "/Vente/UpdatePriceDevis?remise=" + remise ,
            success: function (response) {
                var totalHT = response.totalHT;
                var totalTVA = response.totalTVA;
                var totalHTSERV = response.totalHTSERV;
                var totalTVASERV = response.totalTVASERV;
                var totalHTSERVSST = response.totalHTSERVSST;
                var totalTVASERVSST = response.totalTVASERVSST;
                var totalHTCuisine = response.totalHTCuisine;
                var totalTVACuisine = response.totalTVACuisine;
                var MargeDevis = response.MargeDevis;
                MargeDevis = parseFloat(MargeDevis);
                $("#MargeDevis").val(MargeDevis.toFixed(3));
                window.totalTVA = totalTVA;
                totalHT = parseFloat(totalHT);
                totalTVA = parseFloat(totalTVA);
                window.totalTVASERV = totalTVASERV;
                totalHTSERV = parseFloat(totalHTSERV);
                totalTVASERV = parseFloat(totalTVASERV);
                totalHTSERVSST = parseFloat(totalHTSERVSST);
                totalTVASERVSST = parseFloat(totalTVASERVSST);
                totalHTCuisine = parseFloat(totalHTCuisine);
                totalTVACuisine = parseFloat(totalTVACuisine);
                $("#totalHT").val(totalHT.toFixed(3));
                var NewTotalTva = totalTVA - ((totalTVA * remise) / 100);
                NewTotalTva = parseFloat(NewTotalTva);
                var NewtotalTVACuisine = totalTVACuisine - ((totalTVACuisine * remise) / 100);
                NewtotalTVACuisine = parseFloat(NewtotalTVACuisine);
                var NewTotalTva2 = NewTotalTva + NewtotalTVACuisine;
                NewTotalTva2 = parseFloat(NewTotalTva2);
                var NEWtotalTVASERV = totalTVASERV - ((totalTVASERV * remise) / 100);
                NEWtotalTVASERV = parseFloat(NEWtotalTVASERV);
                var NEWtotalTVASERVSST = totalTVASERVSST - ((totalTVASERVSST * remise) / 100);
                NEWtotalTVASERVSST = parseFloat(NEWtotalTVASERVSST);
                $("#totalTVA").val(NewTotalTva2.toFixed(3));
                var NetHT = totalHT - ((totalHT * remise) / 100);
                NetHT = parseFloat(NetHT);
                var NettotalHTCuisine = totalHTCuisine - ((totalHTCuisine * remise) / 100);
                NettotalHTCuisine = parseFloat(NettotalHTCuisine);
                var NettotalHTSERV = totalHTSERV - ((totalHTSERV * remise) / 100);
                NettotalHTSERV = parseFloat(NettotalHTSERV);
                var NettotalHTSERV1 = totalHTSERV - ((totalHTSERV * remise) / 100) + (totalHTSERVSST - ((totalHTSERVSST * remise) / 100));
                NettotalHTSERV1 = parseFloat(NettotalHTSERV1);
                $("#NettotalHTSERV").val(NettotalHTSERV1.toFixed(3));
                var NettotalHTSERVSST = totalHTSERVSST - ((totalHTSERVSST * remise) / 100);
                NettotalHTSERVSST = parseFloat(NettotalHTSERVSST);
                //$("#NettotalHTSERV").val(NettotalTVASERVSST.toFixed(3));

                $("#NetHT").val(NetHT);
                var tva1 = $("#TVAProduit1").val();
                tva1 = parseFloat(tva1);
                var somme = "@ViewBag.somme";

                if (somme != "") {
                    somme = parseFloat(somme);
                    var netAPaye = NetHT + NewTotalTva + NettotalHTSERV + NEWtotalTVASERV + NEWtotalTVASERVSST + NettotalHTSERVSST + somme + (somme * tva1 / 100) - ((somme * remise) / 100) + NewtotalTVACuisine + NettotalHTCuisine;
                    var TotalHTMI = totalHT + somme + totalHTSERV + totalHTSERVSST + NettotalHTCuisine;
                    TotalHTMI = parseFloat(TotalHTMI);
                }
                else {
                    var netAPaye = NetHT + NewTotalTva + NEWtotalTVASERV + NettotalHTSERV + NEWtotalTVASERVSST + NettotalHTSERVSST + NewtotalTVACuisine + NettotalHTCuisine;
                    var TotalHTMI = totalHT + totalHTSERV + totalHTSERVSST + NettotalHTCuisine;
                    TotalHTMI = parseFloat(TotalHTMI);
                }
                var NettotalTTCSERV = NEWtotalTVASERV + NettotalHTSERV;
                var NettotalTTCSSTRAIT = NEWtotalTVASERVSST + NettotalHTSERVSST;

                var TotalTTC = NetHT + NewTotalTva;
                $("#TotalTTC").val(TotalTTC.toFixed(3));
                $("#TotalTTC1").val(TotalTTC.toFixed(3));
                $("#TotalHTMI").val(TotalHTMI.toFixed(3));
                $("#NettotalTTCSERV").val(NettotalTTCSERV.toFixed(3));
                $("#NettotalTTCSSTRAIT").val(NettotalTTCSSTRAIT.toFixed(3));

                $("#netAPaye").val(netAPaye.toFixed(3));
            }
        });
        }
        //---------------------------------------------------------------------------

        function UpdatePrice2() {

            var remise = $("#remise").val();
            $.ajax({
                type: 'POST',
                url: "/Vente/UpdatePriceDevis2?remise=" + remise,
                success: function (response) {

                    var totalHT = response.totalHT;

                    var totalTVA = response.totalTVA;

                    window.totalTVA = totalTVA;
                    totalHT = parseFloat(totalHT);
                    totalTVA = parseFloat(totalTVA);
                    $("#totalHT").val(totalHT.toFixed(3));
                    var NewTotalTva = totalTVA - ((totalTVA * remise) / 100);
                    NewTotalTva = parseFloat(NewTotalTva);
                    $("#totalTVA").val(NewTotalTva.toFixed(3));
                    var NetHT = totalHT - ((totalHT * remise) / 100);
                    NetHT = parseFloat(NetHT);
                    $("#NetHT").val(NetHT);
                    var TotalTTC = NetHT + NewTotalTva;
                    $("#TotalTTC").val(TotalTTC.toFixed(3));
                    $("#netAPaye").val(TotalTTC.toFixed(3));
                }
            });
        }
        //-------------------------------------------------------

        //-------------------------------------------------------

        function UpdateTva() {

            var Qte = $("#QuantiteProduit").val();
            Qte = parseFloat(Qte);
            var PRIX_VENTE_HT = parseFloat($('#PUHTProduit').val());
            var PrixTotHTSansRemise = Qte * PRIX_VENTE_HT;
            var Remise = $("#RemiseProduit").val();
            Remise = parseFloat(Remise);
            var MontantRemise = (PrixTotHTSansRemise * Remise) / 100;
            var PTHTProduit = PrixTotHTSansRemise - MontantRemise;

            $('#PTHTProduit').val(PTHTProduit.toFixed(3));
            var TVA = $('#TVAProduit').val();
            TVA = parseFloat(TVA);
            var MontantTVA = (PTHTProduit * TVA) / 100;
            var TTCProduit = PTHTProduit + MontantTVA;

            $('#TTCProduit').val(TTCProduit.toFixed(3));

        }
        //---------------------------------------------------------------------------
        function imp() {
            $("#WithPrint").val("true");
        $("form").attr("target", "_blank");
        $("form").submit();
        $("#WithPrint").val("false");
        $("form").attr("target", "_self");
        }
    //    $("#PrintBTN").click(function () {
    //        debugger;
    //    $("#WithPrint").val("true");
    //    $("form").attr("target", "_blank");
    //    $("form").submit();
    //    $("#WithPrint").val("false");
    //    $("form").attr("target", "_self");
    //});
    //---------------------------------------------------------------------------
    $("#DeleteBtn").click(function () {
        Delete();
    });
    function Delete() {
        var parampassed = "@ViewBag.Code";
        var Conf = confirm("Voulez vous Supprimer cet elément ?");
        if (Conf == true) {
            $.ajax({
                type: 'POST',
                url: "/Vente/DeleteDevis?parampassed=" + parampassed,
                success: function (response) {
                    window.location = "/Vente/Devis";
                }
            });
        }
        var preloader = $('<div>', { 'class': 'preloader' }).appendTo('body');
        $(this)
               .ajaxStart(function () {
                   preloader.fadeIn();
               })
               .ajaxStop(function () {
                   preloader.delay(800).fadeOut();
               });
    }
    //---------------------------------------------------------------------------
    $('form').validate({
        rules: {
            client: {
                required: true
            }
        }
    });
        //---------------------------------------------------------------------------
                        function HeuresPlanification(MyValue) {
                            $.ajax({
                                type: 'POST',
                                url: "/Vente/HeuresPlanification?id=" + MyValue,
                                success: function (response) {

                                    window.location.href = "/Vente/HeuresPlanification?id=" + MyValue;
                                }


                            });
                        }

//------------------------
    $("#VersCommande").click(function () {
        VersCommande();
    });
    function VersCommande() {

        var parampassed = "@ViewBag.Code";

        swal({
            title: "Voulez vous transformer ce devis en commande interne ?",
            text: "Attention : cette action est irréversible ! Voulez-vous continuer ?",
            type: "warning",
            showCancelButton: true,
            confirmButtonColor: "#DD6B55",
            confirmButtonText: "Oui, continuer!",
            cancelButtonText: "Non, annuler SVP!",
            closeOnConfirm: false,
            closeOnCancel: false
        },
            function (isConfirm) {
                if (isConfirm) {

            $.ajax({
                type: 'POST',
                url: "/Vente/DevisVersCommande?parampassed=" + parampassed,
                success: function (response) {

                                swal("Transformer!", "Votre commande interne est créée avec succés.", "success");
                                setTimeout(function () {
                                    window.location.href = "/Vente/FormCommande?Mode=Edit&Code=" + response;
                                }, 3500);
                            }
                        });

                } else {
                    swal("Annuler", "Votre commande Interne est annulée :)", "error");
                }
            });

        var preloader = $('<div>', { 'class': 'preloader' }).appendTo('body');
        $(this)
               .ajaxStart(function () {
                   preloader.fadeIn();
               })
               .ajaxStop(function () {
                   preloader.delay(800).fadeOut();
               });
    }
    //--------------------------------------------------------------------------------
    $("#VersFacture").click(function () {
        VersFacture();
    });
        function VersFacture() {
            var parampassed = "@ViewBag.Code";
            var Conf = confirm("Voulez vous transformer ce devis en facture ?");
            if (Conf == true) {
                $.ajax({
                    type: 'POST',
                    url: "/Vente/DevisVersfacture?parampassed=" + parampassed,
                    success: function (response) {
                        window.location.href = "/Vente/FormFacture?Mode=Edit&Code=" + response;
                    }
                });
            }
            var preloader = $('<div>', { 'class': 'preloader' }).appendTo('body');
            $(this)
                .ajaxStart(function () {
                    preloader.fadeIn();
                })
                .ajaxStop(function () {
                    preloader.delay(800).fadeOut();
                });
        }


        var config = {
            '.chosen-select': {},
            '.chosen-select-deselect': { allow_single_deselect: true },
            '.chosen-select-no-single': { disable_search_threshold: 10 },
            '.chosen-select-no-results': { no_results_text: 'Oops, nothing found!' },
            '.chosen-select-width': { width: "95%" }
        }
        for (var selector in config) {
            $(selector).chosen(config[selector]);
        }


	</script>

}
